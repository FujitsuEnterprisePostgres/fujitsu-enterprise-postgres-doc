<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"><html lang="en"><head><META http-equiv="Content-Type" content="text/html; charset=UTF-8"><META CONTENT="4.3" NAME="GeneratorVersion"><title>7.4.3 Bulk INSERT</title><link rel="stylesheet" href="manualmain.css" type="TEXT/CSS"><script language="JavaScript" src="topbutton.js"></script></head><body onload="init()"><div class="topButton" id="topButton0"><a class="topButton" href="#top"><img src="image/top.gif" width="62" height="20" border="0" alt="Top" title="Top"></a></div><div class="top_header"><div class="top_header_title"><a title="Title Page" class="top_link" target="_top" HREF="index.html">Enterprise Postgres 13&nbsp;Application Development Guide</a></div><div class="top_header_graphic"><span class="top_logo"><img src="image/logo-white-fj.gif" width="148" height="32" alt=""></span><span class="top_keygraphic"><img src="image/cover-header-graphic.gif" width="148" height="32" alt="FUJITSU Software"></span></div></div><div class="header_footer"><div class="breadcrumbslist"><a href="j2681-00-07-00-00.html">Chapter&nbsp;7 Embedded SQL in COBOL</a> &gt; <a href="j2681-00-07-04-00.html">7.4 Application Development</a> &gt; 7.4.3 Bulk INSERT</div><div class="back_next"><a href="j2681-00-07-04-02.html"><img src="image/back2.gif" width="65" height="27" border="0" alt="Previous" title="Previous"></a><a href="j2681-00-07-04-04.html"><img src="image/next2.gif" width="64" height="27" border="0" alt="Next" title="Next"></a></div></div><h3 id="IDapl06-for-cobolN11">7.4.3 Bulk INSERT</h3><div class="body"><div class="textblock"><p>This section describes the bulk INSERT.</p><p></p></div><p class="subhead_1" id="IDapl06-for-cobolN12"><span class="em">Synopsis</span></p><div class="textblock"><pre>EXEC SQL [ AT <span class="i">conn</span> ] [ FOR { <span class="i">num</span><span class="i">O</span><span class="i">f</span><span class="i">R</span><span class="i">ows</span><span class="i"> </span>| ARRAY_SIZE } ]	INSERT INTO <span class="i">table</span><span class="i">N</span><span class="i">ame</span> [ ( <span class="i">col</span><span class="i">N</span><span class="i">ame</span> [, ...] ) ]	{ VALUES ( { <span class="i">expr</span> | DEFAULT } [, ...] ) [, ...] | <span class="i">query</span> }	[ RETURNING * | <span class="i">output</span><span class="i">E</span><span class="i">xpr</span> [ [ AS ] <span class="i">output</span><span class="i">N</span><span class="i">ame</span> ] [, ...]	INTO <span class="i">output</span><span class="i">H</span><span class="i">ost</span><span class="i">V</span><span class="i">ar</span> [ [ INDICATOR ] <span class="i">indicator</span><span class="i">V</span><span class="i">ar</span> ] [, ...] ] END-EXEC</pre></div><p class="subhead_1" id="IDapl06-for-cobolN13"><span class="em">Description</span></p><div class="textblock"><p>Bulk INSERT is a feature that inserts multiple rows of data in bulk.</p><p>By specifying the array host variable that stored the data in the VALUES clause of the INSERT statement, the data for each element in the array can be inserted in bulk. This feature is used by specifying the insertion count in the FOR clause immediately before the INSERT statement.</p><br><dl><dt class="em">FOR Clause</dt><dd><p>Specify the insertion count using <span class="i">num</span><span class="i">O</span><span class="i">f</span><span class="i">R</span><span class="i">ows</span> or ARRAY_SIZE in the FOR clause. The FOR clause can be specified only in the INSERT statement, not in other update statements.</p><dl><dt class="em">numOfRows and ARRAY_SIZE</dt><dd><p>Insertion processing will be executed only for the specified count. However, if the count is 1, it will be assumed that the FOR clause was omitted when the application is executed. In this case, proceed according to the INSERT specification in the PostgreSQL Documentation.</p><p>Specify the FOR clause as an integer host variable or as a literal.</p><p>Specify ARRAY_SIZE to insert all elements of the array in the table. When specifying ARRAY_SIZE, specify at least one array in <span class="i">expr</span>.</p><p>If two or more arrays were specified in <span class="i">expr</span>, it will be assumed that ARRAY_SIZE is the minimum number of elements in the array.</p><p><span class="i">num</span><span class="i">O</span><span class="i">f</span><span class="i">R</span><span class="i">ows</span> or ARRAY_SIZE must exceed the minimum number of elements in all arrays specified in <span class="i">expr</span>, <span class="i">output</span><span class="i">H</span><span class="i">ost</span><span class="i">V</span><span class="i">ar</span>, and <span class="i">indicator</span><span class="i">V</span><span class="i">al</span>.</p><br></dd></dl><p>The following example shows how to specify the FOR clause.</p><pre class="border">01 NUMBER-OF-ROWS PIC S9(9) COMP VALUE 10.01 GROUP-ITEM.05 ID1 PIC S9(9) OCCURS 25.05 NAME PIC X(10) OCCURS 25.* will process 10 rowsEXEC SQL FOR :NUMBER-OF-ROWSINSERT INTO prod (name, id) VALUES (:NAME, :ID1) END-EXEC* will process 25 rowsEXEC SQL FOR ARRAY_SIZEINSERT INTO prod (name, id) VALUES (:NAME, :ID1) END-EXEC</pre></dd></dl><dl><dt class="em">expr</dt><dd><p>Specify the value to be inserted in the table. Array host variables, host variable literals, strings, and pointer variables can be specified. Structure type arrays and pointer variable arrays cannot be specified.</p><p>Do not use pointer variables and ARRAY_SIZE at the same time. The reason for this is that the number of elements in the area represented by the pointer variable cannot be determined.</p></dd></dl><dl><dt class="em">query</dt><dd><p>A query (SELECT statement) that supplies the rows to be inserted. The number of rows returned by <span class="i">query</span> must be 1. If two or more rows are returned, an error will occur. This cannot be used at the same time as ARRAY_SIZE.</p></dd></dl><dl><dt class="em">outputHostVar and indicatorVal</dt><dd><p>These must be array host variables or pointer variables.</p></dd></dl></div><p class="subhead_1" id="IDapl06-for-cobolN14"><span class="em">Error Messages</span></p><div class="textblock"><p>The messages below are output if an error occurs when the bulk INSERT is used.</p><p id="N42M" class="message"><span class="em">The value for the FOR clause must be a positive </span><span class="em">integer</span><span class="em">.</span></p><div class="textblock"><dl><dt class="em">Cause</dt><dd><p>The value given for <span class="i">num</span><span class="i">O</span><span class="i">f</span><span class="i">R</span><span class="i">ows</span> is less than or equal to 0.</p></dd></dl><dl><dt class="em">Solution</dt><dd><p>Specify a value that is more than or equal to 1 for <span class="i">num</span><span class="i">O</span><span class="i">f</span><span class="i">R</span><span class="i">ows</span>.</p><br></dd></dl></div><p class="msgtopic">Message</p><div class="textblock"></div><p id="N43M" class="message"><span class="em">A</span><span class="em">rray host variable </span><span class="em">is needed when using FOR ARRAY_SIZE</span><span class="em">.</span></p><div class="textblock"><dl><dt class="em">Cause</dt><dd><p>An array host variable is not specified in the VALUES clause.</p></dd></dl><dl><dt class="em">Solution</dt><dd><p>Specify more than one array host variable in the VALUES clause.</p><br></dd></dl></div><p class="msgtopic">Message</p><div class="textblock"></div><p id="N44M" class="message"><span class="em">The SELECT..INTO </span><span class="em">query</span><span class="em"> return</span><span class="em">ed</span><span class="em"> too many rows in row number %d.</span></p><div class="textblock"><dl><dt class="em">Cause</dt><dd><p>The "SELECT ... INTO" query in the INSERT statement returned more than one row.</p></dd></dl><dl><dt class="em">Solution</dt><dd><p>If <span class="i">num</span><span class="i">O</span><span class="i">f</span><span class="i">R</span><span class="i">ows</span> is more than one, the maximum number of rows that can be returned in the "SELECT ... INTO" query in the INSERT statement is one.</p></dd></dl></div></div><p class="subhead_1" id="IDapl06-for-cobolN15">Message</p><div class="textblock"></div><p class="subhead_1" id="IDapl06-for-cobolN18"><span class="em">Limitations</span></p><div class="textblock"><p>The limitations when using bulk INSERT are given below.</p><ul><li><p>Array of structures should not be used as an input in the 'VALUES' clause.</p></li><li><p>Array of pointers should not be used as an input in the 'VALUES' clause.</p></li><li><p>ECOBPG supports the use of 'WITH' clause in single INSERT statements. 'WITH' clause cannot be used in bulk INSERT statements.</p></li><li><p>If an error occurs, all bulk INSERT actions will be rolled back, therefore, no rows are inserted. However, if the RETURNING clause was used, and the error occurred while obtaining the rows after the insertion was successful, the insertion processing will not be rolled back.</p></li></ul></div><p class="subhead_1" id="IDapl06-for-cobolN19"><span class="em">Samples</span></p><div class="textblock"><p>Given below are some sample usages of the bulk INSERT functionality.</p><dl><dt class="em">Basic Bulk INSERT</dt><dd><pre class="border">01 GROUP-ITEM.05 IN-F1 PIC S9(9) OCCURS 4.MOVE 1 TO IN-F1(1)MOVE 2 TO IN-F1(2)MOVE 3 TO IN-F1(3)MOVE 4 TO IN-F1(4)...EXEC SQL FOR 3 INSERT INTO target (f1) VALUES (:IN-F1) END-EXEC</pre><p>The number of rows to insert indicated by the FOR clause is 3, so the data in the first 3 elements of the host array variable are inserted into the table. The contents of the target table will be:</p><pre class="border">f1----123(3 rows)</pre><p>Also a host integer variable can be used to indicate the number of rows that will be inserted in FOR clause, which will produce the same result as above:</p><pre class="border">01 NUM PIC S9(9) COMP VALUE 3.01 GROUP-ITEM.05 IN-F1 PIC S9(9) OCCURS 4.MOVE 1 TO IN-F1(1)MOVE 2 TO IN-F1(2)MOVE 3 TO IN-F1(3)MOVE 4 TO IN-F1(4)...EXEC SQL FOR :NUM INSERT INTO target (f1) VALUES (:IN-F1) END-EXEC</pre><br></dd></dl><dl><dt class="em">Inserting constant values</dt><dd><p>Constant values can also be bulk INSERTed into the table as follows:</p><pre class="border">EXEC SQL FOR 3 INSERT INTO target (f1,f2) VALUES (DEFAULT,'hello') END-EXEC</pre><p>Assuming the 'DEFAULT' value for the 'f1' column is '0', the contents of the target table will be:</p><pre class="border">f1 | f2---+-------0  | hello0  | hello0  | hello(3 rows)</pre><br></dd></dl><dl><dt class="em">Using ARRAY_SIZE</dt><dd><p>'FOR ARRAY_SIZE' can be used to insert the entire contents of a host array variable, without explicitly specifying the size, into the table.</p><pre class="border">01 GROUP-ITEM.05 IN-F1 PIC S9(9) OCCURS 4.MOVE 1 TO IN-F1(1)MOVE 2 TO IN-F1(2)MOVE 3 TO IN-F1(3)MOVE 4 TO IN-F1(4)...EXEC SQL FOR ARRAY_SIZE INSERT INTO target (f1) VALUES (:IN-F1) END-EXEC</pre><div class="note"><p class="title">Note</p><div class="notebody"><p>If there are multiple host array variables specified as input values, then the number of rows inserted is same as the smallest array size. The example given below demonstrates this usage.</p><pre class="border">01 GROUP-ITEM.05 IN-F1 PIC S9(9) OCCURS 4.05 IN-F3 PIC X(10) OCCURS 3.MOVE 1 TO IN-F1(1)MOVE 2 TO IN-F1(2)MOVE 3 TO IN-F1(3)MOVE 4 TO IN-F1(4)MOVE "one" TO IN-F3(1)MOVE "two" TO IN-F3(2)MOVE "three" TO IN-F3(3)...EXEC SQL FOR ARRAY_SIZE INSERT INTO target (f1,f3) VALUES (:IN-F1,:IN-F3) END-EXEC</pre><p>In the above example, the array sizes are 3 and 4. Given that the smallest array size is 3, only three rows are inserted into the table. The table contents are given below.</p><pre class="border">f1 | f3---+-------1  | one2  | two3  | three(3 rows)</pre></div></div><br></dd></dl><dl><dt class="em">Using SELECT query</dt><dd><p>The result of a SELECT query can be used to insert values.</p><pre class="border">EXEC SQL FOR 4 INSERT INTO target(f1) SELECT age FROM source WHERE name LIKE 'foo' END-EXEC</pre><p>In the example above, assuming that the SELECT query returns one row, the same row will be inserted into the table four times.</p><div class="note"><p class="title">Note</p><div class="notebody"><p>If "2" or more is specified for the FOR clause, the INSERT statement returns an error when two or more rows of query results are returned.</p><p>If "1" is specified for the FOR clause, all rows returned by the SELECT query will be inserted into the table.</p><pre class="border">EXEC SQL FOR 1 INSERT INTO target(f1) SELECT age FROM source END-EXEC</pre><p>In the example above, "1" specified for the FOR clause indicates all returned rows.</p></div></div><br></dd></dl><dl><dt class="em">Using RETURNING clause</dt><dd><p>Bulk INSERT supports the same RETURNING clause syntax as normal INSERT. An example is given below.</p><pre class="border">01 GROUP-ITEM.05 IN-F1 PIC S9(9) OCCURS 4.05 OUT-F1 PIC S9(9) OCCURS 4.MOVE 1 TO IN-F1(1)MOVE 2 TO IN-F1(2)MOVE 3 TO IN-F1(3)MOVE 4 TO IN-F1(4)...EXEC SQL FOR 3 INSERT INTO target (f1) VALUES (:IN-F1) RETURNING f1 INTO :OUT-F1 END-EXEC</pre><p>After the execution of the above INSERT statement, the 'out_f1' array will have 3 elements with the values of '1', '2' and '3'.</p></dd></dl></div></div><div class="header_footer"><div class="back_next"><a href="j2681-00-07-04-02.html"><img src="image/back2.gif" width="65" height="27" border="0" alt="Previous" title="Previous"></a><a href="j2681-00-07-04-04.html"><img src="image/next2.gif" width="64" height="27" border="0" alt="Next" title="Next"></a></div><div class="copyright">Copyright 2015-2021 FUJITSU LIMITED</div></div></body></html>