<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"><html lang="en"><head><META http-equiv="Content-Type" content="text/html; charset=UTF-8"><META CONTENT="4.3" NAME="GeneratorVersion"><title>D.7.2 sqlca</title><link rel="stylesheet" href="manualmain.css" type="TEXT/CSS"><script language="JavaScript" src="topbutton.js"></script></head><body onload="init()"><div class="topButton" id="topButton0"><a class="topButton" href="#top"><img src="image/top.gif" width="62" height="20" border="0" alt="Top" title="Top"></a></div><div class="top_header"><div class="top_header_title"><a title="Title Page" class="top_link" target="_top" HREF="index.html">Enterprise Postgres 13&nbsp;Application Development Guide</a></div><div class="top_header_graphic"><span class="top_logo"><img src="image/logo-white-fj.gif" width="148" height="32" alt=""></span><span class="top_keygraphic"><img src="image/cover-header-graphic.gif" width="148" height="32" alt="FUJITSU Software"></span></div></div><div class="header_footer"><div class="breadcrumbslist"><a href="j2681-d-00-00.html">Appendix&nbsp;D ECOBPG - Embedded SQL in COBOL</a> &gt; <a href="j2681-d-07-00.html">D.7 Error Handling</a> &gt; D.7.2 sqlca</div><div class="back_next"><a href="j2681-d-07-01.html"><img src="image/back2.gif" width="65" height="27" border="0" alt="Previous" title="Previous"></a><a href="j2681-d-07-03.html"><img src="image/next2.gif" width="64" height="27" border="0" alt="Next" title="Next"></a></div></div><h3 id="mID_0e_sqlca">D.7.2 sqlca</h3><div class="body"><div class="textblock"><p>For more powerful error handling, the embedded SQL interface provides a global variable with the name sqlca (SQL communication area) that has the following group item:</p><pre class="border">01  sqlca_t.    10 sqlcaid PIC X(8).    10 sqlabc PIC S9(9) COMP-5.    10 sqlcode PIC S9(9) COMP-5.    10 sqlerrm.        20 sqlerrml PIC S9(9) COMP-5.        20 sqlerrmc PIC X(150).    10 sqlerrp PIC X(8).    10 sqlerrd PIC S9(9) COMP-5 OCCURS 6.    10 sqlwarn PIC X(8).    10 sqlstate PIC X(5).</pre><p>(In a multithreaded program, every thread automatically gets its own copy of sqlca. This works similarly to the handling of the standard C global variable errno.)</p><p>sqlca covers both warnings and errors. If multiple warnings or errors occur during the execution of a statement, then sqlca will only contain information about the last one.</p><p>If no error occurred in the last SQL statement, SQLCODE will be 0 and SQLSTATE will be "00000". If a warning or error occurred, then SQLCODE will be negative and SQLSTATE will be different from "00000". A positive SQLCODE indicates a harmless condition, such as that the last query returned zero rows. SQLCODE and SQLSTATE are two different error code schemes; details appear below.</p><p>If the last SQL statement was successful, then SQLERRD(2) contains the OID of the processed row, if applicable, and SQLERRD(3) contains the number of processed or returned rows, if applicable to the command.</p><p>In case of an error or warning, SQLERRMC will contain a string that describes the error. The field SQLERRML contains the length of the error message that is stored in SQLERRMC (the result of FUNCTION STORED-CHAR-LENGTH. Note that some messages are too long to fit in the fixed-size sqlerrmc array; they will be truncated.</p><p>In case of a warning, the 3rd character of SQLWARN is set to W. (In all other cases, it is set to something different from W.) If the 2nd character of SQLWARN is set to W, then a value was truncated when it was stored in a host variable. The 1st character of SQLWARN is set to W if any of the other elements are set to indicate a warning.</p><p>The fields sqlcaid, sqlcabc, sqlerrp, and the remaining elements of sqlerrd and sqlwarn currently contain no useful information.</p><p>The structure sqlca is not defined in the SQL standard, but is implemented in several other SQL database systems. The definitions are similar at the core, but if you want to write portable applications, then you should investigate the different implementations carefully.</p><p>Here is one example that combines the use of WHENEVER and sqlca, printing out the contents of sqlca when an error occurs. This is perhaps useful for debugging or prototyping applications, before installing a more "user-friendly" error handler.</p><pre class="border">EXEC SQL WHENEVER SQLERROR GOTO PRINT_SQLCA END-EXEC.PRINT_SQLCA.    DISPLAY "==== sqlca ====".    DISPLAY "SQLCODE: " SQLCODE.    DISPLAY "SQLERRML: " SQLERRML.    DISPLAY "SQLERRMC: " SQLERRMC.    DISPLAY "SQLERRD: " SQLERRD(1) " " SQLERRD(2) " " SQLERRD(3)" " SQLERRD(4) " " SQLERRD(5) " " SQLERRD(6).    DISPLAY "SQLSTATE: " SQLSTATE.    DISPLAY "===============".</pre><p>The result could look as follows (here an error due to a misspelled table name):</p><pre class="border">==== sqlca ====sqlcode: -000000400SQLERRML: +000000064SQLERRMC: relation "pg_databasep" does not exist (10292) on line 93sqlerrd: +000000000 +000000000 +000000000 +000000000 +000000000 +000000000sqlstate: 42P01===============</pre><p></p></div></div><div class="header_footer"><div class="back_next"><a href="j2681-d-07-01.html"><img src="image/back2.gif" width="65" height="27" border="0" alt="Previous" title="Previous"></a><a href="j2681-d-07-03.html"><img src="image/next2.gif" width="64" height="27" border="0" alt="Next" title="Next"></a></div><div class="copyright">Copyright 2015-2021 FUJITSU LIMITED</div></div></body></html>