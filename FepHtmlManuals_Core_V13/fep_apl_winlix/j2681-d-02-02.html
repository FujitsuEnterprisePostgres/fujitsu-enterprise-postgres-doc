<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"><html lang="en"><head><META http-equiv="Content-Type" content="text/html; charset=UTF-8"><META CONTENT="4.3" NAME="GeneratorVersion"><title>D.2.2 Choosing a Connection</title><link rel="stylesheet" href="manualmain.css" type="TEXT/CSS"><script language="JavaScript" src="topbutton.js"></script></head><body onload="init()"><div class="topButton" id="topButton0"><a class="topButton" href="#top"><img src="image/top.gif" width="62" height="20" border="0" alt="Top" title="Top"></a></div><div class="top_header"><div class="top_header_title"><a title="Title Page" class="top_link" target="_top" HREF="index.html">Enterprise Postgres 13&nbsp;Application Development Guide</a></div><div class="top_header_graphic"><span class="top_logo"><img src="image/logo-white-fj.gif" width="148" height="32" alt=""></span><span class="top_keygraphic"><img src="image/cover-header-graphic.gif" width="148" height="32" alt="FUJITSU Software"></span></div></div><div class="header_footer"><div class="breadcrumbslist"><a href="j2681-d-00-00.html">Appendix&nbsp;D ECOBPG - Embedded SQL in COBOL</a> &gt; <a href="j2681-d-02-00.html">D.2 Managing Database Connections</a> &gt; D.2.2 Choosing a Connection</div><div class="back_next"><a href="j2681-d-02-01.html"><img src="image/back2.gif" width="65" height="27" border="0" alt="Previous" title="Previous"></a><a href="j2681-d-02-03.html"><img src="image/next2.gif" width="64" height="27" border="0" alt="Next" title="Next"></a></div></div><h3 id="mID_0e0202">D.2.2 Choosing a Connection</h3><div class="body"><div class="textblock"><p>SQL statements in embedded SQL programs are by default executed on the current connection, that is, the most recently opened one. If an application needs to manage multiple connections, then there are two ways to handle this.</p><p>The first option is to explicitly choose a connection for each SQL statement, for example:</p><pre class="border">EXEC SQL AT connection-name SELECT ... END-EXEC.</pre><br><p>This option is particularly suitable if the application needs to use several connections in mixed order.</p><p>If your application uses multiple threads of execution, they cannot share a connection concurrently. You must either explicitly control access to the connection (using mutexes) or use a connection for each thread. If each thread uses its own connection, you will need to use the AT clause to specify which connection the thread will use.</p><p>The second option is to execute a statement to switch the current connection. That statement is:</p><pre class="border">EXEC SQL SET CONNECTION connection-name END-EXEC.</pre><br><p>This option is particularly convenient if many statements are to be executed on the same connection. It is not thread-aware.</p><p>Here is an example program managing multiple database connections:</p><pre class="border">EXEC SQL BEGIN DECLARE SECTION END-EXEC.    01 DBNAME PIC X(7).EXEC SQL END DECLARE SECTION END-EXEC.    EXEC SQL CONNECT TO testdb1 AS con1 USER testuser END-EXEC.    EXEC SQL CONNECT TO testdb2 AS con2 USER testuser END-EXEC.    EXEC SQL CONNECT TO testdb3 AS con3 USER testuser END-EXEC.*   This query would be executed in the last opened database "testdb3".    EXEC SQL SELECT current_database() INTO :DBNAME END-EXEC.    DISPLAY "current=" DBNAME " (should be testdb3)".*   Using "AT" to run a query in "testdb2"    EXEC SQL AT con2 SELECT current_database() INTO :DBNAME END-EXEC.    DISPLAY "current=" DBNAME " (should be testdb2)".*   Switch the current connection to "testdb1".    EXEC SQL SET CONNECTION con1 END-EXEC.    EXEC SQL SELECT current_database() INTO :DBNAME END-EXEC.    DISPLAY "current=" DBNAME " (should be testdb1)".    EXEC SQL DISCONNECT ALL END-EXEC.</pre><br><p>This example would produce this output:</p><pre class="border">current=testdb3 (should be testdb3)current=testdb2 (should be testdb2)current=testdb1 (should be testdb1)</pre><p></p></div></div><div class="header_footer"><div class="back_next"><a href="j2681-d-02-01.html"><img src="image/back2.gif" width="65" height="27" border="0" alt="Previous" title="Previous"></a><a href="j2681-d-02-03.html"><img src="image/next2.gif" width="64" height="27" border="0" alt="Next" title="Next"></a></div><div class="copyright">Copyright 2015-2021 FUJITSU LIMITED</div></div></body></html>