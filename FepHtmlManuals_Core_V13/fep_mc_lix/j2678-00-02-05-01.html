<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"><html lang="en"><head><META http-equiv="Content-Type" content="text/html; charset=UTF-8"><META CONTENT="4.3" NAME="GeneratorVersion"><title>2.5.1 Setting Up Database Multiplexing Mode on the Standby Server</title><link rel="stylesheet" href="manualmain.css" type="TEXT/CSS"><script language="JavaScript" src="topbutton.js"></script></head><body onload="init()"><div class="topButton" id="topButton0"><a class="topButton" href="#top"><img src="image/top.gif" width="62" height="20" border="0" alt="Top" title="Top"></a></div><div class="top_header"><div class="top_header_title"><a title="Title Page" class="top_link" target="_top" HREF="index.html">Enterprise Postgres 13&nbsp;Cluster Operation Guide(Database Multiplexing)</a></div><div class="top_header_graphic"><span class="top_logo"><img src="image/logo-white-fj.gif" width="148" height="32" alt=""></span><span class="top_keygraphic"><img src="image/cover-header-graphic.gif" width="148" height="32" alt="FUJITSU Software"></span></div></div><div class="header_footer"><div class="breadcrumbslist"><a href="j2678-00-02-00-00.html">Chapter&nbsp;2 Setting Up Database Multiplexing Mode</a> &gt; <a href="j2678-00-02-05-00.html">2.5 Setting Up the Standby Server</a> &gt; 2.5.1 Setting Up Database Multiplexing Mode on the Standby Server</div><div class="back_next"><a href="j2678-00-02-05-00.html"><img src="image/back2.gif" width="65" height="27" border="0" alt="Previous" title="Previous"></a><a href="j2678-00-02-05-02.html"><img src="image/next2.gif" width="64" height="27" border="0" alt="Next" title="Next"></a></div></div><h3 id="mID_060401">2.5.1 Setting Up Database Multiplexing Mode on the Standby Server<a name="N42G"></a></h3><div class="body"><div class="textblock"><p>This section explains how to set up database multiplexing mode on the standby server.</p><p>In database multiplexing, the files that are required for operations are managed in the Mirroring Controller management directory.</p><p>There is one Mirroring Controller management directory for each instance.</p><div class="note"><p class="title">Note</p><div class="notebody"><ul><li><p>Do not place the Mirroring Controller management directory in a directory managed by FUJITSU Enterprise Postgres, otherwise it may be deleted by mistake with the directories managed by FUJITSU Enterprise Postgres, and an old version of files may be restored.</p></li><li><p>When creating a standby server for a large database, stop job system operations, specify a large value for the wal_keep_size parameter, or use replication slots.<br>This is because WALs generated after the standby server is built using the pg_basebackup command, but before it is started, need to be retained. However, the number of WAL segments that can be retained is constrained by the wal_keep_size parameter.<br>Additionally, setting the wal_keep_size parameter requires consideration regarding stabilization of the database multiplexing mode (refer to "<a href="j2678-00-02-11-01.html">2.11.1 Tuning to Stabilize the Database Multiplexing Mode</a>" for details).</p></li></ul></div></div><div class="ref"><p class="title">See</p><div class="refbody"><ul><li><p>Refer to "Preparing Directories for Resource Deployment" in the Installation and Setup Guide for Server for details on the directories that are managed by FUJITSU Enterprise Postgres.</p></li><li><p>Refer to "pg_basebackup" in "Reference" in the PostgreSQL Documentation for information on the pg_basebackup command.</p></li><li><p>Refer to "mc_ctl" in Reference for information on the command.</p></li><li><p>Refer to "<a href="j2678-a-00-00.html">Appendix&nbsp;A Parameters</a>" for details on each parameter to be edited for the setup.</p></li><li><p>Refer to "Replication Slots" in the PostgreSQL Documentation for information on replication slots.</p></li></ul></div></div><p>Perform the following procedure:</p><ol><li><p>Log in to the standby server.</p></li><li><p>Create the Mirroring Controller management directory that will store the files required by database multiplexing.</p><p>Use ASCII characters in the Mirroring Controller management directory.</p><p>Additionally, grant "Write" permission to the instance administrator user for the Mirroring Controller management directory.</p></li><li><p>Copy, and then deploy, the network.conf file of the primary server.</p><p>Copy the network.conf file that was defined in the primary server setup, and deploy it to the Mirroring Controller management directory of the standby server.</p><p>Set read and write permissions for the instance administrator user only. If users other than the instance administrator user are granted access, the mc_ctl command will not work. Accordingly, users other than the instance administrator user are prevented from operating Mirroring Controller.</p><p>Register in /etc/services the port number of the standby server that was specified in the network.conf file, because programs such as WebAdmin use it to search for available port numbers.</p><p>Register any name as the service name.</p></li><li><p>Copy, and then deploy, the <span class="i">serverIdentifier</span>.conf file of the primary server.</p><p>Copy the <span class="i">serverIdentifier</span>.conf file that was defined in the primary server setup, and deploy it to the Mirroring Controller management directory of the standby server.</p><p>Set read and write permissions for the instance administrator user only. If users other than the instance administrator user are granted access permissions, the mc_ctl command will not work.</p></li></ol><p></p></div></div><div class="header_footer"><div class="back_next"><a href="j2678-00-02-05-00.html"><img src="image/back2.gif" width="65" height="27" border="0" alt="Previous" title="Previous"></a><a href="j2678-00-02-05-02.html"><img src="image/next2.gif" width="64" height="27" border="0" alt="Next" title="Next"></a></div><div class="copyright">Copyright 2016-2021 FUJITSU LIMITED</div></div></body></html>