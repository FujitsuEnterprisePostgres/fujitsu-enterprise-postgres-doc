<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"><html lang="en"><head><META http-equiv="Content-Type" content="text/html; charset=UTF-8"><META CONTENT="4.3" NAME="GeneratorVersion"><title>2.12 Setting Automatic Start and Stop of Mirroring Controller and Multiplexed Instances</title><link rel="stylesheet" href="manualmain.css" type="TEXT/CSS"><script language="JavaScript" src="topbutton.js"></script></head><body onload="init()"><div class="topButton" id="topButton0"><a class="topButton" href="#top"><img src="image/top.gif" width="62" height="20" border="0" alt="Top" title="Top"></a></div><div class="top_header"><div class="top_header_title"><a title="Title Page" class="top_link" target="_top" HREF="index.html">Enterprise Postgres 13&nbsp;Cluster Operation Guide(Database Multiplexing)</a></div><div class="top_header_graphic"><span class="top_logo"><img src="image/logo-white-fj.gif" width="148" height="32" alt=""></span><span class="top_keygraphic"><img src="image/cover-header-graphic.gif" width="148" height="32" alt="FUJITSU Software"></span></div></div><div class="header_footer"><div class="breadcrumbslist"><a href="j2678-00-02-00-00.html">Chapter&nbsp;2 Setting Up Database Multiplexing Mode</a> &gt; 2.12 Setting Automatic Start and Stop of Mirroring Controller and Multiplexed Instances</div><div class="back_next"><a href="j2678-00-02-11-04.html"><img src="image/back2.gif" width="65" height="27" border="0" alt="Previous" title="Previous"></a><a href="j2678-00-02-13-00.html"><img src="image/next2.gif" width="64" height="27" border="0" alt="Next" title="Next"></a></div></div><h2 id="mID_0610">2.12 Setting Automatic Start and Stop of Mirroring Controller and Multiplexed Instances<a name="N57G"></a></h2><div class="body"><div class="textblock"><p>Multiplexed instances and Mirroring Controller can be started and stopped automatically in line with the starting and stopping of the operating system of the database server.</p><div class="note"><p class="title">Note</p><div class="notebody"><p>To guarantee the startup sequence of Mirroring Controller on the primary and standby servers, first confirm that the primary server has started, and then start the standby servers in sequence.</p><p>The startup sequence of the Mirroring Controller process on the database server and the Mirroring Controller arbitration process on the arbitration server is not guaranteed. If the arbitration server cannot be started first, execute the mc_ctl command in start mode with the --async-connect-arbiter option specified to start the Mirroring Controller process.</p><p>If you start the Mirroring Controller and multiplexed instances, wait for time correction, network setup, and so on.</p></div></div><p>Perform the following procedure:</p><ol><li><p>Create a unit file</p><p>Copy the unit file sample stored in the directory below, and revise it to match the target instance.</p><pre>Sample file</pre><pre class="border">/<span class="i">installDir</span>/share/mcoi.service.sample</pre><pre>Example)</pre><pre>In the following example, the installation directory is "/opt/fsepv&lt;<span class="i">x</span>&gt;server64", and the instance name is "inst1". Note that "&lt;<span class="i">x</span>&gt;" indicates the product version.</pre><pre class="border"># cp /opt/fsepv&lt;<span class="i">x</span>&gt;server64/share/mcoi.service.sample /usr/lib/systemd/system/mcoi_inst1.service</pre><p>Revise the underlined portions of the options below in the unit file.</p><table><col><col><col><col><tr><th valign="top"><p>Section</p></th><th valign="top"><p>Option</p></th><th valign="top"><p>Specified value</p></th><th valign="top"><p>Description</p></th></tr><tr><td align="left" valign="top"><p>Unit</p></td><td align="left" valign="top"><p>Description</p></td><td align="left" valign="top"><p>FUJITSU Enterprise Postgres MirroringController <span class="i"><span class="u">instanceName</span></span></p></td><td align="left" valign="top"><p>Specifies the feature overview.</p><p>Specifies the name of the target instance. <span class="inline-note">*1</span></p></td></tr><tr><td rowspan="4" align="left" valign="top"><p>Service</p></td><td align="left" valign="top"><p>ExecStart</p></td><td align="left" valign="top"><p>/bin/bash -c '<span class="i"><span class="u">installDir</span></span>/bin/mc_std start <span class="i"><span class="u">installDir</span></span> <span class="i"><span class="u">MirroringControllerManagementDir</span></span>' <span class="i"><span class="u">mc_ctlOption</span></span><span class="u">'</span></p></td><td align="left" valign="top"><p>Command to be executed when the service is started.</p><p>Specify the option you want to add when the mc_ctl command is executed without the -M option in the mc_ctl option.</p><p>Note that the content specified in this mc_ctl option is carried over from the mc_std command to the mc_ctl command. <span class="inline-note">*2</span></p></td></tr><tr><td align="left" valign="top"><p>ExecStop</p></td><td align="left" valign="top"><p>/bin/bash -c '<span class="i"><span class="u">installDir</span></span>/bin/mc_std stop <span class="i"><span class="u">installDir</span></span> <span class="i"><span class="u">MirroringControllerManagementDir</span></span><span class="i">'</span> <span class="i"><span class="u">mc_ctlOption</span></span><span class="u">'</span></p></td><td align="left" valign="top"><p>Command to be executed when the service is stopped.</p><p>Specify the option you want to add when the mc_ctl command is executed without the -M option in the mc_ctl option.</p><p>However, to use the --mc-only option to stop only Mirroring Controller, you must use the --mc-only option at startup.</p><p>Note that the content specified in this mc_ctl option is carried over from the mc_std command to the mc_ctl command.</p></td></tr><tr><td align="left" valign="top"><p>User</p></td><td align="left" valign="top"><p><span class="u">User</span></p></td><td align="left" valign="top"><p>OS user account of the instance administrator user.</p></td></tr><tr><td align="left" valign="top"><p>Group</p></td><td align="left" valign="top"><p><span class="u">Group</span></p></td><td align="left" valign="top"><p>Group to which the instance administrator user belongs.</p></td></tr></table><p>*1: The instance name should be as nameThatIdentifiesTheInstance.<br>The naming conventions for identifying the instance are as follows:</p><ul><li><p>Up to 16 bytes</p></li><li><p>The first character must be an ASCII alphabetic character</p></li><li><p>The other characters must be ASCII alphanumeric characters</p></li></ul><p>*2: When the arbitration server is used for automatic degradation, start the Mirroring Controller arbitration process on the arbitration server and then start the Mirroring Controller process on the database server. If the arbitration server cannot be started first, specify the --async-connect-arbiter option to start the Mirroring Controller process.</p></li><li><p>Enable automatic start and stop</p><p>As the OS superuser, use the systemctl command to enable automatic start and stop.</p><pre>Example)</pre><pre class="border"># systemctl enable mcoi_inst1.service</pre></li></ol><div class="note"><p class="title">Note</p><div class="notebody"><p>If automatic start and stop of Mirroring Controller has been configured, to stop Mirroring Controller, do not use the mc_ctl command, but instead use the systemctl command as the OS superuser.</p><p>Example)</p><pre class="border"># systemctl stop mcoi_inst1.service</pre><p>If the instance does not stop, refer to "Actions in Response to Failure to Stop an Instance" in the Operation Guide to stop the instance. Then, specify the -e option in the mc_ctl command to forcibly stop Mirroring Controller.</p><p>Example)</p><pre class="border">$ mc_ctl stop -M /mcdir/inst1 -e</pre><p>If Mirroring Controller is stopped using the mc_ctl command, the message below is output to the system log, however there is no issue because automatic stop is executed by systemd.</p><p>Message</p><pre class="border">FATAL: failed to stop Mirroring Controller target server:"{0}" (MCA00043)</pre></div></div><dl><dd></dd></dl><dl><dd><dl><dd></dd></dl><dl><dd></dd></dl></dd></dl><p></p></div></div><div class="header_footer"><div class="back_next"><a href="j2678-00-02-11-04.html"><img src="image/back2.gif" width="65" height="27" border="0" alt="Previous" title="Previous"></a><a href="j2678-00-02-13-00.html"><img src="image/next2.gif" width="64" height="27" border="0" alt="Next" title="Next"></a></div><div class="copyright">Copyright 2016-2021 FUJITSU LIMITED</div></div></body></html>