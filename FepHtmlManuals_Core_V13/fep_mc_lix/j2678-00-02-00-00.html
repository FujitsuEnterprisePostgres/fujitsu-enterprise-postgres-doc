<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"><html lang="en"><head><META http-equiv="Content-Type" content="text/html; charset=UTF-8"><META CONTENT="4.3" NAME="GeneratorVersion"><title>Chapter&nbsp;2 Setting Up Database Multiplexing Mode</title><link rel="stylesheet" href="manualmain.css" type="TEXT/CSS"><script language="JavaScript" src="topbutton.js"></script></head><body onload="init()"><div class="topButton" id="topButton0"><a class="topButton" href="#top"><img src="image/top.gif" width="62" height="20" border="0" alt="Top" title="Top"></a></div><div class="top_header"><div class="top_header_title"><a title="Title Page" class="top_link" target="_top" HREF="index.html">Enterprise Postgres 13&nbsp;Cluster Operation Guide(Database Multiplexing)</a></div><div class="top_header_graphic"><span class="top_logo"><img src="image/logo-white-fj.gif" width="148" height="32" alt=""></span><span class="top_keygraphic"><img src="image/cover-header-graphic.gif" width="148" height="32" alt="FUJITSU Software"></span></div></div><div class="header_footer"><div class="breadcrumbslist">Chapter&nbsp;2 Setting Up Database Multiplexing Mode</div><div class="back_next"><a href="j2678-00-01-04-02.html"><img src="image/back2.gif" width="65" height="27" border="0" alt="Previous" title="Previous"></a><a href="j2678-00-02-01-00.html"><img src="image/next2.gif" width="64" height="27" border="0" alt="Next" title="Next"></a></div></div><h1 id="mID_06">Chapter&nbsp;2 Setting Up Database Multiplexing Mode<a name="N18G"></a></h1><div class="body"><div class="textblock"><p>This chapter describes how to set up database multiplexing mode, and how to check it.</p><p></p></div><p class="subhead_1" id="IDclust06N1"><span class="em">Users who perform setup and operations on the database server</span><a name="N19G"></a></p><div class="textblock"><p>Setup and operations of the database server must be performed by the instance administrator user.</p></div><p class="subhead_1" id="IDclust06N2"><span class="em">Users who perform setup and operations on the arbitration server</span><a name="N20G"></a></p><div class="textblock"><p>The following users may perform setup and operations on the arbitration server when it is used for automatic degradation.</p><dl><dd></dd></dl><dl><dt class="em">Linux</dt><dd><p>Any operating system user.</p></dd></dl><dl><dt class="em">Windows</dt><dd><p>Any user with administrator privileges. This user must be assigned the "Log on as a service" user right.</p></dd></dl><div class="point"><p class="title">Point</p><div class="pointbody"><ul><li><p>Mirroring Controller selects a database superuser as the user who will connect to the database instance. This enables instance administrator users and database superusers who operate the Mirroring Controller commands to run database multiplexing mode in different environments.</p></li><li><p>The application name for connecting to the database instance is "mc_agent".</p></li></ul></div></div></div><p class="subhead_1" id="IDclust06N3"><span class="em">Matching the system times</span><a name="N21G"></a><span class="em"></span></p><div class="textblock"><p>Before starting the setup, ensure that the times in the primary server, standby server and arbitration server match, by using the operating system time synchronization feature, for example.</p><p>The tolerated difference is approximately one second.</p><p>If the system times are not synchronized (because the tolerated difference is exceeded, for example), problem investigation may be affected.</p></div><p class="subhead_1" id="IDclust06N4"><span class="em">Configuring ICMP</span><a name="N22G"></a></p><div class="textblock"><p>Because the ping command of the operating system is used for heartbeat monitoring of the database server, configure the network so that ICMP can be used on the admin network and the arbitration network. Refer to the relevant operating system procedure for details.</p></div><p class="subhead_1" id="IDclust06N5"><span class="em">Setup</span><a name="N23G"></a><span class="em"></span></p><div class="textblock"><p>The setup procedure is shown in the table below. However, the procedure on the arbitration server should be performed only when the arbitration server is used for automatic degradation. A distinction is made between the procedures on the primary server and standby server according to whether the arbitration server is used.</p><table><col><col><col><col><col><tr><th rowspan="2" valign="middle"><p>Step</p></th><th colspan="3" valign="middle"><p>Task</p></th><th rowspan="2" valign="middle"><p>Refer to</p></th></tr><tr><th valign="top"><p>Primary server</p></th><th valign="top"><p>Standby server</p></th><th valign="middle"><p>Arbitration server</p></th></tr><tr><td align="center" valign="middle"><p>1</p></td><td colspan="3" align="center" valign="middle"><p>Installation</p></td><td align="left" valign="top"><p><a href="j2678-00-02-01-00.html">2.1 Installation</a></p></td></tr><tr><td align="center" valign="middle"><p>2</p></td><td colspan="2" align="center" valign="middle"><p>Preparing the database server</p></td><td align="center" valign="middle"><p>Preparing the arbitration server</p></td><td align="left" valign="top"><p><a href="j2678-00-02-02-00.html">2.2 Preparing for Setup</a></p></td></tr><tr><td align="center" valign="middle"><p>3</p></td><td align="center" valign="middle"></td><td align="center" valign="middle"></td><td align="center" valign="top"><p>Configuring the arbitration server</p></td><td align="left" valign="top"><p><a href="j2678-00-02-03-01.html">2.3.1 Configuring the Arbitration Server</a></p></td></tr><tr><td align="center" valign="middle"><p>4</p></td><td align="center" valign="middle"></td><td align="center" valign="middle"></td><td align="center" valign="top"><p>Creating a user exit</p></td><td align="left" valign="top"><p><a href="j2678-00-02-03-02.html">2.3.2 Creating a User Exit for the Arbitration Server</a></p></td></tr><tr><td align="center" valign="middle"><p>5</p></td><td align="center" valign="middle"></td><td align="center" valign="middle"></td><td align="center" valign="top"><p>Starting the arbitration process</p></td><td align="left" valign="top"><p><a href="j2678-00-02-03-03.html">2.3.3 Starting the Mirroring Controller Arbitration Process</a></p></td></tr><tr><td align="center" valign="middle"><p>6</p></td><td align="center" valign="middle"><p>Setting up database multiplexing mode</p></td><td align="center" valign="middle"></td><td align="center" valign="middle"></td><td align="left" valign="top"><p><a href="j2678-00-02-04-01.html">2.4.1 Setting Up Database Multiplexing Mode on the Primary Server</a></p></td></tr><tr><td align="center" valign="middle"><p>7</p></td><td align="center" valign="middle"><p>Creating, setting, and registering the instance</p></td><td align="center" valign="middle"></td><td align="center" valign="middle"></td><td align="left" valign="top"><p><a href="j2678-00-02-04-02.html">2.4.2 Creating, Setting, and Registering the Primary Server Instance</a></p></td></tr><tr><td align="center" valign="middle"><p>8</p></td><td align="center" valign="middle"><p>Creating a user exit</p></td><td align="center" valign="middle"></td><td align="center" valign="middle"></td><td align="left" valign="top"><p><a href="j2678-00-02-06-00.html">2.6 Creating a User Exit for a Database Server</a></p></td></tr><tr><td align="center" valign="middle"><p>9</p></td><td align="center" valign="middle"><p>Starting Mirroring Controller</p></td><td align="center" valign="middle"></td><td align="center" valign="middle"></td><td align="left" valign="top"><p><a href="j2678-00-02-04-03.html">2.4.3 Starting Mirroring Controller on the Primary Server</a></p></td></tr><tr><td align="center" valign="middle"><p>10</p></td><td align="center" valign="middle"></td><td align="center" valign="middle"><p>Setting up database multiplexing mode</p></td><td align="center" valign="middle"></td><td align="left" valign="top"><p><a href="j2678-00-02-05-01.html">2.5.1 Setting Up Database Multiplexing Mode on the Standby Server</a></p></td></tr><tr><td align="center" valign="middle"><p>11</p></td><td align="center" valign="middle"></td><td align="center" valign="middle"><p>Creating, setting, and registering the instance</p></td><td align="center" valign="middle"></td><td align="left" valign="top"><p><a href="j2678-00-02-05-02.html">2.5.2 Creating, Setting, and Registering the Standby Server Instance</a></p></td></tr><tr><td align="center" valign="middle"><p>12</p></td><td align="center" valign="middle"></td><td align="center" valign="middle"><p>Creating a user exit</p></td><td align="center" valign="middle"></td><td align="left" valign="top"><p><a href="j2678-00-02-06-00.html">2.6 Creating a User Exit for a Database Server</a></p></td></tr><tr><td align="center" valign="middle"><p>13</p></td><td align="center" valign="middle"></td><td align="center" valign="middle"><p>Starting Mirroring Controller</p></td><td align="center" valign="middle"></td><td align="left" valign="top"><p><a href="j2678-00-02-05-03.html">2.5.3 Starting Mirroring Controller on the Standby Server</a></p></td></tr><tr><td align="center" valign="middle"><p>14</p></td><td align="center" valign="middle"><p>Confirming the streaming replication status</p></td><td align="center" valign="middle"></td><td align="center" valign="middle"></td><td align="left" valign="top"><p><a href="j2678-00-02-07-00.html">2.7 Confirming the Streaming Replication Status</a></p></td></tr><tr><td align="center" valign="middle"><p>15</p></td><td align="center" valign="middle"><p>Checking the connection status</p></td><td align="center" valign="middle"></td><td align="center" valign="middle"></td><td align="left" valign="top"><p><a href="j2678-00-02-08-01.html">2.8.1 Checking the Connection Status on a Database Server</a></p></td></tr><tr><td align="center" valign="middle"><p>16</p></td><td align="center" valign="middle"></td><td align="center" valign="middle"><p>Checking the connection status</p></td><td align="center" valign="middle"></td><td align="left" valign="top"><p><a href="j2678-00-02-08-01.html">2.8.1 Checking the Connection Status on a Database Server</a></p></td></tr><tr><td align="center" valign="middle"><p>17</p></td><td align="center" valign="middle"></td><td align="center" valign="middle"></td><td align="center" valign="middle"><p>Checking the connection status</p></td><td align="left" valign="top"><p><a href="j2678-00-02-08-02.html">2.8.2 Checking the Connection Status on the Arbitration Server</a></p></td></tr><tr><td align="center" valign="middle"><p>18</p></td><td align="center" valign="middle"><p>Creating applications</p></td><td align="center" valign="middle"></td><td align="center" valign="middle"></td><td align="left" valign="top"><p><a href="j2678-00-02-09-00.html">2.9 Creating Applications</a></p></td></tr><tr><td align="center" valign="middle"><p>19</p></td><td align="center" valign="middle"><p>Checking the behavior</p></td><td align="center" valign="middle"></td><td align="center" valign="middle"></td><td align="left" valign="top"><p><a href="j2678-00-02-10-00.html">2.10 Checking the Behavior</a></p></td></tr></table><p>Explanations for each step are provided below.</p><div class="tips"><p class="title">Information</p><div class="tipsbody"><ul><li><p>The setup procedure is also the same when changing the mode on a single server to database multiplexing mode. In this case, omit the installation of FUJITSU Enterprise Postgres and the creation of the instance.</p><p>Refer to "<a href="j2678-00-03-09-02.html">3.9.2 Changing from Single Server Mode to Database Multiplexing Mode</a>" for details.</p></li><li><p>The primary and standby server can be pseudo-configured on the same server for system testing, for example. In this case, the setup can be performed using the same procedure, however there will be some supplementary steps.</p><p>Before performing the setup, refer to "<a href="j2678-b-00-00.html">Appendix&nbsp;B Supplementary Information on Building the Primary Server and Standby Server on the Same Server</a>".</p></li></ul></div></div></div></div><div class="header_footer"><div class="back_next"><a href="j2678-00-01-04-02.html"><img src="image/back2.gif" width="65" height="27" border="0" alt="Previous" title="Previous"></a><a href="j2678-00-02-01-00.html"><img src="image/next2.gif" width="64" height="27" border="0" alt="Next" title="Next"></a></div><div class="copyright">Copyright 2016-2021 FUJITSU LIMITED</div></div></body></html>