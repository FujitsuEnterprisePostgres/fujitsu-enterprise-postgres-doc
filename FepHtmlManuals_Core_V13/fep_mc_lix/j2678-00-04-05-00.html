<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"><html lang="en"><head><META http-equiv="Content-Type" content="text/html; charset=UTF-8"><META CONTENT="4.3" NAME="GeneratorVersion"><title>4.5 Recovering from an Incorrect User Operation</title><link rel="stylesheet" href="manualmain.css" type="TEXT/CSS"><script language="JavaScript" src="topbutton.js"></script></head><body onload="init()"><div class="topButton" id="topButton0"><a class="topButton" href="#top"><img src="image/top.gif" width="62" height="20" border="0" alt="Top" title="Top"></a></div><div class="top_header"><div class="top_header_title"><a title="Title Page" class="top_link" target="_top" HREF="index.html">Enterprise Postgres 13&nbsp;Cluster Operation Guide(Database Multiplexing)</a></div><div class="top_header_graphic"><span class="top_logo"><img src="image/logo-white-fj.gif" width="148" height="32" alt=""></span><span class="top_keygraphic"><img src="image/cover-header-graphic.gif" width="148" height="32" alt="FUJITSU Software"></span></div></div><div class="header_footer"><div class="breadcrumbslist"><a href="j2678-00-04-00-00.html">Chapter&nbsp;4 Action Required when an Error Occurs in Database Multiplexing Mode</a> &gt; 4.5 Recovering from an Incorrect User Operation</div><div class="back_next"><a href="j2678-00-04-04-00.html"><img src="image/back2.gif" width="65" height="27" border="0" alt="Previous" title="Previous"></a><a href="j2678-00-05-00-00.html"><img src="image/next2.gif" width="64" height="27" border="0" alt="Next" title="Next"></a></div></div><h2 id="mID_0805">4.5 Recovering from an Incorrect User Operation<a name="N106G"></a></h2><div class="body"><div class="textblock"><p>This section describes how to recover an instance when data has been corrupted due to incorrect user operation.</p><p>For example, when data has been corrupted due to incorrect user operation, such as data being unintentionally changed or deleted by an application or command, it is necessary to restore the original data on the primary server and resynchronize with the standby server.</p><p>Use the following procedure to perform recovery.</p><ol><li><p>Identify the primary server</p><p>Execute the mc_ctl command in status mode on each server, and search for a server for which "primary" or "none(inactivated primary)" is displayed.</p></li><li><p>Stop the applications and commands that caused the incorrect operation to occur</p><p>Stop applications and commands that are running on the primary server. This will minimize the impact caused by the incorrect data.</p><p>Also, if any applications used for reference by the standby server are running, stop them too.</p></li><li><p>Stop the instance and Mirroring Controller</p><p>Stop the instance and Mirroring Controller on both the primary server and standby server.</p><pre>Example)</pre><pre class="border">$ mc_ctl stop -a -M /mcdir/inst1</pre></li><li><p>Recover the database on the primary server</p><p>Recover the database using the recovery method in which the pgx_rcvall command uses the backup data to recover the database to a restore point prior to the time when the incorrect operation was performed.</p><div class="ref"><p class="title">See</p><div class="refbody"><p>Refer to "Recovering from an Incorrect User Operation" in the Operation Guide for information on using the pgx_rcvall command to recover the database to a restore point, and then perform only the database recovery procedure while the instance is in a stop state.</p></div></div></li><li><p>Start the instance and Mirroring Controller</p><p>Start the instance and Mirroring Controller on the primary server.</p><dl><dt class="em">Enabling automatic switch/disconnection</dt><dd><p>As the instance administrator user, execute the mc_ctl command in start mode.</p><pre>Example)</pre><pre class="border">$ mc_ctl start -M /mcdir/inst1</pre></dd></dl><dl><dt class="em">Disabling automatic switch/disconnection</dt><dd><p>As the instance administrator user, execute the mc_ctl command in start mode with the -F option specified.</p><pre>Example)</pre><pre class="border">$ mc_ctl start -M /mcdir/inst1 -F</pre></dd></dl><div class="point"><p class="title">Point</p><div class="pointbody"><p>After Mirroring Controller is started, automatic switch/disconnection can be enabled or disabled using the enable-failover or disable-failover mode of the mc_ctl command.</p></div></div></li><li><p>Build the new standby server</p><p>Refer to "<a href="j2678-00-02-05-00.html">2.5 Setting Up the Standby Server</a>" for information on building (setting up) a standby server from the primary server.</p></li></ol><p></p></div></div><div class="header_footer"><div class="back_next"><a href="j2678-00-04-04-00.html"><img src="image/back2.gif" width="65" height="27" border="0" alt="Previous" title="Previous"></a><a href="j2678-00-05-00-00.html"><img src="image/next2.gif" width="64" height="27" border="0" alt="Next" title="Next"></a></div><div class="copyright">Copyright 2016-2021 FUJITSU LIMITED</div></div></body></html>