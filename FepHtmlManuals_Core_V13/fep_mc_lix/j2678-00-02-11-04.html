<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"><html lang="en"><head><META http-equiv="Content-Type" content="text/html; charset=UTF-8"><META CONTENT="4.3" NAME="GeneratorVersion"><title>2.11.4 Tuning for Optimization of Degradation Using Abnormality Monitoring</title><link rel="stylesheet" href="manualmain.css" type="TEXT/CSS"><script language="JavaScript" src="topbutton.js"></script></head><body onload="init()"><div class="topButton" id="topButton0"><a class="topButton" href="#top"><img src="image/top.gif" width="62" height="20" border="0" alt="Top" title="Top"></a></div><div class="top_header"><div class="top_header_title"><a title="Title Page" class="top_link" target="_top" HREF="index.html">Enterprise Postgres 13&nbsp;Cluster Operation Guide(Database Multiplexing)</a></div><div class="top_header_graphic"><span class="top_logo"><img src="image/logo-white-fj.gif" width="148" height="32" alt=""></span><span class="top_keygraphic"><img src="image/cover-header-graphic.gif" width="148" height="32" alt="FUJITSU Software"></span></div></div><div class="header_footer"><div class="breadcrumbslist"><a href="j2678-00-02-00-00.html">Chapter&nbsp;2 Setting Up Database Multiplexing Mode</a> &gt; <a href="j2678-00-02-11-00.html">2.11 Tuning</a> &gt; 2.11.4 Tuning for Optimization of Degradation Using Abnormality Monitoring</div><div class="back_next"><a href="j2678-00-02-11-03.html"><img src="image/back2.gif" width="65" height="27" border="0" alt="Previous" title="Previous"></a><a href="j2678-00-02-12-00.html"><img src="image/next2.gif" width="64" height="27" border="0" alt="Next" title="Next"></a></div></div><h3 id="mID_060904">2.11.4 Tuning for Optimization of Degradation Using Abnormality Monitoring<a name="N56G"></a></h3><div class="body"><div class="textblock"><p>Mirroring Controller uses a monitoring method that outputs an error if the timeout or number of retries is exceeded when accessing resources targeted for monitoring. Setting inappropriate values in these settings may lead to misdetection or a delay in automatic degradation, so you must design these values appropriately.</p><p>For example, the following type of issue occurs if the tuning related to abnormality monitoring is not performed appropriately.</p><ul><li><p>If the timeout is too short</p><p>Results in redundant degradation and availability falls.</p></li><li><p>If the timeout is too long</p><p>It takes longer for automatic degradation to be performed even when an error affecting operational continuity occurs, potentially causing downtime.</p></li></ul><p>You can optimize degrading operation by editing the values for the parameters in the server configuration file described below in accordance with the system. Refer to "<a href="j2678-a-04-00.html">A.4 Server Configuration File</a>" for information on how to edit these parameters.</p><p></p></div></div><h4 id="mID_06110401">2.11.4.1 Tuning for Abnormality Monitoring of the Operating System or Server</h4><div class="body"><div class="textblock"><p>Tuning for abnormal monitoring of the operating system or server depends on the operation when heartbeat abnormality is detected by the heartbeat monitoring of operating systems or servers.</p><div class="ref"><p class="title">See</p><div class="refbody"><p>Refer to "<a href="j2678-00-01-01-01.html">1.1.1 Monitoring Using Database Multiplexing Mode</a>" for the operation when heartbeat abnormality is detected in the the heartbeat monitoring of operating systems or servers.</p></div></div><br></div></div><h5 id="mID_0611040101">2.11.4.1.1 Tuning Abnormality Monitoring for Operations that Use an Arbitration Server for Automatic Degeneration</h5><div class="body"><div class="textblock"><p>In an operation that use an arbitration server for automatic degeneration, the database server is periodically monitored for abnormalities so that the Mirroring Controller arbitration process can immediately respond to an arbitration request from the Mirroring Controller.The automatic degradation using the arbitration server can optimize the time from error detection to automatic degradation of the operating systems or servers by editing the following parameters.</p><ul><li><p><a href="j2678-00-02-11-04.html#mID_0611040101_p1">Parameters for the abnormality monitoring of the operating system or server in the server configuration file of the database server</a></p></li><li><p><a href="j2678-00-02-11-04.html#mID_0611040101_p2">Parameters for the abnormality monitoring of the operating system or server in the arbitration configuration file</a></p></li><li><p><a href="j2678-00-02-11-04.html#mID_0611040101_p3">Parameters for the arbitration processing and fencing</a></p></li></ul></div><p class="subhead_1" id="mID_0611040101_p1"><span class="em">Parameters for the </span><span class="em">abnormality monitoring of the operating system or</span><span class="em"> </span><span class="em">server</span><span class="em"> in the </span><span class="em">server configuration file of the database server</span></p><div class="textblock"><table><caption>Table&nbsp;2.10 Parameters for the abnormality monitoring of the operating system or server in the server configuration file of the database server</caption><col><col><tr><th valign="top"><p>Parameter</p></th><th valign="top"><p>Description</p></th></tr><tr><td align="left" valign="top"><p>Abnormality monitoring interval<br>(heartbeat_interval)</p></td><td align="left" valign="top"><p>Mirroring Controller is configured so that abnormality monitoring does not place a load on the system. This parameter does not normally need to be set. (The default is 800 milliseconds.)</p></td></tr><tr><td align="left" valign="top"><p>Abnormality monitoring timeout<br>(heartbeat_timeout)</p></td><td align="left" valign="top"><p>Take into account the time during which a load is placed continuously on the server or admin network performance. For example, it is envisaged that this parameter will be used in situations such as when performing high-load batch jobs or when a large number of online jobs occur continuously and concurrently. (The default is 1 second.)</p></td></tr><tr><td align="left" valign="top"><p>Abnormality monitoring retries<br>(heartbeat_retry)</p></td><td align="left" valign="top"><p>This parameter can be set when needing a safety value for situations in which the value specified for heartbeat_timeout is exceeded, for example, when using systems with fluctuating loads, however, this parameter does not normally need to be set. (The default is 2 times.)</p></td></tr></table><p><img src="clust06img/e-0609-tuning1.gif" alt="" width="727" height="446"></p><br><p>The expression for calculating the time required to detect an abnormality by Mirroring Controller is shown below.</p><pre class="border">Abnormality detection time of Mirroring Controller = ( heartbeat_timeout(seconds) + heartbeat_interval(milliseconds) / 1000 ) x ( heartbeat_retry(number of times) + 1)</pre><br><p>The abnormality detection time when the default value is used is shown below.</p><pre class="border">Abnormality detection time of Mirroring Controller = ( 1 + 800 / 1000 ) x ( 2 + 1 )             = 5.4(seconds)</pre><br></div><p class="subhead_1" id="mID_0611040101_p2"><span class="em">Parameters for the </span><span class="em">abnormality monitoring of the operating system or</span><span class="em"> </span><span class="em">server</span><span class="em"> in the arbitration configuration file</span></p><div class="textblock"><table><caption>Table&nbsp;2.11 Parameters for the abnormality monitoring of the operating system or server in the arbitration configuration file</caption><col><col><tr><th valign="top"><p>Parameter</p></th><th valign="top"><p>Description</p></th></tr><tr><td align="left" valign="top"><p>Abnormality monitoring interval<br>(heartbeat_interval)</p></td><td align="left" valign="top"><p>Mirroring Controller arbitration process is configured so that abnormality monitoring does not place a load on the system. This parameter does not normally need to be set. (The default is the value set in heartbeat_interval in the server configuration file of the database server.) (milliseconds).</p></td></tr><tr><td align="left" valign="top"><p>Abnormality monitoring timeout<br>(heartbeat_timeout)</p></td><td align="left" valign="top"><p>Take into account the time during which a load is placed continuously on the server and arbitration network capabilities. (The default is the value set in heartbeat_timeout in the server configuration file of the database server.) (seconds).</p></td></tr><tr><td align="left" valign="top"><p>Abnormality monitoring retries<br>(heartbeat_retry)</p></td><td align="left" valign="top"><p>This parameter can be set when needing a safety value for situations in which the value specified for heartbeat_timeout is exceeded, for example, when using systems with fluctuating loads, however, this parameter does not normally need to be set. (The default is the value set in heartbeat_retry in the server configuration file of the database server.) (number of times)</p></td></tr></table><p><img src="clust06img/e-06-tuning-arbiter-abnomality-monitoring.gif" alt="" width="746" height="554"></p><br><p>The expression for calculating the time required to detect an abnormality by Mirroring Controller arbitration process is shown below.</p><pre class="border">Abnormality detection time of Mirroring Controller arbitration process = ( heartbeat_timeout(seconds) + heartbeat_interval(milliseconds) / 1000 ) x ( heartbeat_retry(number of times) + 1)</pre><br><p>The abnormality detection time when the default value is used is shown below.</p><pre class="border">Abnormality detection time of Mirroring Controller arbitration process = ( 1 + 800 / 1000 ) x ( 2 + 1 )             = 5.4(seconds)</pre><div class="point"><p class="title">Point</p><div class="pointbody"><p>The abnormality detection time of the operation for automatic degradation using the arbitration server can be calculated as follows.</p><pre class="border">Abnormality detection time = Max(Abnormality detection time by Mirroring Controller, Abnormality detection time by Mirroring Controller arbitration process) </pre></div></div><div class="note"><p class="title">Note</p><div class="notebody"><p>If the heartbeat_interval is set in the arbitration configuration file, the relationship between the parameter for operating system or server abnormality monitoring specified in the server configuration file of the database server file and the heartbeat_interval of the arbitration configuration file must satisfy the following relational expression.</p><pre class="border"> Heartbeat_interval in the arbitration configuration file (milliseconds) / 1000 ) &lt;( heartbeat_timeout(seconds) + heartbeat_interval(milliseconds) / 1000 ) * heartbeat_retry(number of times) + heartbeat_timeout(seconds)</pre></div></div><br></div><p class="subhead_1" id="mID_0611040101_p3"><span class="em">Parameters for the arbitration processing and fencing</span></p><div class="textblock"><table><caption>Table&nbsp;2.12 Parameters for the arbitration processing and fencing</caption><col><col><tr><th valign="top"><p>Parameter</p></th><th valign="top"><p>Description</p></th></tr><tr><td align="left" valign="top"><p>Arbitration processing timeout<br>(arbitration_timeout in the server configuration file of the database server)</p></td><td align="left" valign="top"><p>Take into account the time to perform arbitration processing on the Mirroring Controller arbitration process. The value must be greater than or equal to abnormality detection time of Mirroring Controller arbitration process + fencing_command_timeout in the arbitration configuration file (seconds).</p></td></tr><tr><td align="left" valign="top"><p>Fencing timeout<br>(fencing_command_timeout in the  arbitration configuration file)</p></td><td align="left" valign="top"><p>Take into account the time to execute the fencing command (seconds).</p></td></tr></table><br></div><p class="subhead_1" id="IDclust06N14"><span class="em">Flow from the abnormality detection to the automatic degeneracy</span></p><div class="textblock"><p>When performing automatic degradation using the arbitration server, the flow from the abnormality detection in the operating system or server to the occurrence of automatic degeneracy and the parameters is shown below.</p><table><col><col><col><col><tr><th height="4" valign="middle"><p>Flow from the abnormality detection to the automatic degeneracy</p></th><th height="4" valign="middle"><p>Description</p></th><th colspan="2" height="4" valign="middle"><p>Parameter</p></th></tr><tr><td height="15" align="left" valign="top"><p>(1) Abnormality detection</p></td><td height="15" align="left" valign="top"><p>Mirroring Controller detect the database server operating system or server errors.</p></td><td colspan="2" height="15" align="left" valign="top"><p>Parameters for the abnormality monitoring of the operating system or server in the server configuration file of the database server</p></td></tr><tr><td height="99" align="left" valign="top"><p>(2) Arbitration request</p></td><td height="99" align="left" valign="top"><p>Mirroring Controller that detect the operating system or server error asks the Arbitration Server to check the status of the other server's operating system or server.</p></td><td height="99" align="left" valign="top"><p>-</p></td><td rowspan="3" height="99" align="left" valign="top"><p>arbitration_timeout in the server configuration file of the database server</p></td></tr><tr><td height="4" align="left" valign="top"><p>(3) Arbitration processing</p></td><td height="4" align="left" valign="top"><p>The Mirroring Controller arbitration process checks the status of the other server's operating system or server. However, if the result of the operating system or server abnormality monitoring by the arbitration server has been determined before the arbitration request from the Mirroring Controller of the database server, this process is not performed.</p></td><td height="4" align="left" valign="top"><p>Parameters for the abnormality monitoring of the operating system or server in the arbitration configuration file</p></td></tr><tr><td height="4" align="left" valign="top"><p>(4) Fencing</p></td><td height="4" align="left" valign="top"><p>If the Mirroring Controller arbitration process determines that the other server is an abnomaly of the operating system or server, it fences the other server and isolates it from the cluster system. If the Mirroring Controller arbitration process determines that the operating system or server status is normal, this process and the (6) are not performed.</p></td><td height="4" align="left" valign="top"><p>fencing_command_timeout in the arbitration configuration file</p></td></tr><tr><td height="4" align="left" valign="top"><p>(5) Return of the arbitration results</p></td><td height="4" align="left" valign="top"><p>Returns the results of the arbitration to the Mirroring Controller of the database server that requested the arbitration.</p></td><td colspan="2" height="4" align="left" valign="top"><p>-</p></td></tr><tr><td height="4" align="left" valign="top"><p>(6) Automatic degradation</p></td><td height="4" align="left" valign="top"><p>The automatic degradation is performed. If fencing fails in (4), this procedure is not performed. </p></td><td colspan="2" height="4" align="left" valign="top"><p>-</p></td></tr></table><p class="supple">-: No associated parameters</p><div class="note"><p class="title">Note</p><div class="notebody"><p>If the fencing_command parameter is specified in the server configuration file of the database server, the fencing command is invoked on the database server if fencing is successful on the arbitration server. In that case, add the value of the fencing_command_timeout parameter in the server configuration file of the database server to the estimate.</p></div></div><p class="caption">Figure&nbsp;2.1 When the Mirroring Controller on the primary server detects an operating system or server error</p><p><img src="clust06img/e-06-tuning-arbiter-fencing-parameter-p.gif" alt="" width="491" height="520"></p><p class="caption">Figure&nbsp;2.2 When the Mirroring Controller on the standby server detects an operating system or server error</p><p><img src="clust06img/e-06-tuning-arbiter-fencing-parameter-s.gif" alt="" width="491" height="519"></p><br></div></div><h5 id="IDclust06N15">2.11.4.1.2 Tuning Abnormality Monitoring for Operations that Perform Automatic Degeneration by Calling a User Exit that Determines Degeneration</h5><div class="body"><div class="textblock"><p>In an operation that perform automatic degeneration by calling a user exit that determines degeneration, you can optimize the time from operating system or server abnormality detection to automatic degradation by editing the operating system or server abnormality monitoring parameters and parameters related to arbitration processing and fencing in the server configuration file of the database server. Refer to "<a href="j2678-00-02-11-04.html#mID_0611040101_p1">Parameters for the abnormality monitoring of the operating system or server in the server configuration file of the database server</a>" for information on the operating system or server abnormality monitoring parameters in the server configuration file of the database server.</p><table><caption>Table&nbsp;2.13 Parameters for the arbitration processing and fencing</caption><col><col><tr><th valign="top"><p>Parameter</p></th><th valign="top"><p>Description</p></th></tr><tr><td align="left" valign="top"><p>Arbitration processing timeout<br>(arbitration_command_timeout)</p></td><td align="left" valign="top"><p>Take into account the time to execute the arbitration command(seconds).</p></td></tr><tr><td align="left" valign="top"><p>Fencing timeout<br>(fencing_command_timeout)</p></td><td align="left" valign="top"><p>Take into account the time to execute the fencing command (seconds).</p></td></tr></table><br></div><p class="subhead_1" id="IDclust06N16"><span class="em">Flow from the abnormality detection to the automatic degeneracy</span></p><div class="textblock"><p>When performing automatic degradation by calling a user exit that determines degeneration, the flow from the abnormality detection in the operating system or server to the occurrence of automatic degeneracy and the parameters is shown below.</p><table><col><col><col><tr><th height="4" valign="top"><p>Flow from the abnormality detection to the automatic degeneracy</p></th><th height="4" valign="middle"><p>Description</p></th><th height="4" valign="middle"><p>Parameter</p></th></tr><tr><td height="15" align="left" valign="top"><p>(1) Abnormality detection</p></td><td height="15" align="left" valign="top"><p>Mirroring Controller detect the database server operating system or server errors.</p></td><td height="15" align="left" valign="top"><p>Parameters for the abnormality monitoring of the operating system or server in the server configuration file of the database server</p></td></tr><tr><td height="4" align="left" valign="top"><p>(2) Arbitration processing</p></td><td height="4" align="left" valign="top"><p>An arbitration command is executed to check the status of the other server's operating system or server.</p></td><td height="4" align="left" valign="top"><p>arbitration_command_timeout in the server configuration file of the database server</p></td></tr><tr><td height="4" align="left" valign="top"><p>(3) Fencing</p></td><td height="4" align="left" valign="top"><p>If the operating system or server status of the other server is abnomal in (2), it fences the other server and isolates it from the cluster system. If the operating system or server status of the other server is nomal in (2), this process and (4) are not executed.</p></td><td height="4" align="left" valign="top"><p>fencing_command_timeout in the server configuration file of the database server</p></td></tr><tr><td height="4" align="left" valign="top"><p>(4) Automatic degradation</p></td><td height="4" align="left" valign="top"><p>The automatic degradation is performed. If fencing fails in (3), this procedure is not performed.</p></td><td height="4" align="left" valign="top"><p>-</p></td></tr></table><p class="supple">-: No associated parameters</p><p class="caption">Figure&nbsp;2.3 When the Mirroring Controller on the primary server detects an operating system or server error</p><p><img src="clust06img/e-06-tuning-arbiter-command-parameter-p.gif" alt="" width="435" height="396"></p><p class="caption">Figure&nbsp;2.4 When the Mirroring Controller on the standby server detects an operating system or server error</p><p><img src="clust06img/e-06-tuning-arbiter-command-parameter-s.gif" alt="" width="439" height="398"></p><br></div></div><h5 id="IDclust06N17">2.11.4.1.3 Tuning Abnormality Monitoring for Operations that Notify Messages</h5><div class="body"><div class="textblock"><p>In an operation that notify messages, you can optimize the abnormality detection time by editing the operating system or server abnormality monitoring parameters in the server configuration file of the database server. Refer to "<a href="j2678-00-02-11-04.html#mID_0611040101_p1">Parameters for the abnormality monitoring of the operating system or server in the server configuration file of the database server</a>" for information on the operating system or server abnormality monitoring parameters in the server configuration file of the database server. In addition, when the Mirroring Controller detects an error, it does not perform the arbitration processing, fencing, or automatic degradation, but only notification messages is performed.</p><br></div></div><h5 id="IDclust06N18">2.11.4.1.4 Tuning Abnormality Monitoring for Operations that Perform Automatic Degenerate Unconditionally due to Heartbeat Abnormality</h5><div class="body"><div class="textblock"><p>In an operation that perform automatic degenerate unconditionally due to heartbeat abnormality, you can optimize the time from operating system or server abnormality detection to automatic degradation by editing the operating system or server abnormality monitoring parameters in the server configuration file of the database server. Refer to "<a href="j2678-00-02-11-04.html#mID_0611040101_p1">Parameters for the abnormality monitoring of the operating system or server in the server configuration file of the database server</a>" for information on the operating system or server abnormality monitoring parameters in the server configuration file of the database server. In addition, when the Mirroring Controller detects an error, it does not perform the arbitration processing, fencing, or automatic degradation, but only automatic degenerate unconditionally is performed.</p><div class="note"><p class="title">Note</p><div class="notebody"><p>Refer to "<a href="j2678-d-00-00.html">Appendix&nbsp;D Notes on Performing Automatic Degradation Immediately after a Heartbeat Abnormality</a>" for notes on the operation that perform automatic degenerate unconditionally due to heartbeat abnormality.</p></div></div><br></div></div><h4 id="IDclust06N19">2.11.4.2 Tuning for Abnormality Monitoring of Darabase Processes</h4><div class="body"><div class="textblock"><p>In an abnormality monitoring of database pocesses, you can optimize by editing the following parameters in the server configuration file of the database server.</p><table><caption>Table&nbsp;2.14 Parameters for abnormality monitoring of database processes</caption><col><col><tr><th valign="top"><p>Parameter</p></th><th valign="top"><p>Description</p></th></tr><tr><td align="left" valign="top"><p>Abnormality monitoring interval<br>(db_instance_check_interval)</p></td><td align="left" valign="top"><p>Abnormality monitoring by Mirroring Controller is set so as not to place load on the system, but normally it does not need to be set. (The default is the value set in heartbeat_interval.) (milliseconds)</p></td></tr><tr><td align="left" valign="top"><p>Timeout for abnormality monitoring of database processes<br>(db_instance_check_timeout)</p></td><td align="left" valign="top"><p>Take into account the time during which a load is placed continuously on the database. For example, it is envisaged that this parameter will be used in situations such as when performing high-load batch jobs or when a large number of online jobs occur continuously and concurrently. (The default is the value set in heartbeat_timeout.) (seconds)</p></td></tr><tr><td align="left" valign="top"><p>Abnormality monitoring retries<br>(db_instance_check_retry)</p></td><td align="left" valign="top"><p>This parameter can be set when needing a safety value for situations in which the value specified for db_instance_check_timeout is exceeded, for example, when using systems with fluctuating loads, however, this parameter does not normally need to be set. (The default is the value set in heartbeat_retry.) (number of times)</p></td></tr></table><p><img src="clust06img/e-0609-tuning-db.gif" alt="" width="929" height="657"></p><p>The expression for calculating the time required to detect an abnormality is shown below.</p><pre class="border">Abnormality detection time = ( db_instance_check_timeout(seconds) + db_instance_check_interval(milliseconds) / 1000 ) x ( db_instance_check_retry(number of times) + 1 )</pre><br><p>The abnormality detection time when the default value is used is shown below.</p><pre class="border">Abnormality detection time = ( 1 + 800 / 1000 ) x ( 2 + 1 )             = 5.4(seconds)</pre><div class="note"><p class="title">Note</p><div class="notebody"><ul><li><p>If the db_instance_timeout_action parameter in <span class="i">serverIdentifier</span>.conf is set to "message", and the db_instance_check_timeout parameter is set to a short value, a crash of the database process will be detected as "no response", and it may take time for automatic degradation to occur. Therefore, specify an appropriate timeout for db_instance_check_timeout.</p></li><li><p>If a high load on the database and an event that prevents connection to an instance occur at the same time, it is judged as abnormal without retrying monitoring.</p></li></ul></div></div><br></div></div><h4 id="IDclust06N20">2.11.4.3 Tuning for Abnormality Monitoring of Streaming Replication</h4><div class="body"><div class="textblock"><p>In an abnormality monitoring of streaming replication, you can optimize by editing the following parameters in the server configuration file of the database server.</p><table><caption>Table&nbsp;2.15 Parameters for abnormality monitoring of streaming replication</caption><col><col><tr><th valign="top"><p>Parameter</p></th><th valign="top"><p>Description</p></th></tr><tr><td align="left" valign="top"><p>Abnormality monitoring interval<br>(db_instance_check_interval)</p></td><td align="left" valign="top"><p>Abnormality monitoring by Mirroring Controller is set so as not to place load on the system, but normally it does not need to be set. (The default is the value set in heartbeat_interval.) (milliseconds)</p></td></tr><tr><td align="left" valign="top"><p>Abnormality monitoring retries<br>(db_instance_check_retry)</p></td><td align="left" valign="top"><p>This parameter can be set when needing a safety value, such as when it is anticipated that a temporary log transfer LAN error may occur, but it does not normally need to be set. (The default is the value set in heartbeat_retry.) (number of times)</p></td></tr><tr><td align="left" valign="top"><p>Timeout for abnormality monitoring of streaming replication<br>(wal_sender_timeout and wal_receiver_timeout in postgresql.conf)</p></td><td align="left" valign="top"><p>Take into account the capacity and load of the log transfer network and the time during which a load is placed continuously on the database. For example, if there is a succession of data update jobs that generate a high WAL volume, you must configure the settings to avoid misdetection. (The default is 60 seconds.)</p></td></tr></table><p><img src="clust06img/e-0609-tuning-strep.gif" alt="" width="763" height="529"></p><p><img src="clust06img/e-0609-tuning-strep-walreceiver.gif" alt="" width="720" height="220"></p><p>The expression for calculating the time required to detect an abnormality is shown below.</p><pre class="border">Abnormality detection time = ( wal_sender_timeout(seconds) + db_instance_check_interval(milliseconds) / 1000 x ( disk_check_retry(number of times) + 1 ) )  Or,             = ( wal_receiver_timeout(seconds) + db_instance_check_interval(milliseconds) / 1000 x ( disk_check_retry(number of times) + 1 ) )</pre><br><p>The abnormality detection time when the default value is used is shown below.</p><pre class="border">Abnormality detection time = 60 + (800 / 1000 x (2 + 1))             = 62.4(seconds)</pre><br></div></div><h4 id="IDclust06N21">2.11.4.4 Tuning for Disk Abnormality Monitoring</h4><div class="body"><div class="textblock"><p>In an abnormality monitoring of the disk, you can optimize by editing the following parameters in the server configuration file of the database server.</p><table><caption>Table&nbsp;2.16 Parameters for disk abnormality monitoring</caption><col><col><tr><th valign="top"><p>Parameter</p></th><th valign="top"><p>Description</p></th></tr><tr><td align="left" valign="top"><p>Abnormality monitoring interval<br>(disk_check_interval)</p></td><td align="left" valign="top"><p>Abnormality monitoring by Mirroring Controller is set so as not to place load on the system, but normally it does not need to be set. (The default is the value set in heartbeat_interval.) (milliseconds)</p></td></tr><tr><td align="left" valign="top"><p>Abnormality monitoring retries<br>(disk_check_retry)</p></td><td align="left" valign="top"><p>This parameter can be set when needing a safety value, such as when it is anticipated that a temporary disk input/output error may occur, but normally it does not need to be set. (The default is the value set in heartbeat_retry.) (number of times)</p></td></tr></table><p><img src="clust06img/e-0609-tuning-disk.gif" alt="" width="646" height="527"></p><p>The expression for calculating the time required to detect an abnormality is shown below.</p><pre class="border">Abnormality detection time = disk_check_interval (milliseconds) / 1000 x ( disk_check_retry(number of times) + 1 )</pre><br><p>The abnormality detection time when the default value is used is shown below.</p><pre class="border">Abnormality detection time = 800 / 1000  x ( 2 + 1 )             = 2.4(seconds)</pre><div class="note"><p class="title">Note</p><div class="notebody"><ul><li><p>The tuning described above impacts on the time taken from detection of a timeout until switching the primary server. Therefore, modify the values while taking into account the switch/disconnection time, using a design for which misdetection does not occur.</p></li><li><p>Immediately selecting automatic degradation when a heartbeat abnormality occurs in operating system or server heartbeat monitoring risks causing split brain. Refer to "<a href="j2678-d-00-00.html">Appendix&nbsp;D Notes on Performing Automatic Degradation Immediately after a Heartbeat Abnormality</a>" for details.</p></li></ul></div></div><div class="tips"><p class="title">Information</p><div class="tipsbody"><p>Mirroring Controller uses connections to database instances and SQL access to monitor abnormality in some resources targeted for monitoring. The connection destination database names and connection user names used for abnormality monitoring conform to the parameters in the server configuration file. The application name is "mc_agent".</p></div></div></div></div><div class="header_footer"><div class="back_next"><a href="j2678-00-02-11-03.html"><img src="image/back2.gif" width="65" height="27" border="0" alt="Previous" title="Previous"></a><a href="j2678-00-02-12-00.html"><img src="image/next2.gif" width="64" height="27" border="0" alt="Next" title="Next"></a></div><div class="copyright">Copyright 2016-2021 FUJITSU LIMITED</div></div></body></html>