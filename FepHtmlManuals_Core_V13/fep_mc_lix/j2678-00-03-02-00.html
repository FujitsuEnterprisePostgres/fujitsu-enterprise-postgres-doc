<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"><html lang="en"><head><META http-equiv="Content-Type" content="text/html; charset=UTF-8"><META CONTENT="4.3" NAME="GeneratorVersion"><title>3.2 Starting and Stopping Mirroring Controller</title><link rel="stylesheet" href="manualmain.css" type="TEXT/CSS"><script language="JavaScript" src="topbutton.js"></script></head><body onload="init()"><div class="topButton" id="topButton0"><a class="topButton" href="#top"><img src="image/top.gif" width="62" height="20" border="0" alt="Top" title="Top"></a></div><div class="top_header"><div class="top_header_title"><a title="Title Page" class="top_link" target="_top" HREF="index.html">Enterprise Postgres 13&nbsp;Cluster Operation Guide(Database Multiplexing)</a></div><div class="top_header_graphic"><span class="top_logo"><img src="image/logo-white-fj.gif" width="148" height="32" alt=""></span><span class="top_keygraphic"><img src="image/cover-header-graphic.gif" width="148" height="32" alt="FUJITSU Software"></span></div></div><div class="header_footer"><div class="breadcrumbslist"><a href="j2678-00-03-00-00.html">Chapter&nbsp;3 Operations in Database Multiplexing Mode</a> &gt; 3.2 Starting and Stopping Mirroring Controller</div><div class="back_next"><a href="j2678-00-03-01-02.html"><img src="image/back2.gif" width="65" height="27" border="0" alt="Previous" title="Previous"></a><a href="j2678-00-03-03-00.html"><img src="image/next2.gif" width="64" height="27" border="0" alt="Next" title="Next"></a></div></div><h2 id="mID_0701">3.2 Starting and Stopping Mirroring Controller<a name="N66G"></a></h2><div class="body"><div class="textblock"><p>When database multiplexing mode is used, use the mc_ctl command to start and stop the instance and Mirroring Controller at the same time.</p><p>Do not start or stop the instance by itself.</p><p></p></div><p class="subhead_1" id="IDclust07N3"><span class="red"><span class="em"></span></span><span class="em">Starting Mirroring Controller</span></p><div class="textblock"><p>While Mirroring Controller is in a stopped state, execute the mc_ctl command in start mode to start Mirroring Controller.</p><dl><dt class="em">Enabling automatic switch/disconnection</dt><dd><p>Execute the mc_ctl command in start mode.</p><pre>Example)</pre><pre class="border">$ mc_ctl start -M /mcdir/inst1</pre><br><p>When only the instance is started and stopped, the following will happen:</p><ul><li><p>When only the instance is started</p><p>Features such as automatic switch and automatic disconnection will not work until Mirroring Controller is started.</p></li><li><p>When only the instance is stopped</p><p>Mirroring Controller determines that an error has occurred in the instance, and performs an unnecessary automatic switch.</p><p>Automatic switch may also stop working correctly in some cases.</p></li></ul></dd></dl><dl><dt class="em">Disabling automatic switch/disconnection</dt><dd><p>Execute the mc_ctl command in start mode with the -F option specified.</p><pre>Example)</pre><pre class="border">$ mc_ctl start -M /mcdir/inst1 -F</pre><br><p>When only the instance is started and stopped, the following will happen:</p><ul><li><p>When only the instance is started</p><p>Errors indicated in "<a href="j2678-00-01-01-00.html">1.1 What is Database Multiplexing Mode</a>" will not be detected until Mirroring Controller is started.</p></li><li><p>When only the instance is stopped</p><p>Mirroring Controller determines that an error has occurred in the instance, and outputs an error to the system log.</p></li></ul></dd></dl><div class="point"><p class="title">Point</p><div class="pointbody"><ul><li><p>To start the Mirroring Controller process only, execute the mc_ctl command in start mode with the --mc-only option specified.</p></li><li><p>After Mirroring Controller is started, automatic switch/disconnection can be enabled or disabled using the enable-failover or disable-failover mode of the mc_ctl command.</p></li><li><p>When the arbitration server is used for automatic degradation, the Mirroring Controller process startup fails on the database server if the Mirroring Controller arbitration process has not been started on the arbitration server in advance. However, even if the Mirroring Controller arbitration process cannot be started in advance, the Mirroring Controller process can be started by specifying the --async-connect-arbiter option in the mc_ctl command.</p></li></ul></div></div><div class="note"><p class="title">Note</p><div class="notebody"><ul><li><p>When the arbitration server is used for automatic degradation, the database server must connect to the arbitration server, and as a result, Mirroring Controller startup may take longer.</p></li><li><p>Mirroring Controller startup usually fails if the standby server is mistakenly started as the primary server or if the old primary server is not recovered after the switch and is then mistakenly started as the primary server. However, if the admin network is disconnected, then startup does not fail, and both servers may become primary servers. Therefore, ensure that the admin network is connected before starting Mirroring Controller.</p></li></ul></div></div></div><p class="subhead_1" id="IDclust07N4"><span class="red"><span class="em"></span></span><span class="em">Stopping Mirroring Controller</span></p><div class="textblock"><p>While Mirroring Controller is running, execute the mc_ctl command in stop mode to stop Mirroring Controller process.</p><pre>Example)</pre><pre class="border">$ mc_ctl stop -M /mcdir/inst1</pre><div class="point"><p class="title">Point</p><div class="pointbody"><p>To stop the Mirroring Controller process only, execute the mc_ctl command in stop mode with the --mc-only option specified.</p></div></div><div class="note"><p class="title">Note</p><div class="notebody"><p>To prevent an unintended automatic switch, before shutting down the operating system on the primary server, you must stop the Mirroring Controller, or shut down the operating system on the standby server.</p></div></div><div class="ref"><p class="title">See</p><div class="refbody"><p>Refer to the Reference for information on how to specify the mc_ctl command.</p></div></div></div></div><div class="header_footer"><div class="back_next"><a href="j2678-00-03-01-02.html"><img src="image/back2.gif" width="65" height="27" border="0" alt="Previous" title="Previous"></a><a href="j2678-00-03-03-00.html"><img src="image/next2.gif" width="64" height="27" border="0" alt="Next" title="Next"></a></div><div class="copyright">Copyright 2016-2021 FUJITSU LIMITED</div></div></body></html>