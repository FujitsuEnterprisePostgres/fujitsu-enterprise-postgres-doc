<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"><html lang="en"><head><META http-equiv="Content-Type" content="text/html; charset=UTF-8"><META CONTENT="4.3" NAME="GeneratorVersion"><title>3.3.1 Checking the Status of the Database Server</title><link rel="stylesheet" href="manualmain.css" type="TEXT/CSS"><script language="JavaScript" src="topbutton.js"></script></head><body onload="init()"><div class="topButton" id="topButton0"><a class="topButton" href="#top"><img src="image/top.gif" width="62" height="20" border="0" alt="Top" title="Top"></a></div><div class="top_header"><div class="top_header_title"><a title="Title Page" class="top_link" target="_top" HREF="index.html">Enterprise Postgres 13&nbsp;Cluster Operation Guide(Database Multiplexing)</a></div><div class="top_header_graphic"><span class="top_logo"><img src="image/logo-white-fj.gif" width="148" height="32" alt=""></span><span class="top_keygraphic"><img src="image/cover-header-graphic.gif" width="148" height="32" alt="FUJITSU Software"></span></div></div><div class="header_footer"><div class="breadcrumbslist"><a href="j2678-00-03-00-00.html">Chapter&nbsp;3 Operations in Database Multiplexing Mode</a> &gt; <a href="j2678-00-03-03-00.html">3.3 Checking the Database Multiplexing Mode Status</a> &gt; 3.3.1 Checking the Status of the Database Server</div><div class="back_next"><a href="j2678-00-03-03-00.html"><img src="image/back2.gif" width="65" height="27" border="0" alt="Previous" title="Previous"></a><a href="j2678-00-03-03-02.html"><img src="image/next2.gif" width="64" height="27" border="0" alt="Next" title="Next"></a></div></div><h3 id="IDclust07N5">3.3.1 Checking the Status of the Database Server<a name="N70G"></a></h3><div class="body"><div class="textblock"><p>This section describes how to check the status of the database server.</p><p>Check the multiplexed database status by executing the mc_ctl command in status mode.</p><p>Additionally, errors can be detected by monitoring the Mirroring Controller messages. If the status or messages are monitored periodically, you can react quickly following an automatic switch failure.</p><p></p></div><p class="subhead_1" id="IDclust07N6"><span class="em">Checking the </span><span class="em">status of the </span><span class="em">multiplexing database</span></p><div class="textblock"><p>When the mc_ctl command is executed, the details of the multiplexing configuration, information about whether switch is possible following the error, and location and details of the error that caused the switch or disconnection are displayed.</p><p>After starting database multiplexing mode, execute the mc_ctl command in status mode to check the multiplexing status.</p><p>An example of the status displayed when the mc_ctl command is executed is shown below.</p><pre>Example)</pre><pre class="border">$ mc_ctl status -M /mcdir/inst1mirroring status----------------switchableserver_id  host_role       host            host_status  db_proc_status       disk_status--------------------------------------------------------------------------------------------------------server1    primary         192.0.2.100     normal       normal                 normalserver2    standby         192.0.2.110     normal       normal                 normal</pre></div><p class="subhead_1" id="IDclust07N7"><span class="em">Checking the </span><span class="em">status of </span><span class="em">connection </span><span class="em">to</span><span class="em"> the Mirroring Controller arbitration process</span></p><div class="textblock"><p>When the arbitration server is used for automatic degradation, the status of the connection to the Mirroring Controller arbitration process can be checked by specifying the --arbiter option. If the output status is "online", it indicates that an arbitration request can be made from the database server to the arbitration server. When the arbitration server is used for automatic degradation, regularly execute the command in status mode with the --arbiter option specified and check that the output status is "online".</p><pre>Example)The mc_ctl command is executed with the --arbiter option specified, and the status is output.</pre><pre class="border">$ mc_ctl status --arbiter -M /mcdir/inst1arbiter_id   host            status---------------------------------------arbiter      192.0.3.120     online </pre></div><p class="subhead_1" id="IDclust07N8"><span class="em">Checking the </span><span class="em">status of </span><span class="em">data synchronization</span></p><div class="textblock"><p>Additionally, by referencing the pg_stat_replication statistics view on the primary server, the data synchronization status can be confirmed. However, when creating the monitoring program, note that the content of pg_stat_replication may be changed in the future.</p><p>The following example shows that the locations of the transaction log after it is sent and received (sent_lsn, replay_lsn) match, and that they are fully synchronized.</p><pre>Example)</pre><pre class="border">postgres=# select * from pg_stat_replication;-[ RECORD 1 ]----+------------------------------pid              | 10651usesysid         | 10usename          | fsepapplication_name | standbyclient_addr      | 192.0.2.210client_hostname  |client_port      | 55098backend_start    | 2020-03-23 11:17:49.628793+09backend_xmin     |state            | streamingsent_lsn         | 0/3000060write_lsn        | 0/3000060flush_lsn        | 0/3000060replay_lsn       | 0/3000060write_lag        |flush_lag        |replay_lag       |sync_priority    | 1sync_state       | syncreply_time       | 2020-03-23 11:23:27.703366+09</pre><div class="ref"><p class="title">See</p><div class="refbody"><ul><li><p>Refer to "mc_ctl" in Reference for information on the command.</p></li><li><p>Refer to "Notes on Application Compatibility" in the Application Development Guide for information on retaining application compatibility.</p></li><li><p>Refer to "The Statistics Collector" in "Server Administration" in the PostgreSQL Documentation for details on pg_stat_replication.</p></li></ul></div></div></div></div><div class="header_footer"><div class="back_next"><a href="j2678-00-03-03-00.html"><img src="image/back2.gif" width="65" height="27" border="0" alt="Previous" title="Previous"></a><a href="j2678-00-03-03-02.html"><img src="image/next2.gif" width="64" height="27" border="0" alt="Next" title="Next"></a></div><div class="copyright">Copyright 2016-2021 FUJITSU LIMITED</div></div></body></html>