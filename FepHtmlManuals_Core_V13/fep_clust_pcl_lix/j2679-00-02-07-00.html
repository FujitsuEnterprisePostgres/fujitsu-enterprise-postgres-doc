<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"><html lang="en"><head><META http-equiv="Content-Type" content="text/html; charset=UTF-8"><META CONTENT="4.3" NAME="GeneratorVersion"><title>2.7 Creating a Symfoware Database Cluster</title><link rel="stylesheet" href="manualmain.css" type="TEXT/CSS"><script language="JavaScript" src="topbutton.js"></script></head><body onload="init()"><div class="topButton" id="topButton0"><a class="topButton" href="#top"><img src="image/top.gif" width="62" height="20" border="0" alt="Top" title="Top"></a></div><div class="top_header"><div class="top_header_title"><a title="Title Page" class="top_link" target="_top" HREF="index.html">Enterprise Postgres 13&nbsp;Cluster Operation Guide(PRIMECLUSTER)</a></div><div class="top_header_graphic"><span class="top_logo"><img src="image/logo-white-fj.gif" width="148" height="32" alt=""></span><span class="top_keygraphic"><img src="image/cover-header-graphic.gif" width="148" height="32" alt="FUJITSU Software"></span></div></div><div class="header_footer"><div class="breadcrumbslist"><a href="j2679-00-02-00-00.html">Chapter&nbsp;2 Setting Up Failover Operation</a> &gt; 2.7 Creating a Symfoware Database Cluster</div><div class="back_next"><a href="j2679-00-02-06-00.html"><img src="image/back2.gif" width="65" height="27" border="0" alt="Previous" title="Previous"></a><a href="j2679-00-02-08-00.html"><img src="image/next2.gif" width="64" height="27" border="0" alt="Next" title="Next"></a></div></div><h2 id="mID_020307">2.7 Creating a Symfoware Database Cluster<a name="N15G"></a></h2><div class="body"><div class="textblock"><ol><li><p>Create the database cluster.</p><div class="note"><p class="title">Note</p><div class="notebody"><ul><li><p>If the configuration requires password authentication, create a .pgpass file in the home directory of the operating system user who is to start FUJITSU Enterprise Postgres, and then specify a password for the template1 database as this is required. This will be used when PRIMECLUSTER checks the operation of the FUJITSU Enterprise Postgres database server. If authentication fails, a fault will be assumed to have occurred in the database server.</p></li><li><p>The value specified for the port parameter in postgresql.conf needs to be set in the /etc/services files on all nodes.</p></li><li><p>Since postgresql.conf is stored in the data directory, it becomes a common configuration file for each node in the shared disk. Therefore, it must be taken into account that the path set for postgresql.conf must be valid for the FUJITSU Enterprise Postgres server processes started on each node. For example, if a local directory is specified in the core_directory parameter, that local directory must have been created on all nodes.</p></li><li><p>To execute the FUJITSU Enterprise Postgres commands, you must configure the environment variables on each node.</p></li><li><p>Use the initdb command to create a database cluster.</p></li><li><p>Specify "off" for the restart_after_crash parameter in postgresql.conf.<br>If "on" is specified, or the default value is used for the restart_after_crash parameter, behaviors equivalent to restarting the FUJITSU Enterprise Postgres, including crash recovery, will be performed when some server processes go down. When linking with PRIMECLUSTER, however, a failover will occur after an error is detected as soon as some server processes go down, and server processes restarting will be forced to stop. This is to inhibit complex behaviors such as processes being canceled in the middle of restarting for no particular meaningful purpose.</p></li></ul></div></div></li><li><p>Check starting, connection, and stopping at each node. The procedure is as follows.</p><div class="note"><p class="title">Note</p><div class="notebody"><p>Queries are issued to monitor the FUJITSU Enterprise Postgres from PRIMECLUSTER. With this connection process, if a password is requested, the monitoring process cannot be continued. For this reason, when checking the connection, ensure that connections can be made without entering a password.</p></div></div><div class="point"><p class="title">Point</p><div class="pointbody"><p>When monitoring FUJITSU Enterprise Postgres from PRIMECLUSTER, the name of the application that connects to instances is "pgx_wch_svprocess".</p></div></div><ol><li><p>Check the starting, connection, and stopping at node 1.</p><p>Use the pg_ctl command to start and stop the node.</p><p>For connection, execute the following to ensure that connections can be made without entering a password:</p><pre class="border">su - <span class="i">OsUser</span>psql -d template1 -p <span class="i">portNum</span> [ -U <span class="i">dbUser</span>]</pre><p><span class="i">OsUser</span>: Operating system user to start the FUJITSU Enterprise Postgres<br><span class="i">portNum</span>: Port number specified when the database cluster was created<br><span class="i">dbUser</span>: Database superuser</p><p>If the database superuser is specified at the time of executing the initdb command, or if the database superuser has been changed after the initdb command was executed, specify the user for the -U option. If the database superuser is not specified or changed, omit this.</p></li><li><p>Unmount all file systems containing the resources required to create database clusters (such as the data storage destination directory) on node 1, and stop the GDS volume.</p></li><li><p>Start the GDS volume on node 2, and mount all file systems containing the resources required to create database clusters (such as the data storage destination directory).</p></li><li><p>Check starting, connection, and stopping at node 2.</p><p>Perform the same check as step 1.</p></li><li><p>Unmount all file systems containing the resources required to create database clusters (such as the data storage destination directory) on node 2, and stop the GDS volume.</p></li><li><p>Start the GDS volume on node 1, and mount all file systems containing the resources required to create database clusters (such as the data storage destination directory).</p></li></ol></li></ol><div class="ref"><p class="title">See</p><div class="refbody"><ul><li><p>Refer to "Using the initdb Command" of "Creating an Instance" in the Installation and Setup Guide for Server" for information on how to create a database cluster.</p></li><li><p>Refer to "The Password File" in "Client Interfaces" in the PostgreSQL Documentation for information on files for which passwords are set.</p></li></ul></div></div><p></p></div></div><div class="header_footer"><div class="back_next"><a href="j2679-00-02-06-00.html"><img src="image/back2.gif" width="65" height="27" border="0" alt="Previous" title="Previous"></a><a href="j2679-00-02-08-00.html"><img src="image/next2.gif" width="64" height="27" border="0" alt="Next" title="Next"></a></div><div class="copyright">Copyright 2018-2021 FUJITSU LIMITED</div></div></body></html>