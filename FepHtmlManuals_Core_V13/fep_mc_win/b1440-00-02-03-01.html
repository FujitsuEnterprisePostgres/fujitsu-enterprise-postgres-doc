<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"><html lang="en"><head><META http-equiv="Content-Type" content="text/html; charset=UTF-8"><META CONTENT="4.3" NAME="GeneratorVersion"><title>2.3.1 Configuring the Arbitration Server</title><link rel="stylesheet" href="manualmain.css" type="TEXT/CSS"><script language="JavaScript" src="topbutton.js"></script></head><body onload="init()"><div class="topButton" id="topButton0"><a class="topButton" href="#top"><img src="image/top.gif" width="62" height="20" border="0" alt="Top" title="Top"></a></div><div class="top_header"><div class="top_header_title"><a title="Title Page" class="top_link" target="_top" HREF="index.html">Enterprise Postgres 13&nbsp;Cluster Operation Guide(Database Multiplexing)</a></div><div class="top_header_graphic"><span class="top_logo"><img src="image/logo-white-fj.gif" width="148" height="32" alt=""></span><span class="top_keygraphic"><img src="image/cover-header-graphic.gif" width="148" height="32" alt="FUJITSU Software"></span></div></div><div class="header_footer"><div class="breadcrumbslist"><a href="b1440-00-02-00-00.html">Chapter&nbsp;2 Setting Up Database Multiplexing Mode</a> &gt; <a href="b1440-00-02-03-00.html">2.3 Setting Up the Arbitration Server</a> &gt; 2.3.1 Configuring the Arbitration Server</div><div class="back_next"><a href="b1440-00-02-03-00.html"><img src="image/back2.gif" width="65" height="27" border="0" alt="Previous" title="Previous"></a><a href="b1440-00-02-03-02.html"><img src="image/next2.gif" width="64" height="27" border="0" alt="Next" title="Next"></a></div></div><h3 id="mID_060401_arbiter_sv">2.3.1 Configuring the Arbitration Server<a name="N35G"></a></h3><div class="body"><div class="textblock"><p>This section explains how to set up database multiplexing mode on the arbitration server.</p><p>In database multiplexing mode, the files that are required for operations are managed in the Mirroring Controller arbitration process management directory.</p><p>There is one Mirroring Controller arbitration process management directory for each arbitration process.</p><div class="point"><p class="title">Point</p><div class="pointbody"><p>The arbitration process for each database multiplexing system can be started on a single arbitration server.</p></div></div><div class="ref"><p class="title">See</p><div class="refbody"><ul><li><p>Refer to the Reference for information on the mc_arb command.</p></li><li><p>Refer to "<a href="b1440-a-00-00.html">Appendix&nbsp;A Parameters</a>" for information on the parameters to be edited for the setup.</p></li></ul></div></div><p>Perform the following procedure: </p><dl><dd></dd></dl><dl><dt class="em">Linux</dt><dd></dd></dl><ol><li><p>On the arbitration server, log in as any operating system user who starts and stops the arbitration process.</p></li><li><p>Configure the environment variables.</p><p>Set the following environment variables:</p><ul><li><p>PATH</p><p>Add the installation directory "/bin".</p></li><li><p>MANPATH</p><p>Add the installation directory "/share/man".</p></li><li><p>LD_LIBRARY_PATH</p><p>Add the installation directory "/lib".</p></li></ul><dl><dt class="em">Example </dt><dd><p>The following example configures environment variables when the installation directory is "/opt/fsepv&lt;<span class="i">x</span>&gt;assistant".</p><p>Note that "&lt;<span class="i">x</span>&gt;" indicates the product version.</p><p><span class="em">sh</span><span class="em">, </span><span class="em">bash</span></p><pre class="border">$ PATH=/opt/fsepv&lt;<span class="i">x</span>&gt;assistant/bin:$PATH ; export PATH$ MANPATH=/opt/fsepv&lt;<span class="i">x</span>&gt;assistant/share/man:$MANPATH ; export MANPATH$ LD_LIBRARY_PATH=/opt/fsepv&lt;<span class="i">x</span>&gt;assistant/lib:$LD_LIBRARY_PATH ; export LD_LIBRARY_PATH</pre><p><span class="em">csh</span><span class="em">, </span><span class="em">tcsh</span></p><pre class="border">$ setenv PATH /opt/fsepv&lt;<span class="i">x</span>&gt;assistant/bin:$PATH$ setenv MANPATH /opt/fsepv&lt;<span class="i">x</span>&gt;assistant/share/man:$MANPATH$ setenv LD_LIBRARY_PATH /opt/fsepv&lt;<span class="i">x</span>&gt;assistant/lib:$LD_LIBRARY_PATH</pre><br></dd></dl></li><li><p>Create the Mirroring Controller arbitration process management directory that will store the files required by the arbitration server.</p><p>Use ASCII characters in the Mirroring Controller arbitration process management directory.</p></li><li><p>In the network configuration file (network.conf), define the Mirroring Controller network configuration that will be managed by the Mirroring Controller arbitration process.</p><p>Create network.conf in the Mirroring Controller arbitration process management directory, based on the sample file. For network.conf, set read and write permissions only for the operating system user who starts and stops the arbitration process in step 1.</p><p>If users other than this are granted access permissions, the mc_arb command will not work. Accordingly, users other than the operating system user who starts and stops the arbitration process in step 1 are prevented from operating the Mirroring Controller arbitration process.</p><pre>Sample file</pre><pre class="border">/<span class="i">installDir</span>/share/mcarb_network.conf.sample</pre><p>In network.conf, specify the IP address or host name and port number of the primary server and standby server, and define the Mirroring Controller network configuration that will be managed by the Mirroring Controller arbitration process.</p><p>Refer to "<a href="b1440-a-03-00.html">A.3 Network Configuration File</a>" for details.</p><p>A definition example is shown below.</p><pre>Example)The IDs of the servers are set to "server1" and "server2", and their port numbers are set to "27541".</pre><pre class="border">server1 192.0.3.100 27541server2 192.0.3.110 27541</pre></li><li><p>In the arbitration configuration file (arbitration.conf), define the information related to control of the Mirroring Controller arbitration process.</p><p>Create arbitration.conf in the Mirroring Controller arbitration process management directory, based on the sample file. For arbitration.conf, set read and write permissions only for the operating system user who starts and stops the arbitration process in step 1. If users other than this are granted access permissions, the mc_arb command will not work.</p><pre>Sample file</pre><pre class="border">/<span class="i">installDir</span>/share/mcarb_arbitration.conf.sample</pre><p>Set the parameters shown in the table below in arbitration.conf.</p><table><caption>Table&nbsp;2.1 Parameters</caption><col><col><col><tr><th valign="top"><p>Parameter</p></th><th valign="top"><p>Content specified</p></th><th valign="top"><p>Remarks</p></th></tr><tr><td align="left" valign="top"><p>port</p></td><td align="left" valign="top"><p>Port number of the Mirroring Controller arbitration process</p></td><td align="left" valign="top"><p>The port number must be 0 to 65535. Ensure that the port number does not conflict with other software. Do not specify an ephemeral port that may temporarily be assigned by another program.</p></td></tr><tr><td align="left" valign="top"><p>my_address</p></td><td align="left" valign="top"><p>'<span class="i">ipAddr</span><span class="i">OrHostName</span><span class="i">ThatAcceptsConnectionFromMirroringControllerProcessOnD</span><span class="i">b</span><span class="i">Server</span>'</p><p>[Setting example]</p><p>my_address = '192.0.3.120'</p></td><td align="left" valign="top"><p>IPv4 and IPv6 addresses can be specified.</p><p>Specify the IP address, enclosed in single quotation marks (').</p></td></tr><tr><td align="left" valign="top"><p>syslog_ident</p></td><td align="left" valign="top"><p>'<span class="i">programName</span>'</p></td><td align="left" valign="top"><p>Specify using single quotation marks (') to enclose the program name used to identify the Mirroring Controller arbitration process message in the system log. Use ASCII characters excluding spaces to specify this parameter.</p><p>The default is 'MirroringControllerArbiter'.</p></td></tr><tr><td align="left" valign="top"><p>fencing_command</p></td><td align="left" valign="top"><p>'<span class="i">fencingCmdFilePath</span>'</p><p>[Setting example]</p><p>fencing_command = '/arbiter/fencing_dir/execute_fencing.sh'</p></td><td align="left" valign="top"><p>Specify the full path of the fencing command that fences a database server where it is determined that an error has occurred.</p><p>Enclose the path in single quotation marks (').</p><p>Specify the path using less than 1024 bytes.</p></td></tr><tr><td align="left" valign="top"><p>fencing_command_timeout</p></td><td align="left" valign="top"><p>Timeout for fencing command (seconds)</p></td><td align="left" valign="top"><p>If the command does not respond within the specified number of seconds, it is determined that fencing has failed and a signal (SIGTERM) is sent to the fencing command execution process.</p><p>Specify a value between 1 and 2147483647.</p><p>The default is 20 seconds.</p></td></tr></table><div class="tips"><p class="title">Information</p><div class="tipsbody"><p>Refer to "<a href="b1440-a-04-02.html">A.4.2 Arbitration Configuration File</a>" for information on the parameters and for other parameters.</p></div></div><br></li></ol><dl><dt class="em">Windows</dt><dd></dd></dl><ol><li><p>On the arbitration server, log in as any operating system user who starts and stops the arbitration process.</p></li><li><p>Configure the environment variables.</p><p>Set the following environment variable:</p><ul><li><p>PATH</p><p>Add the installation folders "\bin" and "\lib".</p></li></ul><dl><dt class="em">Example</dt><dd><p>The following example configures environment variables when the installation folder is "c:\Program Files\Fujitsu\fsepv&lt;<span class="i">x</span>&gt;assistant64".</p><p>Note that "&lt;<span class="i">x</span>&gt;" indicates the product version.</p><pre class="border">&gt; SET PATH=c:\Program Files\Fujitsu\fsepv&lt;<span class="i">x</span>&gt;assistant64\bin;c:\Program Files\Fujitsu\fsepv&lt;<span class="i">x</span>&gt;assistant64\lib;%PATH%</pre></dd></dl></li><li><p>Create the Mirroring Controller arbitration process management directory that will store the files required by the arbitration server.</p><p>Use ASCII characters in the Mirroring Controller arbitration process management directory.</p></li><li><p>In the network configuration file (network.conf), define the Mirroring Controller network configuration that will be managed by the Mirroring Controller arbitration process.</p><p>Create network.conf in the Mirroring Controller arbitration process management directory, based on the sample file.</p><pre>Sample file</pre><pre class="border"><span class="i">installDir</span>\share\mcarb_network.conf.sample</pre><p>In network.conf, specify the IP address or host name and port number of the primary server and standby server, and define the Mirroring Controller network configuration that will be managed by the Mirroring Controller arbitration process.</p><p>Refer to "<a href="b1440-a-03-00.html">A.3 Network Configuration File</a>" for details.</p><p>A definition example is shown below.</p><pre>Example)The IDs of the servers are set to "server1" and "server2", and their port numbers are set to "27541".</pre><pre class="border">server1 192.0.3.100 27541server2 192.0.3.110 27541</pre></li><li><p>Change the access permissions for network.conf.</p><p>For network.conf, set read and write permissions only for the operating system user who starts and stops the arbitration process in step 1. If users other than this are granted access permissions, the mc_arb command will not work. Accordingly, users other than the operating system user who starts and stops the arbitration process in step 1 are prevented from operating the Mirroring Controller arbitration process.</p><pre>Example)The following is an execution example, in which the operating system user who starts and stops the arbitration process in step 1 is granted full access permissions as the owner when the user is "fsepuser". The following procedure applies when the user is logged in to the Windows server as "fsepuser".</pre><pre class="border">&gt; takeown /f network.conf&gt; icacls network.conf /reset&gt; icacls network.conf /inheritance:r&gt; icacls network.conf /grant fsepuser:F</pre></li><li><p>In the arbitration configuration file (arbitration.conf), define the information related to control of the Mirroring Controller arbitration process.</p><p>Create arbitration.conf in the Mirroring Controller arbitration process management directory, based on the sample file.</p><pre>Sample file</pre><pre class="border"><span class="i">installDir</span>\share\mcarb_arbitration.conf.sample</pre><p>Set the parameters shown in the table below in arbitration.conf.</p><table><caption>Table&nbsp;2.2 Parameters</caption><col><col><col><tr><th valign="top"><p>Parameter</p></th><th valign="top"><p>Content specified</p></th><th valign="top"><p>Remarks</p></th></tr><tr><td align="left" valign="top"><p>port</p></td><td align="left" valign="top"><p>Port number of the Mirroring Controller arbitration process</p></td><td align="left" valign="top"><p>The port number must be 0 to 65535. Ensure that the port number does not conflict with other software. Do not specify an ephemeral port that may temporarily be assigned by another program.</p></td></tr><tr><td align="left" valign="top"><p>my_address</p></td><td align="left" valign="top"><p>'<span class="i">ipAddr</span><span class="i">OrHostName</span><span class="i">ThatAcceptsConnectionFromMirroringControllerProcessOnD</span><span class="i">b</span><span class="i">Server</span>'</p><p>[Setting example]</p><p>my_address = '192.0.3.120'</p></td><td align="left" valign="top"><p>IPv4 and IPv6 addresses can be specified.</p><p>Enclose the parameter value in single quotation marks (').</p></td></tr><tr><td align="left" valign="top"><p>service_name</p></td><td align="left" valign="top"><p>'<span class="i">registeredServiceNameOfArbitrationProcessInWindowsServices</span>'</p></td><td align="left" valign="top"><p>Use ASCII characters excluding forward slash (/) and backslash (\) to specify this parameter.</p><p>Enclose the parameter value in single quotation marks (').</p><p>The maximum length of the service name is 124 bytes.</p></td></tr><tr><td align="left" valign="top"><p>event_source</p></td><td align="left" valign="top"><p>'<span class="i">eventSourceNameUsedToIdentifyArbitrationProcessMsgInEventLog</span>'</p></td><td align="left" valign="top"><p>Use ASCII characters excluding spaces to specify this parameter.</p><p>Enclose the parameter value in single quotation marks (').</p><p>The maximum length of the event source name is 255 bytes.</p></td></tr><tr><td align="left" valign="top"><p>fencing_command</p></td><td align="left" valign="top"><p>'<span class="i">fencingCmdFilePath</span>'</p><p>[Setting example]</p><p>fencing_command = 'c:\\arbiter\\fencing_dir\\execute_fencing.bat'</p></td><td align="left" valign="top"><p>Specify the full path of the fencing command that fences a database server where it is determined that an error has occurred.</p><p>Specify "\\" as the delimiter.</p><p>Enclose the path in single quotation marks (').</p><p>Specify the path using less than 260 bytes.</p><p>Any multibyte characters must use the same encoding as the operating system.</p></td></tr><tr><td align="left" valign="top"><p>fencing_command_timeout</p></td><td align="left" valign="top"><p>Timeout for fencing command (seconds)</p></td><td align="left" valign="top"><p>If the command does not respond within the specified number of seconds, it is determined that fencing has failed and a signal (SIGTERM) is sent to the fencing command execution process.</p><p>Specify a value between 1 and 2147483647.</p><p>The default is 20 seconds.</p></td></tr></table><br><div class="tips"><p class="title">Information</p><div class="tipsbody"><p>Refer to "<a href="b1440-a-04-02.html">A.4.2 Arbitration Configuration File</a>" for information on the parameters and for other parameters.</p></div></div></li><li><p>Change the access permissions for arbitration.conf.</p><p>For arbitration.conf, set read and write permissions only for the operating system user who starts and stops the arbitration process in step 1. If users other than this are granted access permissions, the mc_arb command will not work.</p><pre>Example)The following is an execution example, in which the operating system user who starts and stops the arbitration process in step 1 is granted full access permissions as the owner when the user is "fsepuser". The following procedure applies when the user is logged in to the Windows server as "fsepuser".</pre><pre class="border">&gt; takeown /f arbitration.conf&gt; icacls arbitration.conf /reset&gt; icacls arbitration.conf /inheritance:r&gt; icacls arbitration.conf /grant fsepuser:F</pre></li><li><p>Configure Windows Firewall.</p><p>If Windows Firewall is used, enable the port number of Mirroring Controller specified in the network configuration file in step 3. Refer to "<a href="b1440-e-02-00.html">E.2 Windows Firewall Settings</a>" for details.</p></li><li><p>Register the Mirroring Controller arbitration process as a Windows service.</p><p>Execute the mc_arb command in register mode.</p><p>For the -P option of the mc_arb command, specify the password of the operating system user who executes the command.</p><pre>Example)</pre><pre class="border">&gt; mc_arb register -M D:\mcarb_dir\arbiter1 -P ********</pre><div class="note"><p class="title">Note</p><div class="notebody"><p>When specifying the password in the -P option of the mc_arb command, for security reasons, you should be careful not to allow other users to access it.</p></div></div><div class="tips"><p class="title">Information</p><div class="tipsbody"><p>Use the mc_arb command with the -S option to specify automatic start and stop of the Mirroring Controller arbitration process. Refer to "<a href="b1440-00-02-13-00.html">2.13 Setting Automatic Start and Stop of the Mirroring Controller Arbitration Process</a>" for details.</p></div></div><p>The Mirroring Controller arbitration process is registered as a Windows service using the service name specified in the service_name parameter of arbitration.conf in step 6.</p><p>You can execute the sc qc command to check the registration status.</p></li></ol><p></p></div></div><div class="header_footer"><div class="back_next"><a href="b1440-00-02-03-00.html"><img src="image/back2.gif" width="65" height="27" border="0" alt="Previous" title="Previous"></a><a href="b1440-00-02-03-02.html"><img src="image/next2.gif" width="64" height="27" border="0" alt="Next" title="Next"></a></div><div class="copyright">Copyright 2016-2021 FUJITSU LIMITED</div></div></body></html>