<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"><html lang="en"><head><META http-equiv="Content-Type" content="text/html; charset=UTF-8"><META CONTENT="4.3" NAME="GeneratorVersion"><title>2.6 Creating a User Exit for a Database Server</title><link rel="stylesheet" href="manualmain.css" type="TEXT/CSS"><script language="JavaScript" src="topbutton.js"></script></head><body onload="init()"><div class="topButton" id="topButton0"><a class="topButton" href="#top"><img src="image/top.gif" width="62" height="20" border="0" alt="Top" title="Top"></a></div><div class="top_header"><div class="top_header_title"><a title="Title Page" class="top_link" target="_top" HREF="index.html">Enterprise Postgres 13&nbsp;Cluster Operation Guide(Database Multiplexing)</a></div><div class="top_header_graphic"><span class="top_logo"><img src="image/logo-white-fj.gif" width="148" height="32" alt=""></span><span class="top_keygraphic"><img src="image/cover-header-graphic.gif" width="148" height="32" alt="FUJITSU Software"></span></div></div><div class="header_footer"><div class="breadcrumbslist"><a href="b1440-00-02-00-00.html">Chapter&nbsp;2 Setting Up Database Multiplexing Mode</a> &gt; 2.6 Creating a User Exit for a Database Server</div><div class="back_next"><a href="b1440-00-02-05-03.html"><img src="image/back2.gif" width="65" height="27" border="0" alt="Previous" title="Previous"></a><a href="b1440-00-02-07-00.html"><img src="image/next2.gif" width="64" height="27" border="0" alt="Next" title="Next"></a></div></div><h2 id="mID_0606_user_exit">2.6 Creating a User Exit for a Database Server</h2><div class="body"><div class="textblock"><p>This section explains how to create a user exit for a database server.</p><p>The user command types explained below can be used as user exits. These commands are called by Mirroring Controller management processes.</p><p>The user can create user exits as required.</p><p>Specify the user commands that were created for the parameters in the server configuration file of the database server. Refer to "<a href="b1440-a-04-01.html">A.4.1 Server Configuration File for the Database Servers</a>" for information on these parameters.</p><p></p></div><p class="subhead_1" id="IDclust06N13"><span class="em">User command types</span></p><div class="textblock"><ul><li><p>Fencing command</p><p>This user command performs fencing if Mirroring Controller performs arbitration processing and determines that a database server is unstable.</p></li><li><p>Arbitration command</p><p>This user command performs arbitration processing in lieu of the arbitration server when there is no arbitration server.</p></li><li><p>State transition commands</p><p>These user commands are called when Mirroring Controller performs state transition of a database server.<br>It includes the following types:</p><ul><li><p>Post-switch command</p><p>This user command is called after a promotion from standby server to primary server.</p></li><li><p>Pre-detach command</p><p>This user command is called before the standby server is disconnected from a cluster system.<br>If the pre-detach command is specified on both the primary server and standby server, it is called first on the standby server and then on the primary server.</p><p>If the settings are configured to forcibly stop the instance on the standby server when the standby server is disconnected, the pre-detach command is called on the standby server and then the instance on the standby server is stopped.</p></li><li><p>Post-attach command</p><p>This user command is called after the standby server has been attached to a cluster system.<br>If the post-attach command is specified on both the primary server and standby server, it is called first on the primary server and then on the standby server.</p></li></ul></li></ul><div class="point"><p class="title">Point</p><div class="pointbody"><p>When the arbitration server is used for automatic degradation and the requirements can be satisfied using the fencing command on the arbitration server only, the fencing command on the database server is not required. In addition, if the requirements can be satisfied using the fencing command on the database server only, create a fencing command on the arbitration server for termination processing only (without implementation).</p></div></div><br><table><caption>Table&nbsp;2.6 Availability of user commands, and database server calling the command</caption><col><col><col><col><col><col><col><tr><th rowspan="2" height="19" valign="middle"><p>User command</p></th><th colspan="4" height="19" valign="middle"><p>Operation when a heartbeat abnormality is detected using operating system or server heartbeat monitoring</p></th><th colspan="2" height="19" valign="middle"><p>Database server calling the command</p></th></tr><tr><th height="4" valign="middle"><p>Message output</p></th><th height="4" valign="middle"><p>Automatic degradation by arbitration server</p></th><th height="4" valign="middle"><p>Automatic degradation by arbitration command</p></th><th height="4" valign="middle"><p>Unconditional automatic degradation</p></th><th height="4" valign="middle"><p>Primary server</p></th><th height="4" valign="middle"><p>Standby server</p></th></tr><tr><td height="15" align="left" valign="top"><p>Fencing command</p></td><td height="15" align="left" valign="top"><p>Y <span class="inline-note">*1</span></p></td><td height="15" align="left" valign="top"><p>Y <span class="inline-note">*2</span></p></td><td height="15" align="left" valign="top"><p>R</p></td><td height="15" align="left" valign="top"><p>N</p></td><td height="15" align="left" valign="top"><p>Y</p></td><td height="15" align="left" valign="top"><p>Y</p></td></tr><tr><td height="4" align="left" valign="top"><p>Arbitration command</p></td><td height="4" align="left" valign="top"><p>N</p></td><td height="4" align="left" valign="top"><p>N</p></td><td height="4" align="left" valign="top"><p>R</p></td><td height="4" align="left" valign="top"><p>N</p></td><td height="4" align="left" valign="top"><p>Y</p></td><td height="4" align="left" valign="top"><p>Y</p></td></tr><tr><td height="4" align="left" valign="top"><p>Post-switch command</p></td><td height="4" align="left" valign="top"><p>Y</p></td><td height="4" align="left" valign="top"><p>Y</p></td><td height="4" align="left" valign="top"><p>Y</p></td><td height="4" align="left" valign="top"><p>Y</p></td><td height="4" align="left" valign="top"><p>Y</p></td><td height="4" align="left" valign="top"><p>N</p></td></tr><tr><td height="4" align="left" valign="top"><p>Pre-detach command</p></td><td height="4" align="left" valign="top"><p>Y</p></td><td height="4" align="left" valign="top"><p>Y</p></td><td height="4" align="left" valign="top"><p>Y</p></td><td height="4" align="left" valign="top"><p>Y</p></td><td height="4" align="left" valign="top"><p>Y</p></td><td height="4" align="left" valign="top"><p>Y <span class="inline-note">*3</span></p></td></tr><tr><td height="4" align="left" valign="top"><p>Post-attach command</p></td><td height="4" align="left" valign="top"><p>Y</p></td><td height="4" align="left" valign="top"><p>Y</p></td><td height="4" align="left" valign="top"><p>Y</p></td><td height="4" align="left" valign="top"><p>Y</p></td><td height="4" align="left" valign="top"><p>Y</p></td><td height="4" align="left" valign="top"><p>Y <span class="inline-note">*3</span></p></td></tr></table><p class="supple">R: Required</p><p class="supple">Y: Can be used</p><p class="supple">N: Cannot be used</p><p class="supple">*1: Called only when the mc_ctl command is used to execute forced switching or forced disconnection.</p><p class="supple">*2: Creation of a fencing command on a database server is optional, but it must be created on the arbitration server.</p><p class="supple">*3: If message output or unconditional automatic degradation is selected, this command is called only from the primary server.</p><div class="ref"><p class="title">See</p><div class="refbody"><p>Refer to "<a href="b1440-c-00-00.html">Appendix&nbsp;C User Commands</a>" for information on the interface for each user command.</p></div></div></div></div><div class="header_footer"><div class="back_next"><a href="b1440-00-02-05-03.html"><img src="image/back2.gif" width="65" height="27" border="0" alt="Previous" title="Previous"></a><a href="b1440-00-02-07-00.html"><img src="image/next2.gif" width="64" height="27" border="0" alt="Next" title="Next"></a></div><div class="copyright">Copyright 2016-2021 FUJITSU LIMITED</div></div></body></html>