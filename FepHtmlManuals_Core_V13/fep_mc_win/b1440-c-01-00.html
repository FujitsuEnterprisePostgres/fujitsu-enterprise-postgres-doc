<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"><html lang="en"><head><META http-equiv="Content-Type" content="text/html; charset=UTF-8"><META CONTENT="4.3" NAME="GeneratorVersion"><title>C.1 Fencing Command</title><link rel="stylesheet" href="manualmain.css" type="TEXT/CSS"><script language="JavaScript" src="topbutton.js"></script></head><body onload="init()"><div class="topButton" id="topButton0"><a class="topButton" href="#top"><img src="image/top.gif" width="62" height="20" border="0" alt="Top" title="Top"></a></div><div class="top_header"><div class="top_header_title"><a title="Title Page" class="top_link" target="_top" HREF="index.html">Enterprise Postgres 13&nbsp;Cluster Operation Guide(Database Multiplexing)</a></div><div class="top_header_graphic"><span class="top_logo"><img src="image/logo-white-fj.gif" width="148" height="32" alt=""></span><span class="top_keygraphic"><img src="image/cover-header-graphic.gif" width="148" height="32" alt="FUJITSU Software"></span></div></div><div class="header_footer"><div class="breadcrumbslist"><a href="b1440-c-00-00.html">Appendix&nbsp;C User Commands</a> &gt; C.1 Fencing Command</div><div class="back_next"><a href="b1440-c-00-00.html"><img src="image/back2.gif" width="65" height="27" border="0" alt="Previous" title="Previous"></a><a href="b1440-c-02-00.html"><img src="image/next2.gif" width="64" height="27" border="0" alt="Next" title="Next"></a></div></div><h2 id="IDclust0eN1">C.1 Fencing Command<a name="N129G"></a></h2><div class="body"><div class="textblock"><p></p></div><p class="subhead_1" id="IDclust0eN2"><span class="em">Format</span></p><div class="textblock"><p>The syntax for calling the fencing command from the Mirroring Controller process or the Mirroring Controller arbitration process is described below.</p><dl><dt class="em">Fencing command of the database server</dt><dd><pre class="border"><span class="i">fencing</span><span class="i">Cmd</span> <span class="i">executionMode </span><span class="i">m</span><span class="i">cD</span><span class="i">egradationOper </span><span class="i">cmdServerId</span> <span class="i">targetServerId</span><span class="i"> </span>primarycenter</pre></dd></dl><dl><dt class="em">Fencing command of the arbitration server</dt><dd><pre class="border"><span class="i">fencing</span><span class="i">Cmd</span> <span class="i">executionMode</span> <span class="i">mcD</span><span class="i">egradationOper </span><span class="i">targetServerId</span></pre></dd></dl></div><p class="subhead_1" id="IDclust0eN3"><span class="em">Input</span></p><div class="textblock"><dl><dt class="em">Fencing command of the database server</dt><dd><dl><dt class="em">Execution mode</dt><dd><p>monitor: Detect issues via automatic monitoring of the Mirroring Controller process</p><p>command: Mirroring Controller command execution (switch mode or detach mode of the mc_ctl command)</p></dd></dl><dl><dt class="em">Degradation operation to be performed by Mirroring Controller</dt><dd><p>switch: Switch</p><p>detach: Disconnect</p></dd></dl><dl><dt class="em"><span class="i">cmd</span><span class="i">S</span><span class="i">erver</span><span class="i">I</span><span class="i">d</span></dt><dd><p>ID of the database server that called the command</p></dd></dl><dl><dt class="em"><span class="i">target</span><span class="i">S</span><span class="i">erver</span><span class="i">I</span><span class="i">d</span></dt><dd><p>ID of the database server to be fenced</p></dd></dl><dl><dt class="em">primarycenter</dt><dd><p>Fixed value</p></dd></dl></dd></dl><dl><dt class="em">Fencing command of the arbitration server</dt><dd><dl><dt class="em">Execution mode</dt><dd><p>monitor: Detect issues via automatic monitoring of the Mirroring Controller process</p><p>command: Mirroring Controller command execution (switch mode or detach mode of the mc_ctl command)</p></dd></dl><dl><dt class="em">Degradation operation to be performed by Mirroring Controller</dt><dd><p>switch: Switch</p><p>detach: Disconnect</p></dd></dl><dl><dt class="em"><span class="i">target</span><span class="i">S</span><span class="i">erver</span><span class="i">I</span><span class="i">d</span></dt><dd><p>ID of the database server to be fenced</p></dd></dl></dd></dl></div><p class="subhead_1" id="IDclust0eN4"><span class="em">Output</span></p><div class="textblock"><dl><dt class="em">Return value</dt><dd><p>0: Mirroring Controller will continue the degradation process.</p><p>Other than 0: Mirroring Controller will cancel the degradation process.</p></dd></dl></div><p class="subhead_1" id="IDclust0eN5"><span class="em">Description</span></p><div class="textblock"><p>Identifies the database server targeted for fencing based on the input server identifier, and implements the process that isolates it from the cluster system.</p></div><p class="subhead_1" id="IDclust0eN6"><span class="em">Notes</span></p><div class="textblock"><ul><li><p>The command is executed by the operating system user who started Mirroring Controller or the Mirroring Controller arbitration process. Therefore, if the command is to be executed by a specific operating system user, change the executing user of the command accordingly.</p></li><li><p>The operating system user who started Mirroring Controller or the Mirroring Controller arbitration process must have execution privileges to the command. Otherwise, the degradation process will be canceled.</p></li><li><p>From a security point of view, set the access privileges as necessary so that the fencing command is not overwritten and unauthorized operations are not performed by unintended operating system users.</p></li><li><p>If the fencing command returns a value other than 0, Mirroring Controller will cancel the degradation process, so it is necessary for the user to check the status of the server, and switch or disconnect it manually.</p></li><li><p>Before executing the fencing command, check if the server is already fenced, to avoid the command terminating abnormally.</p></li><li><p>If the command times out, Mirroring Controller will stop the command, output an error message, and cancel the degradation process.</p></li></ul></div><p class="subhead_1" id="IDclust0eN7"><span class="em">Information</span></p><div class="textblock"><p>The fencing command can be implemented by simply stopping the operating system or server. For example, if stopping the power for the database server, it is possible to use a utility to control the hardware control board in environments equipped with boards compatible with IPMI hardware standard.</p><dl><dd></dd></dl><dl><dt class="em">Linux</dt><dd><p>Below is a sample script of a fencing command that powers off the database server using the IPMI tool.</p><pre>Sample shell script</pre><pre class="border">/<span class="i">installDir</span>/share/mcarb_execute_fencing.sh.sample</pre></dd></dl><dl><dt class="em">Windows</dt><dd><p>Below is a sample script of a fencing command that powers off the database server using IPMIUTIL.</p><pre>Sample shell script</pre><pre class="border"><span class="i">installDir</span>\share\mcarb_execute_fencing.bat.sample</pre></dd></dl></div></div><div class="header_footer"><div class="back_next"><a href="b1440-c-00-00.html"><img src="image/back2.gif" width="65" height="27" border="0" alt="Previous" title="Previous"></a><a href="b1440-c-02-00.html"><img src="image/next2.gif" width="64" height="27" border="0" alt="Next" title="Next"></a></div><div class="copyright">Copyright 2016-2021 FUJITSU LIMITED</div></div></body></html>