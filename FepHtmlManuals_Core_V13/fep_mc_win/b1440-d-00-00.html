<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"><html lang="en"><head><META http-equiv="Content-Type" content="text/html; charset=UTF-8"><META CONTENT="4.3" NAME="GeneratorVersion"><title>Appendix&nbsp;D Notes on Performing Automatic Degradation Immediately after a Heartbeat Abnormality</title><link rel="stylesheet" href="manualmain.css" type="TEXT/CSS"><script language="JavaScript" src="topbutton.js"></script></head><body onload="init()"><div class="topButton" id="topButton0"><a class="topButton" href="#top"><img src="image/top.gif" width="62" height="20" border="0" alt="Top" title="Top"></a></div><div class="top_header"><div class="top_header_title"><a title="Title Page" class="top_link" target="_top" HREF="index.html">Enterprise Postgres 13&nbsp;Cluster Operation Guide(Database Multiplexing)</a></div><div class="top_header_graphic"><span class="top_logo"><img src="image/logo-white-fj.gif" width="148" height="32" alt=""></span><span class="top_keygraphic"><img src="image/cover-header-graphic.gif" width="148" height="32" alt="FUJITSU Software"></span></div></div><div class="header_footer"><div class="breadcrumbslist">Appendix&nbsp;D Notes on Performing Automatic Degradation Immediately after a Heartbeat Abnormality</div><div class="back_next"><a href="b1440-c-03-03.html"><img src="image/back2.gif" width="65" height="27" border="0" alt="Previous" title="Previous"></a><a href="b1440-e-00-00.html"><img src="image/next2.gif" width="64" height="27" border="0" alt="Next" title="Next"></a></div></div><h1 id="mID_f" class="app">Appendix&nbsp;D Notes on Performing Automatic Degradation Immediately after a Heartbeat Abnormality<a name="N135G"></a></h1><div class="body"><div class="textblock"><p>The type of issue below occurs if automatic degradation is performed unconditionally after an issue is detected during heartbeat monitoring of an operating system or server, and heartbeat monitoring was not properly tuned.</p><p><img src="clust0fimg/e-0609-tuning2.gif" alt="" width="886" height="510"></p><p><img src="clust0fimg/e-0609-tuning3.gif" alt="" width="852" height="666"></p><p></p><p></p></div><p class="subhead_1" id="IDclust0fN1"><span class="em">Notes </span><span class="em">on </span><span class="em">monitoring when the operating system or server crashes or is unresponsive</span></p><div class="textblock"><p>As illustrated in the diagram above, timeout is used to monitor whether the operating system or server crashes or is unresponsive. Therefore, if tuning has not been performed correctly, there is a risk of a split-brain mistakenly occurring even if the server is in a sound state.</p><p>Split-brain is a phenomenon in which both servers temporarily operate as primary servers, causing data updates to be performed on both servers.</p><dl><dt class="em" id="mID_060904_dtctBR">Split-brain detection method</dt><dd><p>It can be confirmed that split-brain occurs under the following conditions:</p><ol><li><p>When the mc_ctl command is executed in status mode on both servers, the "host_role" of both servers is output as "primary", and</p></li><li><p>The following message is output to the system log of one of the servers:</p><pre class="border">promotion processing completed (MCA00062)</pre></li></ol></dd></dl><dl><dt class="em" id="mID_060904_recvBR">How to recover from a split-brain</dt><dd><p>Use the procedure described below. Note that the new primary server is the server that was confirmed in step 2 of the aforementioned detection method.</p><ol><li><p>Stop all applications that are running on the old and new primary servers.</p></li><li><p>Investigate and recover the database. <br>Investigate the update results that have not been reflected to the new primary server from the database of the old primary server, and apply to the new primary server as necessary.</p></li><li><p>Stop the old primary server instance and the Mirroring Controller.</p></li><li><p>Resume the applications that were stopped in step 1.</p></li><li><p>Recover the old primary server. <br>While referring to "<a href="b1440-00-02-05-00.html">2.5 Setting Up the Standby Server</a>", build (set up) the old primary server as the new standby server, from the new primary server.</p></li></ol></dd></dl></div></div><div class="header_footer"><div class="back_next"><a href="b1440-c-03-03.html"><img src="image/back2.gif" width="65" height="27" border="0" alt="Previous" title="Previous"></a><a href="b1440-e-00-00.html"><img src="image/next2.gif" width="64" height="27" border="0" alt="Next" title="Next"></a></div><div class="copyright">Copyright 2016-2021 FUJITSU LIMITED</div></div></body></html>