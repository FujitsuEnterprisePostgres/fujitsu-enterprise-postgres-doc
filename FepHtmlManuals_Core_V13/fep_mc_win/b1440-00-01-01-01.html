<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"><html lang="en"><head><META http-equiv="Content-Type" content="text/html; charset=UTF-8"><META CONTENT="4.3" NAME="GeneratorVersion"><title>1.1.1 Monitoring Using Database Multiplexing Mode</title><link rel="stylesheet" href="manualmain.css" type="TEXT/CSS"><script language="JavaScript" src="topbutton.js"></script></head><body onload="init()"><div class="topButton" id="topButton0"><a class="topButton" href="#top"><img src="image/top.gif" width="62" height="20" border="0" alt="Top" title="Top"></a></div><div class="top_header"><div class="top_header_title"><a title="Title Page" class="top_link" target="_top" HREF="index.html">Enterprise Postgres 13&nbsp;Cluster Operation Guide(Database Multiplexing)</a></div><div class="top_header_graphic"><span class="top_logo"><img src="image/logo-white-fj.gif" width="148" height="32" alt=""></span><span class="top_keygraphic"><img src="image/cover-header-graphic.gif" width="148" height="32" alt="FUJITSU Software"></span></div></div><div class="header_footer"><div class="breadcrumbslist"><a href="b1440-00-01-00-00.html">Chapter&nbsp;1 Overview of Database Multiplexing Mode</a> &gt; <a href="b1440-00-01-01-00.html">1.1 What is Database Multiplexing Mode</a> &gt; 1.1.1 Monitoring Using Database Multiplexing Mode</div><div class="back_next"><a href="b1440-00-01-01-00.html"><img src="image/back2.gif" width="65" height="27" border="0" alt="Previous" title="Previous"></a><a href="b1440-00-01-01-02.html"><img src="image/next2.gif" width="64" height="27" border="0" alt="Next" title="Next"></a></div></div><h3 id="mID_050101">1.1.1 Monitoring Using Database Multiplexing Mode<a name="N3G"></a></h3><div class="body"><div class="textblock"><p>In database multiplexing mode, perform the monitoring below.</p><ul><li><p>Operating system or server failures, and no-response state</p><p>By generating a heartbeat between Mirroring Controller on each server, operating system or server errors are detected and acknowledged between the relevant servers.</p><p>The optimal operating method for environments where database multiplexing mode is performed can be selected from the following:</p><ul><li><p>Use the arbitration server to perform automatic degradation (switch/disconnect)</p><p>This is the default method.</p><p>The arbitration server objectively determines the status of database servers, then isolates and degrades from the cluster system the ones with an unstable status.</p><p>Refer to "<a href="b1440-00-01-01-00.html#mID_050101_arbiter_sv">Database degradation using the arbitration server</a>" for details.</p></li><li><p>Call the user exit (user command) that will perform the degradation decision, and perform automatic degradation</p><p>If the arbitration server cannot be installed, select if arbitration processing can be performed by the user instead.</p><p>Mirroring Controller queries the user exit on whether to degrade. The user exit determines the status of the database server, and notifies Mirroring Controller whether to perform degradation.</p><p>Refer to "<a href="b1440-00-01-01-00.html#mID_050101_arbiter_cmd">Database degradation using the arbitration command</a>" for details.</p></li><li><p>Notification messages</p><p>Use this method if using a two-database server configuration.</p><p>Mirroring Controller outputs messages to the event log when an abnormality is detected. This ensures that a split brain will not occur due to a heartbeat abnormality - however, automatic switching will not be performed if the primary server operating system or server fails or becomes unresponsive.</p></li><li><p>Perform automatic degradation unconditionally after a heartbeat abnormality</p><p>This method is handled as in FUJITSU Enterprise Postgres 9.6 or earlier versions.</p><p>This method is not recommended, because Mirroring Controller unconditionally will perform automatic degradation after heartbeat abnormalities.</p></li></ul></li><li><p>Database process failures, and no-response state</p><p>Mirroring Controller periodically accesses the database processes and checks the status. A process error is detected by monitoring whether an access timeout occurs.</p></li><li><p>Disk failure</p><p>Mirroring Controller periodically creates files on the data storage destination disk below. A disk error is detected when an I/O error occurs.</p><ul><li><p>Data storage destination disk</p></li><li><p>Transaction log storage destination disk</p></li><li><p>Tablespace storage destination disk</p></li></ul><p>Failures that can be detected are those that physically affect the entire system, such as disk header or device power failures.</p></li><li><p>Streaming replication issue</p><p>Mirroring Controller detects streaming replication issues (log transfer network and WAL send/receive processes) by periodically accessing the PostgreSQL system views.</p></li><li><p>Mirroring Controller process failure and no response</p><p>In order to continue the monitoring process on Mirroring Controller, Mirroring Controller process failures and no responses are also monitored.</p><p>The Mirroring Controller monitoring process detects Mirroring Controller process failures and no responses by periodically querying the Mirroring Controller process. If an issue is detected, Mirroring Controller is automatically restarted by the Mirroring Controller monitoring process.</p></li></ul><div class="point"><p class="title">Point</p><div class="pointbody"><ul><li><p>If output of messages is selected as the operation to be performed when a heartbeat abnormality is detected during heartbeat monitoring of the operating system or server, automatic degradation will not be performed.<br>However, if an issue in the WAL send process is detected on the primary server, then the standby server will be disconnected, and as a result an automatic disconnection may be performed even if the standby server operating system or server fails or becomes unresponsive.</p></li><li><p>You can select in the parameters if the primary server will be switched if a database process is unresponsive or if tablespace storage destination disk failure is detected. Refer to "<a href="b1440-a-00-00.html">Appendix&nbsp;A Parameters</a>" for details.</p></li><li><p>If the standby server was disconnected, Mirroring Controller will automatically comment out the synchronous_standby_names parameter in the postgresql.conf file of the primary server. Accordingly, you can prevent the application processing for the primary server being stopped.</p></li></ul></div></div><div class="note"><p class="title">Note</p><div class="notebody"><p>If the role of primary server was switched to another server and then starts degrading, the original primary server will not become the standby server automatically. Remove the cause of the error, and then change the role of the original primary server to the server currently acting as standby server. Refer to "<a href="b1440-00-04-01-00.html">4.1 Action Required when Server Degradation Occurs</a>" for details.</p></div></div><p></p></div></div><div class="header_footer"><div class="back_next"><a href="b1440-00-01-01-00.html"><img src="image/back2.gif" width="65" height="27" border="0" alt="Previous" title="Previous"></a><a href="b1440-00-01-01-02.html"><img src="image/next2.gif" width="64" height="27" border="0" alt="Next" title="Next"></a></div><div class="copyright">Copyright 2016-2021 FUJITSU LIMITED</div></div></body></html>