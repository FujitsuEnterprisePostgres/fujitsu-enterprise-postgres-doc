<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"><html lang="en"><head><META http-equiv="Content-Type" content="text/html; charset=UTF-8"><META CONTENT="4.3" NAME="GeneratorVersion"><title>2.5.1 Setting Up Database Multiplexing Mode on the Standby Server</title><link rel="stylesheet" href="manualmain.css" type="TEXT/CSS"><script language="JavaScript" src="topbutton.js"></script></head><body onload="init()"><div class="topButton" id="topButton0"><a class="topButton" href="#top"><img src="image/top.gif" width="62" height="20" border="0" alt="Top" title="Top"></a></div><div class="top_header"><div class="top_header_title"><a title="Title Page" class="top_link" target="_top" HREF="index.html">Enterprise Postgres 13&nbsp;Cluster Operation Guide(Database Multiplexing)</a></div><div class="top_header_graphic"><span class="top_logo"><img src="image/logo-white-fj.gif" width="148" height="32" alt=""></span><span class="top_keygraphic"><img src="image/cover-header-graphic.gif" width="148" height="32" alt="FUJITSU Software"></span></div></div><div class="header_footer"><div class="breadcrumbslist"><a href="b1440-00-02-00-00.html">Chapter&nbsp;2 Setting Up Database Multiplexing Mode</a> &gt; <a href="b1440-00-02-05-00.html">2.5 Setting Up the Standby Server</a> &gt; 2.5.1 Setting Up Database Multiplexing Mode on the Standby Server</div><div class="back_next"><a href="b1440-00-02-05-00.html"><img src="image/back2.gif" width="65" height="27" border="0" alt="Previous" title="Previous"></a><a href="b1440-00-02-05-02.html"><img src="image/next2.gif" width="64" height="27" border="0" alt="Next" title="Next"></a></div></div><h3 id="mID_060401">2.5.1 Setting Up Database Multiplexing Mode on the Standby Server<a name="N42G"></a></h3><div class="body"><div class="textblock"><p>This section explains how to set up database multiplexing mode on the standby server.</p><p>In database multiplexing, the files that are required for operations are managed in the Mirroring Controller management directory.</p><p>There is one Mirroring Controller management directory for each instance.</p><div class="note"><p class="title">Note</p><div class="notebody"><ul><li><p>Do not place the Mirroring Controller management directory in a directory managed by FUJITSU Enterprise Postgres, otherwise it may be deleted by mistake with the directories managed by FUJITSU Enterprise Postgres, and an old version of files may be restored.</p></li><li><p>When creating a standby server for a large database, stop job system operations, specify a large value for the wal_keep_size parameter, or use replication slots.<br>This is because WALs generated after the standby server is built using the pg_basebackup command, but before it is started, need to be retained. However, the number of WAL segments that can be retained is constrained by the wal_keep_size parameter.<br>Additionally, setting the wal_keep_size parameter requires consideration regarding stabilization of the database multiplexing mode (refer to "<a href="b1440-00-02-11-01.html">2.11.1 Tuning to Stabilize the Database Multiplexing Mode</a>" for details).</p></li></ul></div></div><div class="ref"><p class="title">See</p><div class="refbody"><ul><li><p>Refer to "Preparing Directories for Resource Deployment" in the Installation and Setup Guide for Server for details on the directories that are managed by FUJITSU Enterprise Postgres.</p></li><li><p>Refer to "pg_basebackup" in "Reference" in the PostgreSQL Documentation for information on the pg_basebackup command.</p></li><li><p>Refer to "mc_ctl" in Reference for information on the command.</p></li><li><p>Refer to "<a href="b1440-a-00-00.html">Appendix&nbsp;A Parameters</a>" for details on each parameter to be edited for the setup.</p></li><li><p>Refer to "Replication Slots" in the PostgreSQL Documentation for information on replication slots.</p></li></ul></div></div><p>Perform the following procedure:</p><ol><li><p>Log in to the standby server.</p></li><li><p>Create the Mirroring Controller management directory that will store the files required by database multiplexing.</p><p>Use ASCII characters in the Mirroring Controller management directory.</p><p>Additionally, grant "Write" permission to the instance administrator user for the Mirroring Controller management directory.</p></li><li><p>Copy, and then deploy, the network.conf file of the primary server.</p><p>Copy the network.conf file that was defined in the primary server setup, and deploy it to the Mirroring Controller management directory of the standby server.</p><p>Register the port number of the standby server that was specified in the network.conf file in the services file, because there are programs, such as WebAdmin, that search an available port number using the services file.</p><p>Register any name as the service name.</p></li><li><p>Change the access permissions for the network.conf file.</p><p>Set read and write permissions for the instance administrator user only. If users other than the instance administrator user are granted access permissions, the mc_ctl command will not work. Accordingly, users other than the instance administrator user are prevented from operating Mirroring Controller.</p><pre>Example)The following is an execution example, in which the instance administrator user is granted full access permissions as the owner when the operating system user name of the instance administrator user is "fsepuser". The following procedure applies when the user is logged in to the Windows server as "fsepuser".</pre><pre class="border">&gt; takeown /f network.conf&gt; icacls network.conf /reset&gt; icacls network.conf /inheritance:r&gt; icacls network.conf /grant fsepuser:F</pre></li><li><p>Copy, and then deploy, the <span class="i">serverIdentifier</span>.conf file of the primary server.</p><p>Copy the <span class="i">serverIdentifier</span>.conf file that was defined in the primary server setup, and deploy it to the Mirroring Controller management directory of the standby server.</p><div class="note"><p class="title">Note</p><div class="notebody"><p>If the primary server and standby server are to be built within the same server, change the following parameters in the <span class="i">serverIdentifier</span>.conf file, ensuring that the names are not duplicated with those on the primary server:</p><ul><li><p>db_instance_service_name (registered service name of the FUJITSU Enterprise Postgres instance)</p></li><li><p>mc_service_name (registered service name of Mirroring Controller)</p></li><li><p>event_source (event source name)</p></li></ul></div></div></li><li><p>Change the access permissions for the <span class="i">serverIdentifier</span>.conf file.</p><p>Set read and write permissions for the instance administrator user only. If users other than the instance administrator user are granted access permissions, the mc_ctl command will not work.</p><pre>Example)The following is an execution example, in which the instance administrator user is granted full access permissions as the owner when the operating system user name of the instance administrator user is "fsepuser". The following procedure applies when the user is logged in to the Windows server as "fsepuser":</pre><pre class="border">&gt; takeown /f <span class="i">serverIdentifier</span>.conf&gt; icacls <span class="i">serverIdentifier</span>.conf /reset&gt; icacls <span class="i">serverIdentifier</span>.conf /inheritance:r&gt; icacls <span class="i">serverIdentifier</span>.conf /grant fsepuser:F</pre></li><li><p>Configure the Windows firewall.</p><p>If the Windows firewall feature is to be enabled, you should enable the port number of Mirroring Controller that you specified in the network definition file in step 3. Refer to "<a href="b1440-e-02-00.html">E.2 Windows Firewall Settings</a>" for details.</p></li><li><p>Register Mirroring Controller to the Windows service.</p><p>Execute the mc_ctl command in the register mode.</p><p>For the -P option of the mc_ctl command, specify the password of the operating system user who executes the command.</p><pre>Example)</pre><pre class="border">&gt; mc_ctl register -M D:\mcdir\inst1 -P ********</pre><div class="note"><p class="title">Note</p><div class="notebody"><p>When specifying the password in the -P option of the mc_ctl command, for security reasons, you should be careful not to allow other users to access it.</p></div></div><div class="tips"><p class="title">Information</p><div class="tipsbody"><p>You can use the mc_ctl command with the -S option to specify automatic start and stop of Mirroring Controller. Refer to "<a href="b1440-00-02-12-00.html">2.12 Setting Automatic Start and Stop of Mirroring Controller and Multiplexed Instances</a>" for details.</p></div></div><p>Using the service name specified in the mc_service_name parameter of <span class="i">serverIdentifier</span>.conf in step 5, Mirroring Controller is registered to the Windows service.</p><p>You can execute the sc qc command to check the registration status.</p></li></ol><p></p></div></div><div class="header_footer"><div class="back_next"><a href="b1440-00-02-05-00.html"><img src="image/back2.gif" width="65" height="27" border="0" alt="Previous" title="Previous"></a><a href="b1440-00-02-05-02.html"><img src="image/next2.gif" width="64" height="27" border="0" alt="Next" title="Next"></a></div><div class="copyright">Copyright 2016-2021 FUJITSU LIMITED</div></div></body></html>