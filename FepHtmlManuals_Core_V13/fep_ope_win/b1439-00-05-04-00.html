<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"><html lang="en"><head><META http-equiv="Content-Type" content="text/html; charset=UTF-8"><META CONTENT="4.3" NAME="GeneratorVersion"><title>5.4 Encrypting a Tablespace</title><link rel="stylesheet" href="manualmain.css" type="TEXT/CSS"><script language="JavaScript" src="topbutton.js"></script></head><body onload="init()"><div class="topButton" id="topButton0"><a class="topButton" href="#top"><img src="image/top.gif" width="62" height="20" border="0" alt="Top" title="Top"></a></div><div class="top_header"><div class="top_header_title"><a title="Title Page" class="top_link" target="_top" HREF="index.html">Enterprise Postgres 13&nbsp;Operation Guide</a></div><div class="top_header_graphic"><span class="top_logo"><img src="image/logo-white-fj.gif" width="148" height="32" alt=""></span><span class="top_keygraphic"><img src="image/cover-header-graphic.gif" width="148" height="32" alt="FUJITSU Software"></span></div></div><div class="header_footer"><div class="breadcrumbslist"><a href="b1439-00-05-00-00.html">Chapter&nbsp;5 Protecting Storage Data Using Transparent Data Encryption</a> &gt; 5.4 Encrypting a Tablespace</div><div class="back_next"><a href="b1439-00-05-03-00.html"><img src="image/back2.gif" width="65" height="27" border="0" alt="Previous" title="Previous"></a><a href="b1439-00-05-05-00.html"><img src="image/next2.gif" width="64" height="27" border="0" alt="Next" title="Next"></a></div></div><h2 id="br054000">5.4 Encrypting a Tablespace<a name="N37G"></a></h2><div class="body"><div class="textblock"><p>The keystore must be open before you can create an encrypted tablespace.</p><p>When creating a tablespace that will be encrypted, configure the encryption algorithm in the runtime parameters. For example, to create a tablespace with the name secure_tablespace using AES with a key length of 256 bits as the encryption algorithm, configure as shown below.</p><pre class="border">-- Specify the encryption algorithm for the tablespace to be created belowSET tablespace_encryption_algorithm = 'AES256';CREATE TABLESPACE secure_tablespace LOCATION 'C:\My\Data\Dir';-- Specify that the tablespace to be created below is not to be encryptedSET tablespace_encryption_algorithm = 'none';</pre><p>Or</p><pre class="border">CREATE TABLESPACE secure_tablespace LOCATION '\My\Data\Dir' WITH (tablespace_encryption_algorithm = 'AES256' );</pre><p>When the tablespace is empty, the encryption algorithm can be modified with the command below.</p><pre class="border">ALTER TABLESPACE secure_tablespace SET (tablespace_encryption_algorithm=AES256);</pre><p>Trying to set the encryption algorithm for a non-empty tablespace causes an error.</p><p>You can use AES with a key length of 128 bits or 256 bits as the encryption algorithm. It is recommended that you use 256-bit AES. Refer to "<a href="b1439-a-00-00.html">Appendix&nbsp;A Parameters</a>" for information on how to specify the runtime parameters.</p><p>If user provides both GUC and command line options while creating the tablespace, the preference is given to the command line option.</p><p>The pg_default and pg_global tablespaces cannot be encrypted.</p><p>Create tables and indexes in the encrypted tablespace that you created. Relations created in the encrypted tablespace are automatically encrypted.</p><div class="ex"><p class="title">Example</p><div class="exbody"><dl><dt class="em">Example 1: Specifying an encrypted tablespace when creating it</dt><dd><pre class="border">CREATE TABLE my_table (...)    TABLESPACE secure_tablespace;</pre></dd></dl><dl><dt class="em">Example 2: Not explicitly specifying a tablespace when creating it and instead using the default tablespace</dt><dd><pre class="border">SET default_tablespace = 'secure_tablespace';CREATE TABLE my_table (...);</pre></dd></dl></div></div><p>The process is the same for encrypting temporary tables and temporary indexes. In other words, either explicitly specify the TABLESPACE clause or list encrypted tablespaces in the temp_tablespaces parameter, and then execute CREATE TEMPORARY TABLE or CREATE INDEX.</p><div class="point"><p class="title">Point</p><div class="pointbody"><p>If an encrypted tablespace is specified in the TABLESPACE clause of the CREATE DATABASE statement, relations created in the database without explicitly specifying a tablespace will be encrypted. Furthermore, the system catalog will also be encrypted, so the source code of user-defined functions is also protected.</p><dl><dt class="em">Example: Specifying a tablespace in a database definition statement</dt><dd><pre class="border">CREATE DATABASE DB01 TABLESPACE=SP01 ... ;</pre></dd></dl><p>Part of the data is also stored in the system catalog - to encrypt this data as well, specify an encrypted tablespace as above and create a database.</p></div></div><div class="note"><p class="title">Note</p><div class="notebody"><p>An encrypted tablespace cannot be created from the window used for creating the pgAdmin tablespace, or from the query tool. To create an encrypted tablespace, click [PSQL Console] from the [Plugins] menu and create an encrypted tablespace in the psql console window.</p></div></div><p></p></div></div><div class="header_footer"><div class="back_next"><a href="b1439-00-05-03-00.html"><img src="image/back2.gif" width="65" height="27" border="0" alt="Previous" title="Previous"></a><a href="b1439-00-05-05-00.html"><img src="image/next2.gif" width="64" height="27" border="0" alt="Next" title="Next"></a></div><div class="copyright">Copyright 2015-2021 FUJITSU LIMITED</div></div></body></html>