<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"><html lang="en"><head><META http-equiv="Content-Type" content="text/html; charset=UTF-8"><META CONTENT="4.3" NAME="GeneratorVersion"><title>15.3.2 Using the pgx_rcvall Command</title><link rel="stylesheet" href="manualmain.css" type="TEXT/CSS"><script language="JavaScript" src="topbutton.js"></script></head><body onload="init()"><div class="topButton" id="topButton0"><a class="topButton" href="#top"><img src="image/top.gif" width="62" height="20" border="0" alt="Top" title="Top"></a></div><div class="top_header"><div class="top_header_title"><a title="Title Page" class="top_link" target="_top" HREF="index.html">Enterprise Postgres 13&nbsp;Operation Guide</a></div><div class="top_header_graphic"><span class="top_logo"><img src="image/logo-white-fj.gif" width="148" height="32" alt=""></span><span class="top_keygraphic"><img src="image/cover-header-graphic.gif" width="148" height="32" alt="FUJITSU Software"></span></div></div><div class="header_footer"><div class="breadcrumbslist"><a href="b1439-00-15-00-00.html">Chapter&nbsp;15 Actions when an Error Occurs</a> &gt; <a href="b1439-00-15-03-00.html">15.3 Recovering from an Incorrect User Operation</a> &gt; 15.3.2 Using the pgx_rcvall Command</div><div class="back_next"><a href="b1439-00-15-03-01.html"><img src="image/back2.gif" width="65" height="27" border="0" alt="Previous" title="Previous"></a><a href="b1439-00-15-04-00.html"><img src="image/next2.gif" width="64" height="27" border="0" alt="Next" title="Next"></a></div></div><h3 id="br073200">15.3.2 Using the pgx_rcvall Command</h3><div class="body"><div class="textblock"><p>The pgx_rcvall command recovers database clusters to the restore point created with the server command. Refer to "Setting a restore point" in "<a href="b1439-00-03-02-02.html">3.2.2 Using Server Commands</a>" for information on how to create a restore point.</p><p>Follow the procedure below to recover the data in the data storage disk. </p><ol><li><p>Stop applications</p><p>Stop applications that are using the database.</p></li><li><p>Stop the instance</p><p>Stop the instance. Refer to "<a href="b1439-00-02-01-03.html">2.1.2 Using Commands</a>" for information on how to stop an instance.</p><p>If the instance fails to stop, refer to "<a href="b1439-00-15-11-00.html">15.11 Actions in Response to Failure to Stop an Instance</a>".</p></li><li><p>Confirm the restore point</p><dl><dd></dd></dl><p>Use a restore point recorded in an arbitrary file, as explained in ""<a href="b1439-00-03-02-02.html">3.2.2 Using Server Commands</a>", to determine a restore point prior to the erroneous operation.</p></li><li><p>Recover the keystore, and enable automatic opening of the keystore</p><p>When the data in the database has been encrypted, restore the keystore to its state at the time of the database backup. Configure automatic opening of the keystore as necessary.</p></li><li><p>Recover the database cluster</p><p>Use the pgx_rcvall command to recover the database cluster.</p><p>Specify the following values in the pgx_rcvall command:</p><ul><li><p>Specify the data storage destination in the -D option. If the -D option is omitted, the value of the PGDATA environment variable is used by default.</p></li><li><p>Specify the backup data storage destination in the -B option.</p></li><li><p>The -n option recovers the data to the specified restore point.</p></li></ul><dl><dt class="em">Example</dt><dd></dd></dl><p>The following example executes the pgx_rcvall command with the restore point "batch_20200503_1".</p><pre class="border">&gt; pgx_rcvall -D D:\database\inst1 -B E:\backup\inst1 -n batch_20200503_1</pre><div class="note"><p class="title">Note</p><div class="notebody"><p>If recovery fails, remove the cause of the error in accordance with the displayed error message and then re-execute the pgx_rcvall command.</p><p>If the message "pgx_rcvall: an error occurred during recovery" is displayed, then the log recorded when recovery was executed is output after this message. The cause of the error is output in around the last fifteen lines of the log, so remove the cause of the error in accordance with the message and then re-execute the pgx_rcvall command.</p><p>The following message displayed during recovery is output as part of normal operation of pgx_rcvall (therefore the user does not need not be concerned).</p><pre class="border">FATAL: the database system is starting up</pre></div></div></li><li><p>Start the instance</p><p>Start the instance.</p><p>Refer to "<a href="b1439-00-02-01-03.html">2.1.2 Using Commands</a>" for information on how to start an instance.</p><div class="note"><p class="title">Note</p><div class="notebody"><p>The pgx_rcvall command cannot accurately recover a hash index. If you are using a hash index, wait for the instance to start and then execute the REINDEX command for the appropriate index.</p></div></div></li><li><p>Restart operation of the database</p><p>If necessary, re-execute transaction processing from the specified recovery time to the point when an erroneous operation was performed, and then resume database operations.</p></li></ol><div class="ref"><p class="title">See</p><div class="refbody"><p>Refer to "pgx_rcvall" in the Reference for information on the pgx_rcvall command.</p></div></div><p></p></div></div><div class="header_footer"><div class="back_next"><a href="b1439-00-15-03-01.html"><img src="image/back2.gif" width="65" height="27" border="0" alt="Previous" title="Previous"></a><a href="b1439-00-15-04-00.html"><img src="image/next2.gif" width="64" height="27" border="0" alt="Next" title="Next"></a></div><div class="copyright">Copyright 2015-2021 FUJITSU LIMITED</div></div></body></html>