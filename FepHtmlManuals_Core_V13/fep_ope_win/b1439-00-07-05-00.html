<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"><html lang="en"><head><META http-equiv="Content-Type" content="text/html; charset=UTF-8"><META CONTENT="4.3" NAME="GeneratorVersion"><title>7.5 Reorganizing Indexes</title><link rel="stylesheet" href="manualmain.css" type="TEXT/CSS"><script language="JavaScript" src="topbutton.js"></script></head><body onload="init()"><div class="topButton" id="topButton0"><a class="topButton" href="#top"><img src="image/top.gif" width="62" height="20" border="0" alt="Top" title="Top"></a></div><div class="top_header"><div class="top_header_title"><a title="Title Page" class="top_link" target="_top" HREF="index.html">Enterprise Postgres 13&nbsp;Operation Guide</a></div><div class="top_header_graphic"><span class="top_logo"><img src="image/logo-white-fj.gif" width="148" height="32" alt=""></span><span class="top_keygraphic"><img src="image/cover-header-graphic.gif" width="148" height="32" alt="FUJITSU Software"></span></div></div><div class="header_footer"><div class="breadcrumbslist"><a href="b1439-00-07-00-00.html">Chapter&nbsp;7 Periodic Operations</a> &gt; 7.5 Reorganizing Indexes</div><div class="back_next"><a href="b1439-00-07-04-02.html"><img src="image/back2.gif" width="65" height="27" border="0" alt="Previous" title="Previous"></a><a href="b1439-00-07-06-00.html"><img src="image/next2.gif" width="64" height="27" border="0" alt="Next" title="Next"></a></div></div><h2 id="br065000">7.5 Reorganizing Indexes</h2><div class="body"><div class="textblock"><p>Normally, a database defines indexes in tables, but if data is frequently updated, indexes can no longer use free space in the disk efficiently. This situation can also cause a gradual decline in database access performance.</p><p>To rearrange used space on the disk and prevent the database access performance from declining, it is recommended that you periodically execute the REINDEX command to reorganize indexes.</p><p>Check the disk usage of the data storage destination using the method described in "<a href="b1439-00-07-02-00.html">7.2 Monitoring Disk Usage and Securing Free Space</a>".</p><div class="note"><p class="title">Note</p><div class="notebody"><p>Because the REINDEX command retrieves the exclusive lock for an index being processed and locks writing of tables that are the source of the index, other processes that access these may stop while waiting to be locked.</p><p>Therefore, it is necessary to consider measures such as executing the command after the task is completed.</p></div></div><div class="ref"><p class="title">See</p><div class="refbody"><p>Refer to "Routine Reindexing" under "Server Administration" in the PostgreSQL Documentation for information on reorganizing indexes by periodically executing the REINDEX command.</p></div></div><div class="point"><p class="title">Point</p><div class="pointbody"><p>Typically, reorganize indexes once a month at a suitable time such as when conducting database maintenance. Use SQL statements to check index usage. If this usage is increasing on a daily basis, adjust the frequency of recreating the index as compared to the free disk space.</p><p>The following example shows the SQL statements and the output.</p><p>However, when considering continued compatibility of applications, do not reference system catalogs and functions directly in the following SQL statements. Refer to "Notes on Application Compatibility" in the Application Development Guide for details.</p><p><span class="em">[SQL statements]</span></p><pre class="border">SELECT  nspname AS schema_name,  relname AS index_name,  round(100 * pg_relation_size(indexrelid) / pg_relation_size(indrelid)) / 100 AS index_ratio,  pg_size_pretty(pg_relation_size(indexrelid)) AS index_size,  pg_size_pretty(pg_relation_size(indrelid)) AS table_sizeFROM pg_index I  LEFT JOIN pg_class C ON (C.oid = I.indexrelid)  LEFT JOIN pg_namespace N ON (N.oid = C.relnamespace)WHERE  C.relkind = 'i' AND  pg_relation_size(indrelid) &gt; 0ORDER BY pg_relation_size(indexrelid) DESC, index_ratio DESC;</pre><p><span class="em">[Output]</span></p><pre class="border"> schema_name |            index_name            | index_ratio | index_size | table_size -------------+----------------------------------+-------------+------------+------------ public      | pgbench_accounts_pkey            |        0.16 | 2208 KB    | 13 MB pg_catalog  | pg_depend_depender_index         |         0.6 | 224 KB     | 368 KB pg_catalog  | pg_depend_reference_index        |        0.58 | 216 KB     | 368 KB...</pre></div></div><div class="ref"><p class="title">See</p><div class="refbody"><p>Refer to "Notes on Application Compatibility" in the Application Development Guide for information on maintaining application compatibility.</p></div></div><p></p></div></div><div class="header_footer"><div class="back_next"><a href="b1439-00-07-04-02.html"><img src="image/back2.gif" width="65" height="27" border="0" alt="Previous" title="Previous"></a><a href="b1439-00-07-06-00.html"><img src="image/next2.gif" width="64" height="27" border="0" alt="Next" title="Next"></a></div><div class="copyright">Copyright 2015-2021 FUJITSU LIMITED</div></div></body></html>