<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"><html lang="en"><head><META http-equiv="Content-Type" content="text/html; charset=UTF-8"><META CONTENT="4.3" NAME="GeneratorVersion"><title>4.3.2 Using the initdb Command</title><link rel="stylesheet" href="manualmain.css" type="TEXT/CSS"><script language="JavaScript" src="topbutton.js"></script></head><body onload="init()"><div class="topButton" id="topButton0"><a class="topButton" href="#top"><img src="image/top.gif" width="62" height="20" border="0" alt="Top" title="Top"></a></div><div class="top_header"><div class="top_header_title"><a title="Title Page" class="top_link" target="_top" HREF="index.html">Enterprise Postgres 13&nbsp;Installation and Setup Guide for Server</a></div><div class="top_header_graphic"><span class="top_logo"><img src="image/logo-white-fj.gif" width="148" height="32" alt=""></span><span class="top_keygraphic"><img src="image/cover-header-graphic.gif" width="148" height="32" alt="FUJITSU Software"></span></div></div><div class="header_footer"><div class="breadcrumbslist"><a href="b1438-00-04-00-00.html">Chapter&nbsp;4 Setup</a> &gt; <a href="b1438-00-04-03-00.html">4.3 Creating Instances</a> &gt; 4.3.2 Using the initdb Command</div><div class="back_next"><a href="b1438-00-04-03-01.html"><img src="image/back2.gif" width="65" height="27" border="0" alt="Previous" title="Previous"></a><a href="b1438-00-04-04-00.html"><img src="image/next2.gif" width="64" height="27" border="0" alt="Next" title="Next"></a></div></div><h3 id="mID_0402_instance_initdb">4.3.2 Using the initdb Command<a name="N37G"></a></h3><div class="body"><div class="textblock"><p>This section describes the procedure to create an instance using the initdb command.</p><div class="note"><p class="title">Note</p><div class="notebody"><p>If a port is blocked (access permissions have not been granted) by a firewall, enable use of the port by granting access. Refer to the vendor document for information on how to grant port access permissions.<br>Consider the security risks carefully when opening ports.</p></div></div><p></p></div></div><h4 id="IDinsts04-03-wN8">4.3.2.1 Creating an Instance<a name="N38G"></a></h4><div class="body"><div class="textblock"><p>Create an instance, with the database cluster storage destination specified in the PGDATA environment variable or in the -D option. Furthermore, the user that executed the initdb command becomes the instance administrator.</p><div class="note"><p class="title">Note</p><div class="notebody"><ul><li><p>Instances created using the initdb command (command line instances) can be managed using WebAdmin, however, they must first be imported into WebAdmin. Refer to "<a href="b1438-00-04-03-01.html#mID_0403_WebAdmin_import">4.3.1.4 Importing Instances</a>" for details.</p></li><li><p>If creating multiple instances, ensure that there is no duplication of port numbers or the directories that store database clusters.</p></li></ul></div></div><div class="ref"><p class="title">See</p><div class="refbody"><p>Refer to "initdb" in "Reference" in the PostgreSQL Documentation for information on the initdb command. </p></div></div><p>The procedure to create an instance is described below.</p><ol><li><p>Use the OS user account that you want as the instance administrator.</p><p>Connect with the server using the OS user account that you want as the instance administrator.</p></li><li><p>Configure the environment variables</p><p>Configure the environment variables in the server with the newly created instance.</p><p>Set the following environment variables:</p><ul><li><p>PATH environment variables</p><p>Add installDir\bin and installDir\lib.</p></li></ul><dl><dt class="em">Example</dt><dd><p>The following is a setting example for environment variables in which "C:\Program Files\Fujitsu\fsepv&lt;<span class="i">x</span>&gt;server64" is used as the installation folder:</p><p>Note that "&lt;<span class="i">x</span>&gt;" indicates the product version.</p><pre class="border">&gt; SET PATH=C:\Program Files\Fujitsu\fsepv&lt;<span class="i">x</span>&gt;server64\bin;C:\Program Files\Fujitsu\fsepv&lt;<span class="i">x</span>&gt;server64\lib;%PATH%</pre></dd></dl></li><li><p>Create a database cluster</p><p>Create the database cluster with the initdb command, specifying the storage destination directory.</p><p>Specify the transaction log storage destination and the locale setting option as required.</p><dl><dt class="em">Example</dt><dd><pre class="border">&gt; initdb -D D:\database\inst1 --waldir=E:\transaction\inst1 --lc-collate="C" --lc-ctype="C" --encoding=UTF8</pre></dd></dl><div class="point"><p class="title">Point</p><div class="pointbody"><p>In some features, instance names are requested, and those names are required to uniquely identify the instance within the system. These features allow names that conform to WebAdmin naming conventions, so refer to the following points when determining the names:</p><ul><li><p>Maximum of 16 characters</p></li><li><p>The first character must be ASCII alphabetic character</p></li><li><p>The other characters must be ASCII alphanumeric characters</p></li></ul></div></div><div class="note"><p class="title">Note</p><div class="notebody"><ul><li><p>To balance I/O load, consider deploying the transaction log storage destination to a disk device other than the database cluster storage destination and the backup data storage destination. </p></li><li><p>Messages may not display correctly if a value other than "C" is specified as the display language for messages.</p></li><li><p>Specify "C" for collation and character category. Performance deteriorates if you specify a value other than "C" , although the behavior will follow the rules for particular languages, countries and regions. Furthermore, this may need to be revised when running applications on systems with different locales. <br>For example, specify as follows:</p><pre>initdb --locale="C" --lc-messages="C"initdb --lc-collate="C" --lc-ctype="C"</pre></li><li><p>Specify an encoding system other than SQL_ASCII for the database. If SQL_ASCII is used, there is no guarantee that the encryption system for data in the database will be consistent, depending on the application used to insert the data.</p></li></ul></div></div><div class="ref"><p class="title">See</p><div class="refbody"><p>Refer to "Locale Support" in "Localization" in "Server Administration" in the PostgreSQL Documentation for information on locales. </p></div></div></li><li><p>Set port number.</p><p>Specify a port number in the port parameter of postgresql.conf. Ensure that the specified port number is not already used for other software. If a port number is not specified, "27500" is selected.</p><p>Register the specified port numbers in the C:\Windows\System32\drivers\etc\services file if WebAdmin is used to create other instances. WebAdmin uses the services file to check if port numbers specified as available candidates have been duplicated.</p><p>Register any name as the service name.</p><div class="note"><p class="title">Note</p><div class="notebody"><p>Make a note of the port number for use in the Windows firewall settings.</p></div></div></li><li><p>Set the corefile output destination.</p><p>Specify the output destination of the corefile, which can later be used to collect information for investigation, by setting the core_directory and core_contents parameters of postgresql.conf.</p><div class="ref"><p class="title">See</p><div class="refbody"><p>Refer to "Parameters" in the Operation Guide for information on the settings for these parameters.</p></div></div></li><li><p>Set the backup storage destination.</p><p>Specify the backup data storage destination and other backup settings when backup is to be performed as a provision against database errors.</p><div class="ref"><p class="title">See</p><div class="refbody"><p>Refer to "Backup Methods" in the Operation Guide for information on specifying backup settings.</p></div></div></li><li><p>Register an instance in the Windows service</p><p>Use the register mode of the pg_ctl command to register an instance in the Windows service.</p><p>Specify the service name, user name, password and path to the instance in the pg_ctl command, and register the instance in the Windows service.</p><dl><dt class="em">Example</dt><dd><p>The following is a setting example, in which the service name to register is "inst1", the user name is "fepuser", and the storage destination directory of the database cluster is "D:\database\inst1":</p><pre class="border">&gt; pg_ctl register -N "inst1" -U fepuser -P ******** -D D:\database\inst1</pre></dd></dl><div class="note"><p class="title">Note</p><div class="notebody"><ul><li><p>This command must be executed by an instance administrator user with administrator privileges. Execute the command from the [Administrator: Command Prompt] window. Right-click [Command Prompt], and then select [Run as administrator] from the menu to display the [Administrator: Command Prompt] window.</p></li><li><p>For the following reasons, a user name and password must always be specified:</p><p>Because the Windows service is started up by the Network Service account, all user resources are created as resources of that account. This can result in error events such as failing to access database resources and not being able to perform backups/recovery.<br>Note that if not specifying a user name and password for security reasons, you should specify the account from the Windows services list immediately after registering the instance in Windows services.</p></li><li><p>When entering the password that is specified in the pg_ctl command, for security reasons, you should be careful not to allow other users to access it.</p></li></ul></div></div><p>Commands such as sc query can be used to check the registration status.</p></li><li><p>Start an instance</p><p>Use the following procedure to start the service:</p><ol class="alpha"><li><p>Display the [Services] window.</p><p>In Windows, select [Administrative Tools], and then click [Services].</p></li><li><p>Start the service</p><p>From the services list, select the instance name that you wish to start, and click [Start Service].</p><br></li></ol></li></ol><p>If using commands to start the service, specify the service name using either the net start command or sc start command from the command prompt.</p></div></div><div class="header_footer"><div class="back_next"><a href="b1438-00-04-03-01.html"><img src="image/back2.gif" width="65" height="27" border="0" alt="Previous" title="Previous"></a><a href="b1438-00-04-04-00.html"><img src="image/next2.gif" width="64" height="27" border="0" alt="Next" title="Next"></a></div><div class="copyright">Copyright 2015-2021 FUJITSU LIMITED</div></div></body></html>