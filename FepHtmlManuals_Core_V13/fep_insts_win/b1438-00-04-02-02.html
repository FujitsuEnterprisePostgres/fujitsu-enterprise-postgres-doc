<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"><html lang="en"><head><META http-equiv="Content-Type" content="text/html; charset=UTF-8"><META CONTENT="4.3" NAME="GeneratorVersion"><title>4.2.2 Preparing Directories for Resource Deployment</title><link rel="stylesheet" href="manualmain.css" type="TEXT/CSS"><script language="JavaScript" src="topbutton.js"></script></head><body onload="init()"><div class="topButton" id="topButton0"><a class="topButton" href="#top"><img src="image/top.gif" width="62" height="20" border="0" alt="Top" title="Top"></a></div><div class="top_header"><div class="top_header_title"><a title="Title Page" class="top_link" target="_top" HREF="index.html">Enterprise Postgres 13&nbsp;Installation and Setup Guide for Server</a></div><div class="top_header_graphic"><span class="top_logo"><img src="image/logo-white-fj.gif" width="148" height="32" alt=""></span><span class="top_keygraphic"><img src="image/cover-header-graphic.gif" width="148" height="32" alt="FUJITSU Software"></span></div></div><div class="header_footer"><div class="breadcrumbslist"><a href="b1438-00-04-00-00.html">Chapter&nbsp;4 Setup</a> &gt; <a href="b1438-00-04-02-00.html">4.2 Preparations for Setup</a> &gt; 4.2.2 Preparing Directories for Resource Deployment</div><div class="back_next"><a href="b1438-00-04-02-01.html"><img src="image/back2.gif" width="65" height="27" border="0" alt="Previous" title="Previous"></a><a href="b1438-00-04-02-03.html"><img src="image/next2.gif" width="64" height="27" border="0" alt="Next" title="Next"></a></div></div><h3 id="mID_040202_directory">4.2.2 Preparing Directories for Resource Deployment</h3><div class="body"><div class="textblock"><p>Prepare the directories required when creating instances.</p><p></p></div><p class="subhead_1" id="IDinsts04-02N3"><span class="em">Considerations when deploying resources</span></p><div class="textblock"><p>The disk configuration on the resource deployment destination is important, because it affects not only recovery following disk corruption, but normal operation as well. The points for determining the disk configuration are as follows:</p><ol><li><p>If the backup data storage destination and the data storage destination are both lost, it will not be possible to recover the data, so deploy them to separate disks.</p></li><li><p>To shorten the recovery time following a single disk fault, deploy the system disk and data storage destination to separate disks.</p></li><li><p>The backup data storage destination requires at least double the capacity of the data storage destination, so deploy it to the disk with the most space available.</p></li><li><p>When large amounts of data are updated, the write-to load for the data storage destination, transaction log storage destination, and backup data storage destination (mirrored transaction log) will also be great. For this reason, deploy them to separate disks, out of consideration for performance.</p></li></ol><div class="note"><p class="title">Note</p><div class="notebody"><ul><li><p>When using the volume manager provided by the operating system, be aware of which physical disk the file system has been created on, for example, by deploying the data storage destination and the backup data storage destination to separate disks.</p></li><li><p>If using WebAdmin, specify an NTFS volume for the data storage destination and backup data storage destination. A network drive cannot be specified.</p></li></ul></div></div><p><img src="insts04-02img/e-040202-haichi.gif" alt="" width="887" height="663"></p><table><col><col><tr><th valign="top"><p><span class="em">Resource</span></p></th><th valign="top"><p><span class="em">Role</span></p></th></tr><tr><td align="left" valign="top"><p>Database cluster</p></td><td align="left" valign="top"><p>The area where the database is stored. It is a collection of databases managed by an instance.</p></td></tr><tr><td align="left" valign="top"><p>Tablespace</p></td><td align="left" valign="top"><p>Stores table files and index files in a separate area from the database cluster.</p><p>Specify a space other than that under the database cluster.</p></td></tr><tr><td align="left" valign="top"><p>Transaction log</p></td><td align="left" valign="top"><p>Stores log information in preparation for a crash recovery or rollback.</p><p>This is the same as the WAL (Write Ahead Log).</p></td></tr><tr><td align="left" valign="top"><p>Archive log</p></td><td align="left" valign="top"><p>Stores log information for recovery</p></td></tr><tr><td align="left" valign="top"><p>Mirrored transaction log (mirrored WAL)</p></td><td align="left" valign="top"><p>Enables a database cluster to be restored to the state immediately before an error even if both the database cluster and transaction log fail when performing backup/recovery operations using the pgx_dmpall command or WebAdmin.</p></td></tr><tr><td align="left" valign="top"><p>Corefile</p></td><td align="left" valign="top"><p>FUJITSU Enterprise Postgres process corefile output when an error occurs with a FUJITSU Enterprise Postgres process.</p></td></tr></table><dl><dt class="em">Examples of disk deployment</dt><dd><p>The following are examples of disk deployment:</p><table><col><col><col><tr><th valign="top"><p><span class="em">Number of disks</span></p></th><th valign="top"><p><span class="em">Disk</span></p></th><th valign="top"><p><span class="em">Deployment</span></p></th></tr><tr><td rowspan="4" align="left" valign="top"><p>3</p></td><td rowspan="2" align="left" valign="top"><p>System disk</p></td><td align="left" valign="top"><p>FUJITSU Enterprise Postgres program</p></td></tr><tr><td align="left" valign="top"><p>Corefile</p></td></tr><tr><td align="left" valign="top"><p>Connected physical disk</p></td><td align="left" valign="top"><p>Data storage destination, transaction log storage destination</p></td></tr><tr><td align="left" valign="top"><p>Connected physical disk</p></td><td align="left" valign="top"><p>Backup data storage destination</p></td></tr><tr><td rowspan="4" align="left" valign="top"><p>2</p></td><td rowspan="3" align="left" valign="top"><p>System disk</p></td><td align="left" valign="top"><p>FUJITSU Enterprise Postgres program</p></td></tr><tr><td align="left" valign="top"><p>Corefile</p></td></tr><tr><td align="left" valign="top"><p>Data storage destination, transaction log storage destination</p></td></tr><tr><td align="left" valign="top"><p>Connected physical disk</p></td><td align="left" valign="top"><p>Backup data storage destination</p></td></tr></table></dd></dl><dl><dt class="em">Proposal for disk deployment using WebAdmin</dt><dd></dd></dl><p>To generate an instance using WebAdmin, we recommend an optimum deployment that takes into account the status of all disks at the time of instance generation, and items 1 to 3 in the "Considerations when deploying resources" subheading above, based on the limitations below (note that a different deployment can also be specified).</p><ul><li><p>The instance administrator has read and write privileges for the volumes.</p></li></ul></div><p class="subhead_1" id="IDinsts04-02N4"><span class="em">Preparing directories</span></p><div class="textblock"><p>The directories to be prepared depend on the way that you create the instances.</p><p>The following shows the directories that need to be prepared:</p><table><col><col><col><tr><th valign="top"><p><span class="em">Directory to be prepared</span></p></th><th valign="top"><p><span class="em">Using WebAdmin</span></p></th><th valign="top"><p><span class="em">Using the initdb </span><span class="em">c</span><span class="em">ommand</span></p></th></tr><tr><td align="left" valign="top"><p>Data storage destination</p></td><td align="center" valign="top"><p>Y <span class="inline-note">*1</span></p></td><td align="center" valign="top"><p>Y</p></td></tr><tr><td align="left" valign="top"><p>Backup data storage destination</p></td><td align="center" valign="top"><p>O <span class="inline-note">*1</span> <span class="inline-note">*4</span></p></td><td align="center" valign="top"><p>O</p></td></tr><tr><td align="left" valign="top"><p>Transaction log storage destination </p></td><td align="center" valign="top"><p>O <span class="inline-note">*1</span> <span class="inline-note">*2</span></p></td><td align="center" valign="top"><p>O</p></td></tr><tr><td align="left" valign="top"><p>Corefile output destination</p></td><td align="center" valign="top"><p>N <span class="inline-note">*3</span></p></td><td align="center" valign="top"><p>O</p></td></tr></table><p>Y: Required<br>O: Optional<br>N: Not required</p><p>*1: WebAdmin automatically creates a directory</p><p>*2: The default is to create in a directory in the data storage destination. When it is necessary to distribute the I/O load for the database data and the transaction log, consider putting the transaction log storage destination on a different disk from the data storage destination</p><p>*3: The corefile path is as follows:</p><p><span class="i">userProfileFolder</span>\<span class="i">localSettingsFolder</span>\Fujitsu\fsep_<span class="i">version</span>\<span class="i">instanceNamePortNumber</span>\core</p><p><span class="i">version</span>: product version_WA_architecture</p><p>Note: The product version is normally the version of WebAdmin used to create the instance. For example, WebAdmin 13 allows a user to create a FUJITSU Enterprise Postgres 9.6 instance on a database server having WebAdmin 9.6. In this case, because WebAdmin 9.6 is used to create the instance, the product version will be "96".</p><p><span class="i">PortNumber</span>: port number specified when creating the instance</p><p>Example </p><p>C:\Users\naomi\AppData\Local\Fujitsu\fsep_130_WA_64\myinst27599\core</p><p>To change the output destination, specify in the core_directory parameter and core_contents parameter in postgresql.conf. Refer to "Parameters" in the Operation Guide for information on the settings for these parameters.</p><p>*4: This directory is required when instance backup is enabled.</p><div class="note"><p class="title">Note</p><div class="notebody"><ul><li><p>The directories must meet the following conditions:</p><ul><li><p>The directory owner must be the OS user account that you want to be the instance administrator</p></li><li><p>The directory must have write permission</p></li><li><p>The directory must be empty</p></li></ul></li></ul><ul><li><p>If using WebAdmin, network drives cannot be used.</p></li><li><p>If using WebAdmin, the following halfwidth characters can be used for directory names:</p><ul><li><p>\(backslash)</p></li><li><p>- (hyphen)</p></li><li><p>_ (underscore)</p></li><li><p>: (colon)</p></li><li><p>Space</p></li><li><p>A-Z, a-z, 0-9 (alphanumeric)</p></li></ul></li><li><p>If anti-virus software is used, set scan exception settings for folders so that none of the server resources that comprise FUJITSU Enterprise Postgres are scanned for viruses. Alternatively, if the server resources that comprise FUJITSU Enterprise Postgres are to be scanned for viruses, stop the instance and perform the scan when tasks that use FUJITSU Enterprise Postgres are not operating.</p></li></ul></div></div><dl><dd></dd></dl></div><p class="subhead_1" id="IDinsts04-02N5"><span class="em"></span><span class="em">Confirm and configure directory access permissions</span></p><div class="textblock"><p>If the instance administrator user has "Administrator" permissions (user ID belonging to the Administrators group), it is necessary to configure the settings so that each directory inherits the file and directory access permissions for the instance administrator user.</p><p>Therefore, ensure that the setting to inherit permissions has been configured.</p><p>The following is an explanation on how to confirm and configure the settings.</p><dl><dt class="em">How to confirm access permissions</dt><dd><p>Perform the following operations in Windows Explorer on the directories to be prepared in advance:</p><ol><li><p>Right-click on the applicable directory, and then click [Properties] from the menu that is displayed.</p></li><li><p>In the [<span class="i">applicableDir</span> Properties] window, select [Security] &gt;&gt; [Advanced].</p></li><li><p>In the [Advanced Security Settings for <span class="i">applicableDir</span>] window, and in the [Permission entries] list under the [Permissions] tab, confirm that [Applies to] for the instance administrator user is "This folder, subfolders and files".</p></li><li><p>Click [OK].</p></li></ol></dd></dl><dl><dt class="em">How to configure the access permissions</dt><dd><p>Perform the following operations in Windows Explorer if there are any directories that have not been configured for the access permissions to be inherited.</p><ol><li><p>Right-click on the applicable directory, and then click [Properties] from the menu that is displayed.</p></li><li><p>In the [<span class="i">applicableDir</span> Properties] window, select [Security] &gt;&gt; [Advanced].</p></li><li><p>In the [Advanced Security Settings for <span class="i">applicableDir</span>] window, click [Add].</p></li><li><p>In the [Permission Entry for <span class="i">applicableDir</span>] window, click [Select a principal].</p></li><li><p>In the [Select User or Group] window, enter the instance administrator user name as the object name to select, and then click [OK].</p></li><li><p>In the [Permission Entry for <span class="i">applicableDir</span>] window, set [This folder, subfolders and files] for [Apply to:] ([Applies to:] for Windows Server(R) 2016 and Windows Server(R) 2019), and under [Basic permissions], allow read and write permissions, and then click [OK].</p></li><li><p>In the [Advanced Security Settings for <span class="i">applicableDir</span>] window, confirm that the instance administrator user has been added, with [This folder, subfolders and files] set for [Apply to] ([Applies to] for Windows Server(R) 2016 and Windows Server(R) 2019) in the [Permission entries] list.</p></li><li><p>Click [OK].</p></li></ol><div class="tips"><p class="title">Information</p><div class="tipsbody"><p>The access permissions can also be configured using the icacls command provided by the operating system.</p><p>The following is an execution example in which the application destination is set to "(OI)(CI)" and the access permissions are set to "(F)(Full access permissions)" when the data storage destination is "D:\database\inst1" and the instance administrator user is "fsepuser":</p><pre class="border">&gt;icacls D:\database\inst1 /grant fsepuser:(OI)(CI)(F)processed file: D:\database\inst1Successfully processed 1 files; Failed processing 0 files</pre></div></div></dd></dl></div></div><div class="header_footer"><div class="back_next"><a href="b1438-00-04-02-01.html"><img src="image/back2.gif" width="65" height="27" border="0" alt="Previous" title="Previous"></a><a href="b1438-00-04-02-03.html"><img src="image/next2.gif" width="64" height="27" border="0" alt="Next" title="Next"></a></div><div class="copyright">Copyright 2015-2021 FUJITSU LIMITED</div></div></body></html>