<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"><html lang="en"><head><META http-equiv="Content-Type" content="text/html; charset=UTF-8"><META CONTENT="4.3" NAME="GeneratorVersion"><title>F.1 FUJITSU Enterprise Postgres Memory Requirements</title><link rel="stylesheet" href="manualmain.css" type="TEXT/CSS"><script language="JavaScript" src="topbutton.js"></script></head><body onload="init()"><div class="topButton" id="topButton0"><a class="topButton" href="#top"><img src="image/top.gif" width="62" height="20" border="0" alt="Top" title="Top"></a></div><div class="top_header"><div class="top_header_title"><a title="Title Page" class="top_link" target="_top" HREF="index.html">Enterprise Postgres 13&nbsp;Installation and Setup Guide for Server</a></div><div class="top_header_graphic"><span class="top_logo"><img src="image/logo-white-fj.gif" width="148" height="32" alt=""></span><span class="top_keygraphic"><img src="image/cover-header-graphic.gif" width="148" height="32" alt="FUJITSU Software"></span></div></div><div class="header_footer"><div class="breadcrumbslist"><a href="b1438-f-00-00.html">Appendix&nbsp;F Estimating Memory Requirements</a> &gt; F.1 FUJITSU Enterprise Postgres Memory Requirements</div><div class="back_next"><a href="b1438-f-00-00.html"><img src="image/back2.gif" width="65" height="27" border="0" alt="Previous" title="Previous"></a><a href="b1438-f-02-00.html"><img src="image/next2.gif" width="64" height="27" border="0" alt="Next" title="Next"></a></div></div><h2 id="IDinsts0hN1">F.1 FUJITSU Enterprise Postgres Memory Requirements</h2><div class="body"><div class="textblock"><p>This section describes the formulas for estimating FUJITSU Enterprise Postgres memory requirements.</p><p>Use the following formula to obtain a rough estimate of memory required for FUJITSU Enterprise Postgres:</p><pre class="border"><span class="i">fujitsuEnterprisePostgresRequiredMemory</span> = <span class="i">sharedMemoryAmount</span> + <span class="i">localMemoryAmount</span></pre><p></p></div><p class="subhead_1" id="IDinsts0hN2"><span class="em">Shared memory amount</span></p><div class="textblock"><p>Refer to "Shared Memory and Semaphores" under "Server Administration" in the PostgreSQL Documentation for information on shared memory. If you enable the Global Meta Cache feature, you must also add the value of pgx_global_metacache. Refer to "Parameters" in the Operation Guide for the setting values.</p><p>However, note that if instances have been created using WebAdmin, the parameters below will be configured automatically when the instances are created. Take this into account when calculating the shared memory size.</p><table><col><col><tr><th valign="top"><p><span class="em">Parameter name</span></p></th><th valign="top"><p><span class="em">Set value</span></p></th></tr><tr><td align="left" valign="top"><p>shared_buffers</p></td><td align="left" valign="top"><p>30 percent of the internal memory of the machine.</p></td></tr><tr><td align="left" valign="top"><p>max_connections</p></td><td align="left" valign="top"><p>100</p></td></tr><tr><td align="left" valign="top"><p>max_prepared_transactions</p></td><td align="left" valign="top"><p>100</p></td></tr></table></div><p class="subhead_1" id="IDinsts0hN3"><span class="em">Local memory amount</span></p><div class="textblock"><pre class="border"><span class="i">localMemoryAmount</span> = <span class="i">processStackArea</span>                  + <span class="i">memoryUsedInDbSessionsThatUseTempTables</span>                  + <span class="i">memoryUsedInDbSessionsThatPerformSortAndHashTableOperations</span>                   + <span class="i">memoryUsedInMaintenanceOperations</span>                  + <span class="i">baseMemoryUsedInEachProcess</span>                  + <span class="i">memoryUsedPreparingForDataAccess</span></pre><br><dl><dt class="em">Process stack area</dt><dd><pre class="border"><span class="i">processStackArea</span>  = max_stack_depth x (max_connections + autovacuum_max_workers + 9)</pre><p>This formula evaluates to the maximum value.<br>Actually it is used according to the growth of the stack.<br>In the formula above, 9 is the number of processes that perform roles specific to servers.</p></dd></dl><dl><dt class="em">Memory used in database sessions that use temporary tables</dt><dd><pre class="border"><span class="i">memoryUsedInDbSessionsThatUseTempTables</span>  = temp_buffers x max_connections</pre><p>This formula evaluates to the maximum value.<br>Memory is gradually used as temporary buffers are used, and is released when the session ends.</p></dd></dl><dl><dt class="em">Memory used in database sessions that perform sort and hash table operations</dt><dd><pre class="border"><span class="i">memoryUsedInDbSessionsThatPerformSortAndHashTableOperations</span>  = work_mem x max_connections</pre><p>This formula evaluates to the maximum value.<br>Memory is gradually used as operations such as sort are performed, and is released when the query ends.</p></dd></dl><dl><dt class="em">Memory used in maintenance operations</dt><dd><pre class="border"><span class="i">memoryUsedInMaintenanceOperations</span>  = maintenance_work_mem x (<span class="i">numOfSessionsPerformingMaintenance</span> + autovacuum_max_workers)</pre><p>Note that 'maintenance operations' are operations such as VACUUM, CREATE INDEX, and ALTER TABLE ADD FOREIGN KEY.</p></dd></dl><dl><dt class="em">Base memory used in each process</dt><dd><pre class="border"><span class="i">baseMemoryUsedInEachProcess</span>  = baseMemoryUsedInOneProcess x (max_connections + autovacuum_max_workers + 9)</pre><p>Use the result of the following formula for memory consumed per process. This formula evaluates to the memory used when server processes are running.<br>In the formula above, 9 is the number of processes that perform roles specific to servers.</p><p>The amount of memory consumed per process is determined by the number of tables, indexes, and all columns of all tables that the process accesses. If your system has about 100 tables, you can estimate it to be 3 MB, but otherwise use the following estimate:</p><pre class="border"><span class="i">baseMemoryUsedInOneProcess</span>  = (1.9KB x <span class="i">All user tables</span> + 2.9KB x <span class="i">All user indexes</span> + 1.0KB x <span class="i">All user columns</span>) x 1.5<span class="inline-note">*1</span> If you enable the Global Meta Cache feature, use the following formula:<span class="i">baseMemoryUsedInOneProcess</span> = (<span class="i">All user tables</span> + <span class="i">All user indexes</span> + <span class="i">All user columns</span>) x 1.0KB x 1.5 <span class="inline-note">*1</span> 	+ (<span class="i">All user tables </span>x 1.4KB + <span class="i">All</span><span class="i"> user indexes </span>x 2.4KB) </pre><p>*1) Safety Factor (1.5)<br>There are variable length information. This value takes that into account.</p></dd></dl><dl><dt class="em">Memory used preparing for data access</dt><dd><pre class="border"><span class="i">memoryUsedPreparingForDataAccess</span> = <span class="i">variationAmount</span> x (max_connections + autovacuum_max_workers + 4)  where <span class="i">variationAmount</span> = shared_buffers / 8KB x 4 bytes      (note that 8KB is the page length, and 4 bytes is the size of page management data)</pre><p>This formula evaluates to the memory required to access the database cache in the shared memory.<br>In the formula above, among the processes that perform roles specific to servers, 4 is the number of processes that access the database.</p></dd></dl></div></div><div class="header_footer"><div class="back_next"><a href="b1438-f-00-00.html"><img src="image/back2.gif" width="65" height="27" border="0" alt="Previous" title="Previous"></a><a href="b1438-f-02-00.html"><img src="image/next2.gif" width="64" height="27" border="0" alt="Next" title="Next"></a></div><div class="copyright">Copyright 2015-2021 FUJITSU LIMITED</div></div></body></html>