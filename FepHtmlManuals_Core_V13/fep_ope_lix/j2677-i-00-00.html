<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"><html lang="en"><head><META http-equiv="Content-Type" content="text/html; charset=UTF-8"><META CONTENT="4.3" NAME="GeneratorVersion"><title>Appendix&nbsp;I Copy Command Samples that Use the Advanced Copy Feature of the ETERNUS Disk Array</title><link rel="stylesheet" href="manualmain.css" type="TEXT/CSS"><script language="JavaScript" src="topbutton.js"></script></head><body onload="init()"><div class="topButton" id="topButton0"><a class="topButton" href="#top"><img src="image/top.gif" width="62" height="20" border="0" alt="Top" title="Top"></a></div><div class="top_header"><div class="top_header_title"><a title="Title Page" class="top_link" target="_top" HREF="index.html">Enterprise Postgres 13&nbsp;Operation Guide</a></div><div class="top_header_graphic"><span class="top_logo"><img src="image/logo-white-fj.gif" width="148" height="32" alt=""></span><span class="top_keygraphic"><img src="image/cover-header-graphic.gif" width="148" height="32" alt="FUJITSU Software"></span></div></div><div class="header_footer"><div class="breadcrumbslist">Appendix&nbsp;I Copy Command Samples that Use the Advanced Copy Feature of the ETERNUS Disk Array</div><div class="back_next"><a href="j2677-h-00-00.html"><img src="image/back2.gif" width="65" height="27" border="0" alt="Previous" title="Previous"></a><a href="j2677-j-00-00.html"><img src="image/next2.gif" width="64" height="27" border="0" alt="Next" title="Next"></a></div></div><h1 id="br0h_copy00" class="app">Appendix&nbsp;I Copy Command Samples that Use the Advanced Copy Feature of the ETERNUS Disk Array<a name="N136G"></a></h1><div class="body"><div class="textblock"><p>Backup/recovery scripts that use OPC, an advanced copy feature of the FUJITSU Storage ETERNUS disk array (hereafter referred to as ETERNUS disk array), are supplied as copy command samples for use by the pgx_dmpall and pgx_rcvall commands.</p><p>Users can copy the samples to any file and make changes appropriate to their environment or operations.</p><p>The samples are stored in the directories below:</p><ul><li><p>Basic version</p><pre class="border">/<span class="i">installDir</span>/share/copy_command.esf_acm1.sh.sample</pre></li><li><p>Advanced version</p><pre class="border">/<span class="i">installDir</span>/share/copy_command.esf_acm2.sh.sample</pre></li></ul><div class="ref"><p class="title">See</p><div class="refbody"><p>The samples use the replication management command of the FUJITSU Storage ETERNUS SF AdvancedCopy Manager (hereafter referred to as ACM) for operating the advanced copy features of the ETERNUS disk array. Refer to the relevant manual for details.</p></div></div><p></p></div><p class="subhead_1" id="ID0h00-copy-lN1"><span class="em">Prerequisite </span><span class="em">for using the samples</span></p><div class="textblock"><p>To use the samples, it is necessary to configure the settings of the advanced copy features of the ETERNUS disk array in advance. The samples assume that the replication source/volume has been configured, its contents have been physically copied to the replication volume, and that the tracking process has been started.</p></div><p class="subhead_1" id="ID0h00-copy-lN2"><span class="em">Sample content (advanced version)</span></p><div class="textblock"><p>The sample uses two replication volumes as the replication source on which the database cluster and tablespace are located, alternating between them for each backup. It then registers to the backup information file the replication volume (group) used for the latest backup.</p><p>In addition, the backup information file is also used to determine the replication volume to restore during recovery.</p><p>The processing for each operation mode is described below:</p><dl><dt class="em">prepare mode</dt><dd><ol><li><p>The backup information file is read, and the replication volume to be used for the current backup is determined.</p></li><li><p>The completion status of physical copies to all replication volumes is checked using the swsrpstat command of ACM.</p></li><li><p>The replication volume determined in step 1 is written to a temporary file for later use by the backup mode.</p></li></ol></dd></dl><dl><dt class="em">backup mode</dt><dd><ol><li><p>The temporary file is read, and the replication volume information is retrieved.</p></li><li><p>The file system buffer is written using the sync command of the operating system.</p></li><li><p>The file system targeted for backup is frozen using the fsfreeze command of the operating system.</p></li><li><p>Snapshot retrieval (implementation of a logical copy) is performed using the swsrpmake command of ACM.</p></li><li><p>The file system frozen in step 3 is unfrozen using the fsfreeze command of the operating system.</p><p>Steps 3 to 5 are performed for all file systems targeted for backup.</p></li></ol></dd></dl><dl><dt class="em">finalize mode</dt><dd><ol><li><p>The completion status of physical copies to all replication volumes is checked using the swsrpstat command of ACM.</p></li><li><p>Information about the replication volume used for the current backup is written to the backup information file.</p></li></ol></dd></dl><dl><dt class="em">restore mode</dt><dd><ol><li><p>The backup information file is read, and the replication volume to be used for recovery is determined.</p></li><li><p>The file system targeted for recovery is unmounted using the umount command of the operating system.</p></li><li><p>Physical copy from the replication volume is performed using the swsrpmake command of ACM.</p></li><li><p>The file system targeted for recovery is mounted using the mount command of the operating system.</p></li><li><p>The completion status of physical copy from the replication volume is checked using the swsrpstat command of ACM.</p><p>Steps 2 to 5 are performed for all file systems targeted for recovery.</p></li><li><p>Files and directories not needed for archive recovery are deleted.</p></li></ol></dd></dl><div class="note"><p class="title">Note</p><div class="notebody"><ul><li><p>The samples cannot be used on SLES 12.</p></li><li><p>The samples use the sudo command of the operating system so that operation of the commands and file systems of ACM is performed by the superuser of the operating system. Therefore, determine if these implementations satisfy the security standards on the database server, and if necessary, perform implementations using other means.</p></li><li><p>The samples temporarily freeze the file system of the data storage destination (replication source volume) to protect the file system from copy processing by advanced copy features of the ETERNUS disk array. Therefore, consider the following:</p><ul><li><p>Consider freeze time during the timeout period of an SQL statement.</p><p>When using a feature that links with the database, such as a cluster feature that accesses the data storage destination, consider freeze time in relation to the timeout periods below.</p><ul><li><p>When performing database multiplexing</p><p>Misdetection may occur during abnormality monitoring, so it is necessary to consider the monitoring interval, timeout period and number of retries for abnormality monitoring, and consider temporarily stopping only the Mirroring Controller process during backup.</p></li><li><p>When performing failover operations using PRIMECLUSTER</p><p>If a failure occurs while the file system is frozen, switching is triggered when PRIMECLUSTER detects an issue, but will be performed only after the system is unfrozen. In addition, if it takes time for the system to unfreeze, the active node may trigger operating system panic, resulting in a switch.</p></li></ul></li></ul></li></ul></div></div></div></div><div class="header_footer"><div class="back_next"><a href="j2677-h-00-00.html"><img src="image/back2.gif" width="65" height="27" border="0" alt="Previous" title="Previous"></a><a href="j2677-j-00-00.html"><img src="image/next2.gif" width="64" height="27" border="0" alt="Next" title="Next"></a></div><div class="copyright">Copyright 2015-2021 FUJITSU LIMITED</div></div></body></html>