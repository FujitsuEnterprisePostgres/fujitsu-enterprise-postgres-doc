<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"><html lang="en"><head><META http-equiv="Content-Type" content="text/html; charset=UTF-8"><META CONTENT="4.3" NAME="GeneratorVersion"><title>14.1 Configuration of the Copy Command</title><link rel="stylesheet" href="manualmain.css" type="TEXT/CSS"><script language="JavaScript" src="topbutton.js"></script></head><body onload="init()"><div class="topButton" id="topButton0"><a class="topButton" href="#top"><img src="image/top.gif" width="62" height="20" border="0" alt="Top" title="Top"></a></div><div class="top_header"><div class="top_header_title"><a title="Title Page" class="top_link" target="_top" HREF="index.html">Enterprise Postgres 13&nbsp;Operation Guide</a></div><div class="top_header_graphic"><span class="top_logo"><img src="image/logo-white-fj.gif" width="148" height="32" alt=""></span><span class="top_keygraphic"><img src="image/cover-header-graphic.gif" width="148" height="32" alt="FUJITSU Software"></span></div></div><div class="header_footer"><div class="breadcrumbslist"><a href="j2677-00-14-00-00.html">Chapter&nbsp;14 Backup/Recovery Using the Copy Command</a> &gt; 14.1 Configuration of the Copy Command</div><div class="back_next"><a href="j2677-00-14-00-00.html"><img src="image/back2.gif" width="65" height="27" border="0" alt="Previous" title="Previous"></a><a href="j2677-00-14-02-00.html"><img src="image/next2.gif" width="64" height="27" border="0" alt="Next" title="Next"></a></div></div><h2 id="br0d_copy01">14.1 Configuration of the Copy Command<a name="N76G"></a></h2><div class="body"><div class="textblock"><p>This section describes the configuration of the copy command for backup and recovery.</p><p></p></div><p class="subhead_1" id="ID0d00-copyN1"><span class="em">Cyclic </span><span class="em">usage </span><span class="em">of the </span><span class="em">backup area</span><a name="N77G"></a></p><div class="textblock"><p>Prepare two backup areas for the copy command in case an issue affects the data storage destination during backup. The copy command performs backup while cyclically using these backup areas.</p><p><img src="0d00-copyimg/e-0d00-copy01-circulation.gif" alt="" width="929" height="327"></p><div class="note"><p class="title">Note</p><div class="notebody"><p>The backup data storage destination cannot be used as these backup areas used by the copy command.</p></div></div></div><p class="subhead_1" id="ID0d00-copyN2"><span class="em">Backup </span><span class="em">using </span><span class="em">the</span><span class="em"> </span><span class="em">backup information file</span><a name="N78G"></a></p><div class="textblock"><p>The copy command must determine the backup destination on each backup, as it is necessary to cycle through the backup areas. Backup can be automated by using the backup information file, which contains information about the backup destination.</p><p><img src="0d00-copyimg/e-0d00-copy01-backupflow.gif" alt="" width="738" height="617"></p><div class="tips"><p class="title">Information</p><div class="tipsbody"><p>The backup information file is prepared in the backup data storage destination by the pgx_dmpall command, and contains information that can be read or updated by the copy command. This file is managed by associating it with the latest backup successfully completed by the pgx_dmpall command, so the latest backup information relating to the copy command registered by the user can be retrieved. Additionally, the content of the backup information file can be displayed using the pgx_rcvall command.</p></div></div></div><p class="subhead_1" id="ID0d00-copyN3"><span class="em">Configuration of the copy command for backup</span><a name="N79G"></a></p><div class="textblock"><p>The pgx_dmpall command calls the copy command for backup after execution for the three modes below. It is therefore necessary for the copy command for backup to implement the required processing for each of the modes.</p><ul><li><p>prepare mode</p><p>Determines which of the two backup areas will be used for the current backup.</p><p>The backup area to be used for the current backup is determined by reading the information relating to the latest backup destination where the backup information file was written to during the previous backup.</p></li><li><p>backup mode</p><p>Performs backup on the backup area determined by prepare mode, using any copy method.</p></li><li><p>finalize mode</p><p>Writes information relating to the destination of the current backup to the backup information file.</p><p>This enables the prepare mode to check the destination of the previous backup during the next backup.</p></li></ul><div class="note"><p class="title">Note</p><div class="notebody"><p>The user can use any method to hand over backup information between modes within the copy command, such as creating temporary files.</p></div></div></div><p class="subhead_1" id="ID0d00-copyN4"><span class="em">Configuration of the copy command for recovery</span><a name="N80G"></a></p><div class="textblock"><p>The pgx_rcvall command calls the copy command for recovery for the mode below. It is therefore necessary for the copy command for recovery to implement the required processing for the mode.</p><ul><li><p>restore mode</p><p>Any copy method can be used to implement restore from the backup destination retrieved using the copy command for backup.</p></li></ul><div class="point"><p class="title">Point</p><div class="pointbody"><p>By referring to the mode assigned to the copy command as an argument, backup and recovery can be implemented using a single copy command.</p></div></div><div class="ex"><p class="title">Example</p><div class="exbody"><p><span class="em">U</span><span class="em">sing </span><span class="em">a</span><span class="em"> bash script</span></p><pre class="border">case $1 in    prepare)        <span class="i">processing</span><span class="i">RequiredForP</span><span class="i">repare</span><span class="i">M</span><span class="i">ode</span>        ;;    backup)        <span class="i">processingRequiredForBackupMode</span>        ;;    finalize)         <span class="i">processingRequiredForFinalizeMode</span>        ;;    restore)         <span class="i">processingRequiredForRestoreMode</span>         ;;esac</pre></div></div><div class="point"><p class="title">Point</p><div class="pointbody"><ul><li><p>A sample script that backs up the database cluster and tablespace directory to a specific directory is supplied to demonstrate how to write a copy command.</p><p>The sample is stored in the directory below:</p><pre class="border">/<span class="i">installDir</span>/share/copy_command.archive.sh.sample</pre></li><li><p>A sample script that uses OPC (an advanced copy feature of Fujitsu Storage ETERNUS disk array) is supplied. Refer to "<a href="j2677-i-00-00.html">Appendix&nbsp;I Copy Command Samples that Use the Advanced Copy Feature of the ETERNUS Disk Array</a>" for details.</p><p>The samples cannot be used on SLES 12.</p></li></ul></div></div></div></div><div class="header_footer"><div class="back_next"><a href="j2677-00-14-00-00.html"><img src="image/back2.gif" width="65" height="27" border="0" alt="Previous" title="Previous"></a><a href="j2677-00-14-02-00.html"><img src="image/next2.gif" width="64" height="27" border="0" alt="Next" title="Next"></a></div><div class="copyright">Copyright 2015-2021 FUJITSU LIMITED</div></div></body></html>