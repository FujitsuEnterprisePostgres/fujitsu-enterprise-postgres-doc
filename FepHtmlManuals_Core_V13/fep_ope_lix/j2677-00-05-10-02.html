<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"><html lang="en"><head><META http-equiv="Content-Type" content="text/html; charset=UTF-8"><META CONTENT="4.3" NAME="GeneratorVersion"><title>5.10.2 Database Multiplexing Mode</title><link rel="stylesheet" href="manualmain.css" type="TEXT/CSS"><script language="JavaScript" src="topbutton.js"></script></head><body onload="init()"><div class="topButton" id="topButton0"><a class="topButton" href="#top"><img src="image/top.gif" width="62" height="20" border="0" alt="Top" title="Top"></a></div><div class="top_header"><div class="top_header_title"><a title="Title Page" class="top_link" target="_top" HREF="index.html">Enterprise Postgres 13&nbsp;Operation Guide</a></div><div class="top_header_graphic"><span class="top_logo"><img src="image/logo-white-fj.gif" width="148" height="32" alt=""></span><span class="top_keygraphic"><img src="image/cover-header-graphic.gif" width="148" height="32" alt="FUJITSU Software"></span></div></div><div class="header_footer"><div class="breadcrumbslist"><a href="j2677-00-05-00-00.html">Chapter&nbsp;5 Protecting Storage Data Using Transparent Data Encryption</a> &gt; <a href="j2677-00-05-10-00.html">5.10 Operations in Cluster Systems</a> &gt; 5.10.2 Database Multiplexing Mode</div><div class="back_next"><a href="j2677-00-05-10-01.html"><img src="image/back2.gif" width="65" height="27" border="0" alt="Previous" title="Previous"></a><a href="j2677-00-05-11-00.html"><img src="image/next2.gif" width="64" height="27" border="0" alt="Next" title="Next"></a></div></div><h3 id="br05A200">5.10.2 Database Multiplexing Mode</h3><div class="body"><div class="textblock"><p>Note the following when using transparent data encryption in environments that use streaming replication, or database multiplexing with streaming replication.</p><p></p></div><p class="subhead_1" id="ID05000000N9"><span class="em">Placing the keystore file</span><a name="N51G"></a></p><div class="textblock"><p>Place a copy of the primary server keystore file on the standby server.</p><p>This is required as the keystore file cannot be shared, and both servers may need to access it simultaneously.</p><div class="point"><p class="title">Point</p><div class="pointbody"><p>To manage the keystore file in a more secure manner, place it on the key management server or the key management storage isolated in a secure location. A keystore used by both the primary and standby servers can be managed on the same key management server or key management storage.</p><p>However, create different directories for the keystores to be used by the primary server and the standby server. Then copy the keystore for the primary server to the directory used on the standby server.</p></div></div></div><p class="subhead_1" id="ID05000000N10"><span class="em">Automatically opening the keystore</span><a name="N52G"></a></p><div class="textblock"><p>You must enable automatic opening of the keystore.</p><p>To do this, enable automatic opening of the keystore in all servers that make up database multiplexing. The settings for automatic opening of the keystore include information unique to each server, so simply copying the file does not enable it.</p></div><p class="subhead_1" id="ID05000000N11"><span class="em">Changing the passphrase</span></p><div class="textblock"><p>Changes to the passphrase are reflected in all servers that make up database multiplexing, so no special operation is required.</p></div><p class="subhead_1" id="ID05000000N12"><span class="em">Building and starting a standby server</span><a name="N53G"></a><span class="em"></span></p><div class="textblock"><p>Before using the pg_basebackup command or pgx_rcvall command to build a standby server, copy the keystore file from the primary server to the standby server. When using an automatically opening keystore, use the copied keystore file to enable automatic opening on the standby server.</p><p>Open the keystore each time you start the standby server. This step is necessary for decrypting and restoring encrypted WAL received from the primary server. To open the keystore, specify the --keystore-passphrase option in the pg_ctl command or pgx_rcvall command and enter the passphrase, or use an automatically opening keystore.</p></div><p class="subhead_1" id="ID05000000N13"><span class="em">Changing the master encryption key and the passphrase</span><a name="N54G"></a><span class="em"></span><span class="em"> </span></p><div class="textblock"><p>Change the master encryption key and the passphrase on the primary server. You need not copy the keystore from the primary server to the standby server. You need not even restart the standby server or reopen the keystore. Changes to the master encryption key and the passphrase are reflected in the keystore on the standby server.</p><div class="ref"><p class="title">See</p><div class="refbody"><p>Refer to "pgx_rcvall " in the Reference for information on pgx_rcvall command.</p><p>Refer to "pg_ctl" under "Reference" in the PostgreSQL Documentation for information on pg_ctl command.</p><p>Refer to "pg_basebackup" under "Reference" in the PostgreSQL Documentation for information on pg_basebackup command.</p><p>Refer to "High Availability, Load Balancing, and Replication" under "Server Administration" in the PostgreSQL Documentation for information on how to set up streaming replication.</p></div></div></div></div><div class="header_footer"><div class="back_next"><a href="j2677-00-05-10-01.html"><img src="image/back2.gif" width="65" height="27" border="0" alt="Previous" title="Previous"></a><a href="j2677-00-05-11-00.html"><img src="image/next2.gif" width="64" height="27" border="0" alt="Next" title="Next"></a></div><div class="copyright">Copyright 2015-2021 FUJITSU LIMITED</div></div></body></html>