<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"><html lang="en"><head><META http-equiv="Content-Type" content="text/html; charset=UTF-8"><META CONTENT="4.3" NAME="GeneratorVersion"><title>11.2.2 Recovering from a Data Load that Ended Abnormally</title><link rel="stylesheet" href="manualmain.css" type="TEXT/CSS"><script language="JavaScript" src="topbutton.js"></script></head><body onload="init()"><div class="topButton" id="topButton0"><a class="topButton" href="#top"><img src="image/top.gif" width="62" height="20" border="0" alt="Top" title="Top"></a></div><div class="top_header"><div class="top_header_title"><a title="Title Page" class="top_link" target="_top" HREF="index.html">Enterprise Postgres 13&nbsp;Operation Guide</a></div><div class="top_header_graphic"><span class="top_logo"><img src="image/logo-white-fj.gif" width="148" height="32" alt=""></span><span class="top_keygraphic"><img src="image/cover-header-graphic.gif" width="148" height="32" alt="FUJITSU Software"></span></div></div><div class="header_footer"><div class="breadcrumbslist"><a href="j2677-00-11-00-00.html">Chapter&nbsp;11 High-Speed Data Load</a> &gt; <a href="j2677-00-11-02-00.html">11.2 Using High-Speed Data Load</a> &gt; 11.2.2 Recovering from a Data Load that Ended Abnormally</div><div class="back_next"><a href="j2677-00-11-02-01.html"><img src="image/back2.gif" width="65" height="27" border="0" alt="Previous" title="Previous"></a><a href="j2677-00-11-03-00.html"><img src="image/next2.gif" width="64" height="27" border="0" alt="Next" title="Next"></a></div></div><h3 id="ID0600-loadN6">11.2.2 Recovering from a Data Load that Ended Abnormally</h3><div class="body"><div class="textblock"><p>If a system interruption such as a server failure occurs while high-speed data load is being performed, transactions prepared using this feature may be changed to the in-doubt state. At that point, resources occupied by the transaction will be locked, and access to the relevant resources from other transactions will be blocked, rendering them unusable.</p><p>In such cases, check transactions that are in an in-doubt state, and resolve them.</p><p></p></div><p class="subhead_1" id="load_0202_check"><span class="em">Checking for in-doubt transactions</span></p><div class="textblock"><p>This section describes how to check for in-doubt transactions.</p><ol><li><p>Refer to the pgx_loader_state table in the pgx_loader schema.</p><p>Retrieve the global transaction identifier (gid column) of in-doubt transactions. In-doubt transactions will contain "rollback" in the column "state".</p><div class="ex"><p class="title">Example</p><div class="exbody"><p>The example below retrieves the global transaction identifier (gid) of in-doubt transactions performed by the database role myrole and that used table tbl. The retrieved global transaction identifiers pgx_loader:9589 and pgx_loader:9590 identify in-doubt transactions.</p><pre class="border">postgres=# SELECT gid, state FROM pgx_loader.pgx_loader_state WHEREpostgres-# role_oid IN (SELECT oid FROM pg_roles WHERE rolname = 'myrole') ANDpostgres-# relation_oid IN (SELECT relid FROM pg_stat_all_tables WHEREpostgres-# relname = 'tbl');       gid       | state-----------------+------------- pgx_loader:9590 | rollback pgx_loader:9591 | commit pgx_loader:9589 | rollback(3 rows)</pre></div></div></li><li><p>Refer to the pg_prepared_xacts system view.</p><p>Check if the in-doubt transactions retrieved above exist.</p><div class="ex"><p class="title">Example</p><div class="exbody"><p>The example below checks if in-doubt transactions with the global transaction identifiers pgx_loader:9589 and pgx_loader:9590 exist.</p><pre class="border">postgres=# SELECT gid FROM pg_prepared_xacts WHERE gid IN ('pgx_loader:9589','pgx_loader:9590');       gid------------------ pgx_loader:9590 pgx_loader:9589(2 rows)</pre></div></div></li></ol><div class="ref"><p class="title">See</p><div class="refbody"><p>Refer to "<a href="j2677-e-01-00.html">E.1 pgx_loader_state</a>" for information on the pgx_loader_state table.</p></div></div></div><p class="subhead_1" id="ID0600-loadN7"><span class="em">Resolving in-doubt transactions</span></p><div class="textblock"><p>Execute the pgx_loader command in recovery mode to resolve in-doubt transactions.</p><p>After executing the pgx_loader command in recovery mode, perform the procedure described in "<a href="j2677-00-11-02-02.html#load_0202_check"><span class="u">Checking for in-d</span><span class="u">o</span><span class="u">ubt transactions</span></a>" to check if the in-doubt transactions have been resolved.</p><div class="ex"><p class="title">Example</p><div class="exbody"><p>The example below completes the in-doubt transactions prepared for table tbl.</p><pre class="border">$ pgx_loader recovery -t tbl</pre></div></div><div class="point"><p class="title">Point</p><div class="pointbody"><p>The recovery mode of the pgx_loader command only resolves transactions prepared by high-speed data load. For transactions prepared by an application using distributed transactions other than this feature, follow the procedure described in "<a href="j2677-00-15-13-00.html">15.13 Actions in Response to Error in a Distributed Transaction</a>".</p></div></div></div></div><div class="header_footer"><div class="back_next"><a href="j2677-00-11-02-01.html"><img src="image/back2.gif" width="65" height="27" border="0" alt="Previous" title="Previous"></a><a href="j2677-00-11-03-00.html"><img src="image/next2.gif" width="64" height="27" border="0" alt="Next" title="Next"></a></div><div class="copyright">Copyright 2015-2021 FUJITSU LIMITED</div></div></body></html>