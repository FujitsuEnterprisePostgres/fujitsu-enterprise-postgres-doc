<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"><html lang="en"><head><META http-equiv="Content-Type" content="text/html; charset=UTF-8"><META CONTENT="4.3" NAME="GeneratorVersion"><title>9.1.3 Setting up</title><link rel="stylesheet" href="manualmain.css" type="TEXT/CSS"><script language="JavaScript" src="topbutton.js"></script></head><body onload="init()"><div class="topButton" id="topButton0"><a class="topButton" href="#top"><img src="image/top.gif" width="62" height="20" border="0" alt="Top" title="Top"></a></div><div class="top_header"><div class="top_header_title"><a title="Title Page" class="top_link" target="_top" HREF="index.html">Enterprise Postgres 13&nbsp;Operation Guide</a></div><div class="top_header_graphic"><span class="top_logo"><img src="image/logo-white-fj.gif" width="148" height="32" alt=""></span><span class="top_keygraphic"><img src="image/cover-header-graphic.gif" width="148" height="32" alt="FUJITSU Software"></span></div></div><div class="header_footer"><div class="breadcrumbslist"><a href="j2677-00-09-00-00.html">Chapter&nbsp;9 Installing and Operating the In-memory Feature</a> &gt; <a href="j2677-00-09-01-00.html">9.1 Installing Vertical Clustered Index (VCI)</a> &gt; 9.1.3 Setting up</div><div class="back_next"><a href="j2677-00-09-01-02.html"><img src="image/back2.gif" width="65" height="27" border="0" alt="Previous" title="Previous"></a><a href="j2677-00-09-01-04.html"><img src="image/next2.gif" width="64" height="27" border="0" alt="Next" title="Next"></a></div></div><h3 id="vci_1_3">9.1.3 Setting up</h3><div class="body"><div class="textblock"><p>This section describes how to set up VCI.</p><p></p></div><p class="subhead_1" id="ID0600-vciN2"><span class="em">Setup flow</span></p><div class="textblock"><ol><li><p><a href="j2677-00-09-01-03.html#vci_1_3_1"><span class="u">Setting P</span><span class="u">a</span><span class="u">rameters</span></a></p></li><li><p><a href="j2677-00-09-01-03.html#vci_1_3_2"><span class="u">Installi</span><span class="u">n</span><span class="u">g the Extensions</span></a></p></li><li><p><a href="j2677-00-09-01-03.html#vci_1_3_3"><span class="u">Crea</span><span class="u">t</span><span class="u">ing VCI</span></a></p></li><li><p><a href="j2677-00-09-01-03.html#vci_1_3_4"><span class="u">Confirming that </span><span class="u">V</span><span class="u">CI has been Created</span></a></p></li></ol></div></div><h4 id="vci_1_3_1">9.1.3.1 Setting Parameters</h4><div class="body"><div class="textblock"><p>Edit postgresql.conf to set the required parameters for VCI. After that, start or restart the instance.</p><p>The following table lists the parameters that need or are recommended to be configured in advance:</p><table><col><col><col><col><tr><th valign="top"><p>Parameter name</p></th><th valign="top"><p>Setting value</p></th><th valign="top"><p>Description</p></th><th valign="top"><p>Required</p></th></tr><tr><td align="left" valign="top"><p>shared_preload_libraries</p></td><td align="left" valign="top"><p>Literal 'vci, pg_prewarm'</p></td><td align="left" valign="top"><p>VCI and shared library to be preloaded at server start.</p></td><td align="center" valign="top"><p>Y</p></td></tr><tr><td align="left" valign="top"><p>session_preload_libraries</p></td><td align="left" valign="top"><p>Literal 'vci, pg_prewarm'</p></td><td align="left" valign="top"><p>VCI and shared library to be preloaded at connection start.</p></td><td align="center" valign="top"><p>Y</p></td></tr><tr><td align="left" valign="top"><p>reserve_buffer_ratio</p></td><td align="left" valign="top"><p>Percentage of shared memory to be used for stable buffer table</p></td><td align="left" valign="top"><p>Proportion of shared memory to be used for a stable buffer table.</p></td><td align="center" valign="top"><p>N</p></td></tr><tr><td align="left" valign="top"><p>vci.control_max_workers</p></td><td align="left" valign="top"><p>Number of background workers that manage VCI</p></td><td align="left" valign="top"><p>Number of background workers that manage VCI.</p><p>Add this value to max_worker_processes.</p></td><td align="center" valign="top"><p>N</p></td></tr><tr><td align="left" valign="top"><p>vci.max_parallel_degree</p></td><td align="left" valign="top"><p>Maximum number of background workers used for parallel scan</p></td><td align="left" valign="top"><p>Maximum number of background workers used for parallel scan.</p><p>Add this value to max_worker_processes.</p></td><td align="center" valign="top"><p>N</p></td></tr></table><div class="ex"><p class="title">Example</p><div class="exbody"><pre class="border">shared_preload_libraries = 'vci, pg_prewarm'session_preload_libraries = 'vci, pg_prewarm'reserve_buffer_ratio = 20vci.control_max_workers = 8 vci.max_parallel_degree = 4max_worker_processes = 18 # Example: If the initial value was 6, 6 + 8 + 4 = 18</pre></div></div><div class="note"><p class="title">Note</p><div class="notebody"><p>An error occurs if you use VCI to start instances when procfs is not mounted. Ensure that procfs is mounted before starting instances.</p></div></div><div class="ref"><p class="title">See</p><div class="refbody"><ul><li><p>Refer to "<a href="j2677-a-00-00.html">Appendix&nbsp;A Parameters</a>" for information on all parameters for VCI. Refer also to default value for each parameter and details such as specification range in the same chapter. Refer to "Server Configuration" under "Server Administration" in the PostgreSQL documentation for information on shared_preload_libraries, session_preload_libraries, and max_worker_processes.</p></li></ul></div></div></div></div><h4 id="vci_1_3_2">9.1.3.2 Installing the Extensions</h4><div class="body"><div class="textblock"><p>Execute CREATE EXTENSION to install the VCI and pg_prewarm extensions. Both extensions need to be installed for each database.</p><ul><li><p>Installing VCI</p><pre class="border">db01=# CREATE EXTENSION vci;</pre></li><li><p>Installing pg_prewarm</p><pre class="border">db01=# CREATE EXTENSION pg_prewarm;</pre></li></ul><div class="note"><p class="title">Note</p><div class="notebody"><ul><li><p>Only superusers can install VCI extensions.</p></li><li><p>VCI extensions can only be installed in public schema.</p></li><li><p>Some operations cannot be performed for VCI extensions. Refer to "<a href="j2677-00-09-02-01.html">9.2.1 Commands that cannot be Used for VCI</a>" for details.</p></li></ul></div></div></div></div><h4 id="vci_1_3_3">9.1.3.3 Creating a VCI</h4><div class="body"><div class="textblock"><p>Execute the CREATE INDEX statement with the "USING vci" clause to create a VCI for the desired columns and the "WITH (stable_buffer=true)" clause to enable the stable buffer feature.</p><p>To use a separate disk for the VCI, specify the TABLESPACE clause.</p><pre class="border">db01=# CREATE INDEX idx_vci ON table01 USING vci (col01, col02) WITH (stable_buffer=true);</pre><div class="note"><p class="title">Note</p><div class="notebody"><ul><li><p>Some table types cannot be specified on the ON clause of CREATE INDEX. Refer to "<a href="j2677-00-09-01-04.html#vci_1_4_1">9.1.4.1 Relation Types</a>" for details.</p></li><li><p>Some data types cannot be specified on the column specification of CREATE INDEX. Refer to "<a href="j2677-00-09-01-04.html#vci_1_4_2">9.1.4.2 Data Types</a>" for details.</p></li><li><p>Some operations cannot be performed for VCI. Refer to "<a href="j2677-00-09-02-01.html">9.2.1 Commands that cannot be Used for VCI</a>" for details.</p></li><li><p>The same column cannot be specified more than once on the column specification of CREATE INDEX.</p></li><li><p>VCI cannot be created for table columns that belong to the template database.</p></li><li><p>CREATE INDEX creates multiple views named vci_<span class="i">10digitRelOid</span>_<span class="i">5digitRelAttr</span>_<span class="i">1</span><span class="i">char</span><span class="i">RelType</span> alongside VCI itself. These are called VCI internal relations. Do not update or delete them as they are used for VCI aggregation.</p></li><li><p>All data for the specified column will be replaced in columnar format when VCI is created, so executing CREATE INDEX on an existing table with data inserted takes more time compared with a general index (B-tree). Jobs can continue while CREATE INDEX is running.</p></li><li><p>When CREATE INDEX USING VCI is invoked on a partitioned table, the default behavior is to recurse to all partitions to ensure they all have matching indexes. Each partition is first checked to determine whether an equivalent index already exists, and if so, that index will become attached as a partition index to the index being created, which will become its parent index. If no matching index exists, a new index will be created and automatically attached; the name of the new index in each partition will be determined as if no index name had been specified in the command. If the ONLY option is specified, no recursion is done, and the index is marked invalid. (ALTER INDEX ... ATTACH PARTITION marks the index valid, once all partitions acquire matching indexes.) Note, however, that any partition that is created in the future using CREATE TABLE ... PARTITION OF will automatically have a matching index, regardless of whether ONLY is specified. </p></li><li><p>Parallel index build is not supported on VCI indexes.</p></li></ul></div></div></div></div><h4 id="vci_1_3_4">9.1.3.4 Confirming that the VCI has been Created</h4><div class="body"><div class="textblock"><p>Execute the SELECT statement to reference the pg_indexes catalog, and confirm that the VCI was created for the target columns.</p><div class="ex"><p class="title">Example</p><div class="exbody"><pre class="border">db01=# SELECT indexdef FROM pg_indexes WHERE indexdef LIKE '%vci%';                         indexdef                         ----------------------------------------------------------CREATE INDEX idx_vci ON table01 USING vci (col01, col02)(1 row)</pre></div></div></div></div><div class="header_footer"><div class="back_next"><a href="j2677-00-09-01-02.html"><img src="image/back2.gif" width="65" height="27" border="0" alt="Previous" title="Previous"></a><a href="j2677-00-09-01-04.html"><img src="image/next2.gif" width="64" height="27" border="0" alt="Next" title="Next"></a></div><div class="copyright">Copyright 2015-2021 FUJITSU LIMITED</div></div></body></html>