<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"><html lang="en"><head><META http-equiv="Content-Type" content="text/html; charset=UTF-8"><META CONTENT="4.3" NAME="GeneratorVersion"><title>15.6.2 Replacing the Disk with a Larger Capacity Disk</title><link rel="stylesheet" href="manualmain.css" type="TEXT/CSS"><script language="JavaScript" src="topbutton.js"></script></head><body onload="init()"><div class="topButton" id="topButton0"><a class="topButton" href="#top"><img src="image/top.gif" width="62" height="20" border="0" alt="Top" title="Top"></a></div><div class="top_header"><div class="top_header_title"><a title="Title Page" class="top_link" target="_top" HREF="index.html">Enterprise Postgres 13&nbsp;Operation Guide</a></div><div class="top_header_graphic"><span class="top_logo"><img src="image/logo-white-fj.gif" width="148" height="32" alt=""></span><span class="top_keygraphic"><img src="image/cover-header-graphic.gif" width="148" height="32" alt="FUJITSU Software"></span></div></div><div class="header_footer"><div class="breadcrumbslist"><a href="j2677-00-15-00-00.html">Chapter&nbsp;15 Actions when an Error Occurs</a> &gt; <a href="j2677-00-15-06-00.html">15.6 Actions in Response to Insufficient Space on the Data Storage Destination</a> &gt; 15.6.2 Replacing the Disk with a Larger Capacity Disk</div><div class="back_next"><a href="j2677-00-15-06-01.html"><img src="image/back2.gif" width="65" height="27" border="0" alt="Previous" title="Previous"></a><a href="j2677-00-15-07-00.html"><img src="image/next2.gif" width="64" height="27" border="0" alt="Next" title="Next"></a></div></div><h3 id="br076200">15.6.2 Replacing the Disk with a Larger Capacity Disk</h3><div class="body"><div class="textblock"><p>Before replacing the disk with a larger capacity disk, migrate resources at the data storage destination using the backup and recovery features.</p><p>There are two methods of performing backup and recovery:</p><ul><li><p><a href="j2677-00-15-06-02.html#br076210">15.6.2.1 Using WebAdmin</a></p></li><li><p><a href="j2677-00-15-06-02.html#br076220">15.6.2.2 Using Server Commands</a></p></li></ul><p>The following sections describe procedures that use each of these methods to replace the disk and migrate resources at the data storage destination.</p><div class="note"><p class="title">Note</p><div class="notebody"><ul><li><p>Before replacing the disk, stop applications and instances that are using the database.</p></li><li><p>It is recommended that you back up the database cluster following recovery. Backup deletes obsolete archive logs (transaction logs copied to the backup data storage destination), freeing up disk space and reducing the recovery time.</p></li></ul></div></div><p></p></div></div><h4 id="br076210">15.6.2.1 Using WebAdmin</h4><div class="body"><div class="textblock"><p>Follow the procedure below to replace the disk and migrate resources at the data storage destination by using WebAdmin.</p><ol><li><p>Back up files</p><p>If the disk at the data storage destination contains any required files, back up the files. It is not necessary to back up the data storage destination.</p></li><li><p>Stop applications</p><p>Stop applications that are using the database.</p></li><li><p>Back up the database cluster</p><p>Back up the latest resources at the data storage destination. Refer to "<a href="j2677-00-03-02-01.html">3.2.1 Using WebAdmin</a>" for details.</p></li><li><p>Stop the instance</p><p>Stop the instance. Refer to "<a href="j2677-00-02-01-01.html">2.1.1 Using WebAdmin</a>" for information on how to stop an instance.</p></li><li><p>Replace with a larger capacity disk</p><p>Replace the disk. Then, recover the volume configuration information.</p></li><li><p>Recover the database cluster</p><p>Log in to WebAdmin, and perform recovery operations. Refer to steps 4 ("Create a tablespace directory ") to 7 ("Run recovery") under "If failure occurred in the data storage disk or the transaction log storage disk" in "<a href="j2677-00-15-01-01.html">15.1.1 Using WebAdmin</a>" for information on the procedure. An instance is automatically started when recovery is successful.</p></li><li><p>Resume applications</p><p>Resume applications that are using the database.</p></li><li><p>Restore the files</p><p>Restore the files backed up in step 1.</p></li></ol></div></div><h4 id="br076220">15.6.2.2 Using Server Commands</h4><div class="body"><div class="textblock"><p>Follow the procedure below to replace the disk and migrate resources at the data storage destination by using server commands.</p><ol><li><p>Back up files</p><p>If the disk at the data storage destination contains any required files, back up the files. It is not necessary to back up the data storage destination.</p></li><li><p>Stop applications</p><p>Stop applications that are using the database.</p></li><li><p>Back up the database cluster</p><p>Back up the latest resources at the data storage destination. Refer to "<a href="j2677-00-03-02-02.html">3.2.2 Using Server Commands</a>" for details.</p></li><li><p>Stop the instance</p><p>After backup is complete, stop the instance. Refer to "<a href="j2677-00-02-01-02.html">2.1.2 Using Server Commands</a>" for information on how to stop an instance.</p><p>If the instance fails to stop, refer to "<a href="j2677-00-15-11-00.html">15.11 Actions in Response to Failure to Stop an Instance</a>".</p></li><li><p>Replace with a larger capacity disk</p><p>Replace the disk. Then, recover the volume configuration information.</p></li><li><p>Create a data storage destination</p><p>Create a data storage destination. If a tablespace was defined, also create a directory for it.</p><dl><dt class="em">Example</dt><dd><pre class="border">$ mkdir /database/inst1$ chown fsepuser:fsepuser /database/inst1$ chmod 700 /database/inst1</pre></dd></dl></li><li><p>Recover the keystore, and enable automatic opening of the keystore</p><p>When the data in the database has been encrypted, restore the keystore to its state at the time of the database backup. Configure automatic opening of the keystore as necessary.</p></li><li><p>Recover the database cluster</p><p>Use the pgx_rcvall command to recover the database cluster.</p><ul><li><p>Specify the data storage destination in the -D option. If the -D option is omitted, the value of the PGDATA environment variable is used by default.</p></li><li><p>Specify the backup storage directory in the -B option.</p></li></ul><dl><dt class="em">Example</dt><dd></dd></dl><pre class="border">&gt; pgx_rcvall -D /database/inst1 -B /backup/inst1</pre><div class="note"><p class="title">Note</p><div class="notebody"><p>If recovery fails, remove the cause of the error in accordance with the displayed error message and then re-execute the pgx_rcvall command.</p><p>If the message "pgx_rcvall: an error occurred during recovery" is displayed, then the log recorded when recovery was executed is output after this message. The cause of the error is output in around the last fifteen lines of the log, so remove the cause of the error in accordance with the message and then re-execute the pgx_rcvall command.</p><p>The following message displayed during recovery is output as part of normal operation of pgx_rcvall (therefore the user does not need not be concerned).</p><pre class="border">FATAL: the database system is starting up</pre></div></div><div class="ref"><p class="title">See</p><div class="refbody"><p>Refer to "pgx_rcvall" in the Reference for information on the pgx_rcvall command.</p></div></div></li><li><p>Start the instance</p><p>Start the instance.</p><p>Refer to "<a href="j2677-00-02-01-02.html">2.1.2 Using Server Commands</a>" for information on how to start an instance.</p><div class="note"><p class="title">Note</p><div class="notebody"><p>The pgx_rcvall command cannot accurately recover a hash index. If you are using a hash index, wait for the pgx_rcvall command to end and then execute the REINDEX command for the appropriate index.</p></div></div></li><li><p>Resume applications</p><p>Resume applications that are using the database.</p></li><li><p>Restore files</p><p>Restore the files backed up in step 1.</p></li></ol></div></div><div class="header_footer"><div class="back_next"><a href="j2677-00-15-06-01.html"><img src="image/back2.gif" width="65" height="27" border="0" alt="Previous" title="Previous"></a><a href="j2677-00-15-07-00.html"><img src="image/next2.gif" width="64" height="27" border="0" alt="Next" title="Next"></a></div><div class="copyright">Copyright 2015-2021 FUJITSU LIMITED</div></div></body></html>