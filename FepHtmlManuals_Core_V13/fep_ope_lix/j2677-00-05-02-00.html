<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"><html lang="en"><head><META http-equiv="Content-Type" content="text/html; charset=UTF-8"><META CONTENT="4.3" NAME="GeneratorVersion"><title>5.2 Setting the Master Encryption Key</title><link rel="stylesheet" href="manualmain.css" type="TEXT/CSS"><script language="JavaScript" src="topbutton.js"></script></head><body onload="init()"><div class="topButton" id="topButton0"><a class="topButton" href="#top"><img src="image/top.gif" width="62" height="20" border="0" alt="Top" title="Top"></a></div><div class="top_header"><div class="top_header_title"><a title="Title Page" class="top_link" target="_top" HREF="index.html">Enterprise Postgres 13&nbsp;Operation Guide</a></div><div class="top_header_graphic"><span class="top_logo"><img src="image/logo-white-fj.gif" width="148" height="32" alt=""></span><span class="top_keygraphic"><img src="image/cover-header-graphic.gif" width="148" height="32" alt="FUJITSU Software"></span></div></div><div class="header_footer"><div class="breadcrumbslist"><a href="j2677-00-05-00-00.html">Chapter&nbsp;5 Protecting Storage Data Using Transparent Data Encryption</a> &gt; 5.2 Setting the Master Encryption Key</div><div class="back_next"><a href="j2677-00-05-01-00.html"><img src="image/back2.gif" width="65" height="27" border="0" alt="Previous" title="Previous"></a><a href="j2677-00-05-03-00.html"><img src="image/next2.gif" width="64" height="27" border="0" alt="Next" title="Next"></a></div></div><h2 id="br052000">5.2 Setting the Master Encryption Key<a name="N35G"></a></h2><div class="body"><div class="textblock"><p>To use transparent data encryption, you must create a keystore and set the master encryption key.</p><ol><li><p>In the keystore_location parameter of postgresql.conf, specify the directory to store the keystore.</p><p>Specify a different location for each database cluster.</p><pre class="border">keystore_location = '/key/store/location'</pre><p>Refer to "<a href="j2677-a-00-00.html">Appendix&nbsp;A Parameters</a>" for information on postgresql.conf.</p><p>After editing the postgresql.conf file, either start or restart the instance.</p><ul><li><p>Using WebAdmin</p><p>Refer to "<a href="j2677-00-02-01-01.html">2.1.1 Using WebAdmin</a>", and restart the instance.</p></li><li><p>Using the pg_ctl command</p><p>Specify the following in the pg_ctl command:</p><ul><li><p>Specify "restart" as the mode.</p></li><li><p>Specify the data storage destination directory in the -D option. If the -D option is omitted, the value of the PGDATA environment variable is used by default.</p></li><li><p>Specify the -w option. This means that the command returns after waiting for the instance to start. If the -w option is not specified, it may not be possible to determine if the starting of the instance completed successfully or if it failed.</p></li></ul><dl><dt class="em">Example</dt><dd><pre class="border">&gt; pg_ctl restart -w -D /database/inst1</pre></dd></dl></li></ul></li><li><p>Execute an SQL function, such as the one below, to set the master encryption key. This must be performed by the superuser. Execute it as the database superuser.</p><pre class="border">SELECT pgx_set_master_key('passphrase');</pre><p>The value "passphrase" is the passphrase that will be used to open the keystore. The master encryption key is protected by this passphrase, so avoid specifying a short simple string that is easy to guess.</p><p>Refer to "<a href="j2677-b-02-00.html">B.2 Transparent Data Encryption Control Functions</a>" for information on the pgx_set_master_key function.</p></li></ol><div class="note"><p class="title">Note</p><div class="notebody"><p>Note that if you forget the passphrase, you will not be able to access the encrypted data. There is no method to retrieve a forgotten passphrase and decrypt data. Do not, under any circumstances, forget the passphrase.</p><p>The pgx_set_master_key function creates a file with the name keystore.ks in the keystore storage destination. It also creates a master encryption key from random bit strings, encrypts it with the specified passphrase, and stores it in keystore.ks. At this point, the keystore is open.</p></div></div><p></p></div></div><div class="header_footer"><div class="back_next"><a href="j2677-00-05-01-00.html"><img src="image/back2.gif" width="65" height="27" border="0" alt="Previous" title="Previous"></a><a href="j2677-00-05-03-00.html"><img src="image/next2.gif" width="64" height="27" border="0" alt="Next" title="Next"></a></div><div class="copyright">Copyright 2015-2021 FUJITSU LIMITED</div></div></body></html>