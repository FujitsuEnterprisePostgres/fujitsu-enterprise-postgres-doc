<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"><html lang="en"><head><META http-equiv="Content-Type" content="text/html; charset=UTF-8"><META CONTENT="4.3" NAME="GeneratorVersion"><title>1.1.2 Mechanism of Heartbeat Monitoring Feature</title><link rel="stylesheet" href="manualmain.css" type="TEXT/CSS"><script language="JavaScript" src="topbutton.js"></script></head><body onload="init()"><div class="topButton" id="topButton0"><a class="topButton" href="#top"><img src="image/top.gif" width="62" height="20" border="0" alt="Top" title="Top"></a></div><div class="top_header"><div class="top_header_title"><a title="Title Page" class="top_link" target="_top" HREF="index.html">Enterprise Postgres 13&nbsp;Connection Manager User's Guide</a></div><div class="top_header_graphic"><span class="top_logo"><img src="image/logo-white-fj.gif" width="148" height="32" alt=""></span><span class="top_keygraphic"><img src="image/cover-header-graphic.gif" width="148" height="32" alt="FUJITSU Software"></span></div></div><div class="header_footer"><div class="breadcrumbslist"><a href="j2682-00-01-00-00.html">Chapter&nbsp;1 Connection Manager Features</a> &gt; <a href="j2682-00-01-01-00.html">1.1 Heartbeat Monitoring Feature</a> &gt; 1.1.2 Mechanism of Heartbeat Monitoring Feature</div><div class="back_next"><a href="j2682-00-01-01-01.html"><img src="image/back2.gif" width="65" height="27" border="0" alt="Previous" title="Previous"></a><a href="j2682-00-01-02-00.html"><img src="image/next2.gif" width="64" height="27" border="0" alt="Next" title="Next"></a></div></div><h3 id="mID_01_mechanism_heartbeat_monitoring">1.1.2 Mechanism of Heartbeat Monitoring Feature</h3><div class="body"><div class="textblock"><p>On the client side, the user must start one monitoring process using the cm_ctl command for the set of the instances to be monitored. This process, called the "conmgr process<a name="N3G"></a>", can only be started by a user who is not an administrator (e.g. superuser(root) on Linux). An instance set is a collection of one or more instances that make up replication. One configuration file (conmgr.conf) for each conmgr process is used to set the information about the set of the instances being monitored and the parameters for monitoring.</p><p>On the server side, by installing PostgreSQL's EXTENSION that is called "watchdog", the postmaster will start two processes as background workers at instance startup. </p><p>One is the process for sending and receiving packets to and from the conmgr process for heartbeat monitoring. It is called "watchdog process<a name="N4G"></a>". The other is the process for forcibly terminating SQL connections of the clients for which the watchdog process detects a failure on heartbeat monitorting. It is called "terminator process<a name="N5G"></a>". SQL connections that do not use Connection Manager is also terminated, because the terminator process terminates them by IP address as key.</p><div class="note"><p class="title">Note</p><div class="notebody"><p><span class="em">System Configuration Notes</span></p><p>For replication, it is recommended that the instance that connects to the upstream instance of replication and the conmgr process that regards the upstream instance as an instance to be monitored for heartbeart (specified in backend_host parameter or backend_hostaddr parameter that is a configuration parameter of conmgr process) be not placed on the same server. This is because if the conmgr process stops normally or abnormally, the terminator process in the upstream instance will also kill the replication connection. The replication connection will reconnect automatically even if it is forcibly disconnected, so replication will continue without any problems. However, this can be a problem when the replication load is high or on systems that are sensitive to replication delays.</p><p>Note that the replication connection have different monitoring feature than the Connection Manager, so there is no need to monitor the Connection Manager for heartbeat. Refer to PostgreSQL documentation for details.</p></div></div><p>The process relationship is as follows:</p><p><img src="chap01img/e-process-conf.gif" alt="" width="955" height="438"></p><br><div class="ref"><p class="title">See</p><div class="refbody"><p>Refer to "cm_ctl" in the Reference for information on cm_ctl command.</p></div></div><p></p></div></div><div class="header_footer"><div class="back_next"><a href="j2682-00-01-01-01.html"><img src="image/back2.gif" width="65" height="27" border="0" alt="Previous" title="Previous"></a><a href="j2682-00-01-02-00.html"><img src="image/next2.gif" width="64" height="27" border="0" alt="Next" title="Next"></a></div><div class="copyright">Copyright 2020-2021 FUJITSU LIMITED </div></div></body></html>