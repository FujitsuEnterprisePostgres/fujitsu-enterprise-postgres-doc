<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"><html lang="en"><head><META http-equiv="Content-Type" content="text/html; charset=UTF-8"><META CONTENT="4.3" NAME="GeneratorVersion"><title>2.1.2 Configuring conmgr.conf</title><link rel="stylesheet" href="manualmain.css" type="TEXT/CSS"><script language="JavaScript" src="topbutton.js"></script></head><body onload="init()"><div class="topButton" id="topButton0"><a class="topButton" href="#top"><img src="image/top.gif" width="62" height="20" border="0" alt="Top" title="Top"></a></div><div class="top_header"><div class="top_header_title"><a title="Title Page" class="top_link" target="_top" HREF="index.html">Enterprise Postgres 13&nbsp;Connection Manager User's Guide</a></div><div class="top_header_graphic"><span class="top_logo"><img src="image/logo-white-fj.gif" width="148" height="32" alt=""></span><span class="top_keygraphic"><img src="image/cover-header-graphic.gif" width="148" height="32" alt="FUJITSU Software"></span></div></div><div class="header_footer"><div class="breadcrumbslist"><a href="j2682-00-02-00-00.html">Chapter&nbsp;2 Setting Up</a> &gt; <a href="j2682-00-02-01-00.html">2.1 Setting Up the Client Side</a> &gt; 2.1.2 Configuring conmgr.conf</div><div class="back_next"><a href="j2682-00-02-01-01.html"><img src="image/back2.gif" width="65" height="27" border="0" alt="Previous" title="Previous"></a><a href="j2682-00-02-02-00.html"><img src="image/next2.gif" width="64" height="27" border="0" alt="Next" title="Next"></a></div></div><h3 id="IDchap02N3">2.1.2 Configuring conmgr.conf<a name="N6G"></a></h3><div class="body"><div class="textblock"><p>Place the configuration file conmgr.conf in the directory for the conmgr process.</p><p></p></div><p class="subhead_1" id="IDchap02N4"><span class="em">Syntax for conmgr.conf</span></p><div class="textblock"><ul><li><p>In conmgr.conf, after the symbol(#) are considered comments.</p></li><li><p>The parameter name = value" is a set of settings and must be written on one line.</p></li><li><p>Set the value in a format that matches the type of each parameter. The types and formats are:</p><ul><li><p>integer: Numeric type. Express as a sequence of numbers in decimal number.</p></li><li><p>string: String type. You can also include spaces by enclosing them in quotation marks('). If you include quotation marks, escape them.</p></li><li><p>enum: Enumeration type. Possible values are determined.</p></li></ul></li></ul></div><p class="subhead_1" id="IDchap02N5"><span class="em">Parameters to Set</span></p><div class="textblock"><dl><dt class="em">port<a name="N7G"></a> (integer)</dt><dd><p>Specify the port number on which the conmgr process listens for connections from the applications.</p><p>The value must be greater than or equal to 1 and less than or equal to 65535. The default is 27546. You must restart conmgr process for this parameter change to take effect.</p></dd></dl><dl><dt class="em">backend_host*<a name="N8G"></a> (string)</dt><dd><p>Specify the host name or IP address of the instance.</p><p>You can also use IPv6 address. If you specify the IP address directly, you can save time by using backend_hostaddr parameter. If backend_host parameter and backend_hostaddr parameter are both specified, backend_hostaddr parameter is used. You must restart conmgr process for this parameter change to take effect.</p><p>To distinguish multiple instances, append a zero-based number immediately after the parameter name, such as backend_host0, backend_host1,... This number is called the instance number. A parameter identified by the same instance number configures the settings of a single instance. If you want to exclude some instances from your replication configuration, you can simply remove the settings for that instance.</p><div class="note"><p class="title">Note</p><div class="notebody"><p>Refer to "System Configuration Notes" in "<a href="j2682-00-01-01-02.html">1.1.2 Mechanism of Heartbeat Monitoring Feature</a>" for details.</p></div></div><p>For example, if two instances are listening on "host name:host0, port number:5432" and "host name:host1, port number:2345", write as follows.</p><p>backend_host0='host0'<br>backend_port0=5432<br>backend_host1='host1'<br>backend_port1=2345</p><p>You can also mix different instance number settings:</p><p>backend_host0='host0'<br>backend_host1='host1'<br>backend_port0=5432<br>backend_port1=2345</p><p>It does not matter if the instance number is missing as in the following (instance number 1):</p><p>backend_host0='host0'<br>backend_host2='host2'<br>backend_port0=5432<br>backend_port2=2345</p><p>If the host name is omitted even if the port is specified, as in the following instance number 1, it is regarded as a missisng number.</p><p>backend_host0='host0'<br>backend_host2='host2'<br>backend_port0=5432<br>backend_port1=5555<br>backend_port2=2345</p></dd></dl><dl><dt class="em">backend_hostaddr*<a name="N9G"></a>(string)</dt><dd><p>Same as backend_host parameter except no name resolution is used.</p></dd></dl><dl><dt class="em">backend_port*<a name="N10G"></a> (integer)</dt><dd><p>Specify the port number the postmaster of the instance will listen on.</p><p>The value must be greater than or equal to 1 and less than or equal to 65535. The default is 27500. Append the instance number as you would for backend_host parameter. You must restart conmgr process for this parameter change to take effect.</p></dd></dl><dl><dt class="em">watchdog_port*<a name="N11G"></a> (integer)</dt><dd><p>Specify the port number on which the watchdog process listens.</p><p>The conmgr process connects to this port, but the user application does not. you must set it to the same value as<a href="j2682-00-02-02-01.html#watchdogport"><span class="u"> watchdog.port</span></a> parameter in postgresql.conf. The value must be greater than or equal to 1 and less than or equal to 65535. The default is 27545. Append the instance number as you would for backend_host parameter. You must restart conmgr process for this parameter change to take effect.</p></dd></dl><dl><dt class="em">heartbeat_interval<a name="N12G"></a> (integer)</dt><dd><p>Specify the interval at which heartbeat packets are sent for heartbeat monitoring.</p><p>Used in conjunction with heartbeat_timeout parameter. Connection Manager heartbeat monitoring always continues to send packets periodically from both ends of the connection. If a packet is not received from the other side within a certain period of time, the link is considered down.</p><p>Note that this method is different from TCP keepalive. TCP keepalive send a keepalive packet only when there is a certain amount of inactivity (idle), and expects to receive an ACK for that packet. If TCP keepalive does not receive an ACK, it repeats this a specified number of times and then assumes that the link is down.</p><p>The heartbeat_interval parameter and heartbeat_timeout parameter are propagated from the conmgr process to the watchdog process, and also apply to the interval between the transmissions of heartbeat packets from the watchdog process. If a watchdog process is connected from both a conmgr process with a heartbeat_interval parameter of 3 seconds and a conmgr process with a heartbeat_interval of 5 seconds, it sends heartbeat packets every 3 seconds to the former process and every 5 seconds to the latter process. The unit is seconds. Specify a value equal to or more than 1 second. The default is 10 seconds. You must restart conmgr process for this parameter change to take effect.</p></dd></dl><dl><dt class="em">heartbeat_timeout<a name="N13G"></a> (integer)</dt><dd><p>If a heartbeat packet for heartbeat monitoring cannot be received for more than the time specified by this parameter, an error is assumed to have occurred and the application is notified of the error.</p><p>This parameter should be decide of heartbeat_interval parameter as the basis. No error is occured when the configuration file is loaded, but is always considered abnormal by heartbeat monitoring if it is at least not greater than heartbeat_interval parameter. The unit is seconds. Specify a value equal to or more than 1 second. The default is 20 seconds. You must restart conmgr process for this parameter change to take effect.</p><p>Refer to the following figure for the relationship between the heartbeat_interval parameter and heartbeat_timeout parameter settings and the heartbeat timeout.</p><p><img src="chap02img/e-heartbeat-timeout.gif" alt="" width="617" height="393"></p></dd></dl><dl><dt class="em">heartbeat_connect_interval<a name="N14G"></a> (integer)</dt><dd><p>Specify the interval between attempts to establish heartbeat monitoring again after detecting an abnormality.</p><p>This parameter is useful when only the database server is started, but not the instance. In such a situation, the TCP connection fails immediately, and retries cannot be attempted without an interval. If you specify an excessively long value, you may delay noticing the start of the instance. If a connection attempt fails for a long time, it will attempt the next connection after the time specified by heartbeat_connect_interval parameter has elapsed. The unit is seconds. Specify a value equal to or more than 1 second. The default is 1 second. You must restart conmgr for this parameter change to take effect.</p></dd></dl><dl><dt class="em">heartbeat_connect_timeout<a name="N15G"></a> (integer)</dt><dd><p>Specify the connection timeout for establishing heartbeat monitoring.</p><p>The connection includes the time it takes to send the TCP connection and the first heartbeat packet to the watchdog process and receive a reply from the watchdog process. This parameter is particularly needed when the other server is down or the network is disconnected. This is because TCP connections are attempted over a long period of time, depending on the operating system configuration, and the connection takes a long time to fail. The unit is seconds. Specify a value equal to or more than 1 second. The default is 10 seconds. You must restart conmgr process for this parameter change to take effect.</p></dd></dl><dl><dt class="em">log_destination<a name="N16G"></a> (string)</dt><dd><p>Specify the destination of the message.</p><p>You can specify multiple destinations. Use commas to separate multiple entries and enclose all in single quotation marks. "stderr" and "syslog" can be specified. The default is to print only to stderr. You must restart conmgr process for this parameter change to take effect.</p></dd></dl><dl><dt class="em">syslog_facility<a name="N17G"></a> (enum)</dt><dd><p>Specify the syslog facility.</p><p>Valid only if log_destination parameter includes "syslog". LOCAL0, LOCAL1, LOCAL2, LOCAL3, LOCAL4, LOCAL5, LOCAL6, or LOCAL7 can be specified.</p><p>The default is "LOCAL0". You must restart conmgr process for this parameter change to take effect.</p></dd></dl><dl><dt class="em">syslog_ident<a name="N18G"></a> (string)</dt><dd><p>Specify the program name used to identify the output from the conmgr process.</p><p>The default is "conmgr". You must restart conmgr process for this parameter change to take effect.</p></dd></dl><dl><dt class="em">log_min_messages<a name="N19G"></a> (enum)</dt><dd><p>Specifies the level of messages to output.</p><p>It can be DEBUG, INFO, NOTICE, WARNING, ERROR, LOG, FATAL, or PANIC. Messages below the specified level are not output. The default is "WARNING". You must restart conmgr process for this parameter change to take effect.</p></dd></dl><dl><dt class="em">max_connections<a name="N20G"></a> (integer)</dt><dd><p>Specifies the maximum number of simultaneous connections to the conmgr process.</p><p>If there are more than this maximum number of client connections, it forces the connection to be closed without sending an error message to the client.</p><p>The conmgr process also outputs this fact at level &ldquo;LOG&rdquo; to the destination specified by log_destination. Specify a value equal to or more than 0.</p><p>If 0 is specified, there is no limit. The default is 0. You must restart conmgr process for this parameter change to take effect.</p><div class="note"><p class="title">Note</p><div class="notebody"><p>The maximum number of file descriptors that can be opened simultaneously (You can check it with -n of the ulimit command.) imposed on a conmgr process by the OS user limit should be greater than the value derived from the following equation:. Otherwise, the conmgr process will abort if the user limit is violated.</p><pre class="border">9 + Number of database instances specified in conmgr.conf x 2  + max_connections specified in conmgr.conf</pre></div></div><br></dd></dl></div><p class="subhead_1" id="IDchap02N6"><span class="em">Overview of connections definitions</span></p><div class="textblock"><p>The following figure shows the relationship between the IP address or host name and the port number set in conmgr.conf and the processes.</p><p><img src="chap02img/e-connection-conf.gif" alt="" width="951" height="508"></p><br></div></div><div class="header_footer"><div class="back_next"><a href="j2682-00-02-01-01.html"><img src="image/back2.gif" width="65" height="27" border="0" alt="Previous" title="Previous"></a><a href="j2682-00-02-02-00.html"><img src="image/next2.gif" width="64" height="27" border="0" alt="Next" title="Next"></a></div><div class="copyright">Copyright 2020-2021 FUJITSU LIMITED </div></div></body></html>