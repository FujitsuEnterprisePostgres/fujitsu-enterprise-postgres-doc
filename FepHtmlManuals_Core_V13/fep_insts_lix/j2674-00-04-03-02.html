<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"><html lang="en"><head><META http-equiv="Content-Type" content="text/html; charset=UTF-8"><META CONTENT="4.3" NAME="GeneratorVersion"><title>4.3.2 Using the initdb Command</title><link rel="stylesheet" href="manualmain.css" type="TEXT/CSS"><script language="JavaScript" src="topbutton.js"></script></head><body onload="init()"><div class="topButton" id="topButton0"><a class="topButton" href="#top"><img src="image/top.gif" width="62" height="20" border="0" alt="Top" title="Top"></a></div><div class="top_header"><div class="top_header_title"><a title="Title Page" class="top_link" target="_top" HREF="index.html">Enterprise Postgres 13&nbsp;Installation and Setup Guide for Server</a></div><div class="top_header_graphic"><span class="top_logo"><img src="image/logo-white-fj.gif" width="148" height="32" alt=""></span><span class="top_keygraphic"><img src="image/cover-header-graphic.gif" width="148" height="32" alt="FUJITSU Software"></span></div></div><div class="header_footer"><div class="breadcrumbslist"><a href="j2674-00-04-00-00.html">Chapter&nbsp;4 Setup</a> &gt; <a href="j2674-00-04-03-00.html">4.3 Creating Instances</a> &gt; 4.3.2 Using the initdb Command</div><div class="back_next"><a href="j2674-00-04-03-01.html"><img src="image/back2.gif" width="65" height="27" border="0" alt="Previous" title="Previous"></a><a href="j2674-00-04-04-00.html"><img src="image/next2.gif" width="64" height="27" border="0" alt="Next" title="Next"></a></div></div><h3 id="mID_0402_instance_initdb">4.3.2 Using the initdb Command<a name="N37G"></a></h3><div class="body"><div class="textblock"><p>This section describes the procedure to create an instance using the initdb command.</p><br><div class="note"><p class="title">Note</p><div class="notebody"><p>If a port is blocked (access permissions have not been granted) by a firewall, enable use of the port by granting access. Refer to the vendor document for information on how to grant port access permissions.<br>Consider the security risks carefully when opening ports.</p></div></div><br><p></p></div></div><h4 id="IDinsts04-03-slN8">4.3.2.1 Editing Kernel Parameters</h4><div class="body"><div class="textblock"><p>Refer to "<a href="j2674-h-00-00.html">Appendix&nbsp;H Configuring Kernel Parameters</a>" prior to editing these settings.</p><p>After the settings are complete, check the command specifications of the relevant operating system and restart the system if required.</p></div></div><h4 id="IDinsts04-03-slN9">4.3.2.2 Creating an Instance<a name="N38G"></a></h4><div class="body"><div class="textblock"><p>Create an instance, with the database cluster storage destination specified in the PGDATA environment variable or in the -D option. Furthermore, the user that executed the initdb command becomes the instance administrator.</p><div class="note"><p class="title">Note</p><div class="notebody"><ul><li><p>Instances created using the initdb command (command line instances) can be managed using WebAdmin, however, they must first be imported into WebAdmin. Refer to "<a href="j2674-00-04-03-01.html#mID_0403_WebAdmin_import">4.3.1.4 Importing Instances</a>" for details.</p></li><li><p>If creating multiple instances, ensure that there is no duplication of port numbers or the directories that store database clusters.</p></li></ul></div></div><div class="ref"><p class="title">See</p><div class="refbody"><p>Refer to "initdb" in "Reference" in the PostgreSQL Documentation for information on the initdb command.</p></div></div><p>The procedure to create an instance is described below.</p><ol><li><p>Use the OS user account that you want as the instance administrator.</p><p>Connect with the server using the OS user account that you want as the instance administrator.</p><p>You cannot use the OS superuser (root).</p><p>The following example shows the OS superuser connected to the server being changed to the OS user account "fsepuser".</p><dl><dt class="em">Example</dt><dd><pre class="border"># su fsepuser</pre></dd></dl></li><li><p>Configure the environment variables</p><p>Configure the environment variables in the server with the newly created instance.</p><p>Set the following environment variables:</p><ul><li><p>PATH environment variables</p><p>Add the installation directory "/bin".</p></li><li><p>MANPATH environment variables</p><p>Add the installation directory "/share/man".</p></li><li><p>LD_LIBRARY_PATH environment variables</p><p>Add the installation directory "/lib".</p></li></ul><dl><dt class="em">Example</dt><dd><p>The following example configures environment variables when the installation directory is "/opt/fsepv&lt;<span class="i">x</span>&gt;server64".</p><p>Note that "&lt;<span class="i">x</span>&gt;" indicates the product version.</p><dl><dt class="em">sh, bash</dt><dd><pre class="border">$ PATH=/opt/fsepv&lt;<span class="i">x</span>&gt;server64/bin:$PATH ; export PATH$ MANPATH=/opt/fsepv&lt;<span class="i">x</span>&gt;server64/share/man:$MANPATH ; export MANPATH$ LD_LIBRARY_PATH=/opt/fsepv&lt;<span class="i">x</span>&gt;server64/lib:$LD_LIBRARY_PATH ; export LD_LIBRARY_PATH</pre></dd></dl><dl><dt class="em">csh, tcsh</dt><dd><pre class="border">$ setenv PATH /opt/fsepv&lt;<span class="i">x</span>&gt;server64/bin:$PATH$ setenv MANPATH /opt/fsepv&lt;<span class="i">x</span>&gt;server64/share/man:$MANPATH$ setenv LD_LIBRARY_PATH /opt/fsepv&lt;<span class="i">x</span>&gt;server64/lib:$LD_LIBRARY_PATH</pre></dd></dl><dl><dd></dd></dl><dl><dd></dd></dl></dd></dl></li><li><p>Create a database cluster</p><p>Create the database cluster with the initdb command, specifying the storage destination directory.</p><p>Specify the transaction log storage destination and the locale setting option as required.</p><dl><dt class="em">Example</dt><dd><pre class="border">$ initdb -D /database/inst1 --waldir=/transaction/inst1 --lc-collate="C" --lc-ctype="C" --encoding=UTF8</pre></dd></dl><div class="point"><p class="title">Point</p><div class="pointbody"><p>In some features, instance names are requested, and those names are required to uniquely identify the instance within the system. These features allow names that conform to WebAdmin naming conventions, so refer to the following points when determining the names:</p><ul><li><p>Maximum of 16 characters</p></li><li><p>The first character must be ASCII alphabetic character</p></li><li><p>The other characters must be ASCII alphanumeric characters</p></li></ul></div></div><div class="note"><p class="title">Note</p><div class="notebody"><ul><li><p>To balance I/O load, consider deploying the transaction log storage destination to a disk device other than the database cluster storage destination and the backup data storage destination.</p></li><li><p>Specify "C" or "POSIX" for collation and character category. Performance deteriorates if you specify a value other than "C" or "POSIX", although the behavior will follow the rules for particular languages, countries and regions. Furthermore, this may need to be revised when running applications on systems with different locales. <br>For example, specify as follows:</p><pre>initdb --locale="C" --lc-messages="C"initdb --lc-collate="C" --lc-ctype="C"</pre></li><li><p>Specify the same string in the LANG environment variable of the terminal that starts FUJITSU Enterprise Postgres as was specified in lc-messages of initdb (lc_messages of postgresql.conf). If the same string is not specified, messages displayed on the terminal that was started, as well as messages output to the log file specified in the -l option of the pg_ctl command or the postgres command used for startup, may not be output correctly.</p></li><li><p>Specify an encoding system other than SQL_ASCII for the database. If SQL_ASCII is used, there is no guarantee that the encryption system for data in the database will be consistent, depending on the application used to insert the data.</p></li></ul></div></div><div class="ref"><p class="title">See</p><div class="refbody"><p>Refer to "Locale Support" in "Localization" in "Server Administration" in the PostgreSQL Documentation for information on locales.</p></div></div></li><li><p>Set port number.</p><p>Specify a port number in the port parameter of postgresql.conf. Ensure that the specified port number is not already used for other software. If a port number is not specified, "27500" is selected.</p><p>Register the specified port numbers in the /etc/services file if WebAdmin is used to create other instances. WebAdmin uses the /etc/services file to check if port numbers specified as available candidates have been duplicated.</p><p>Register any name as the service name.</p></li><li><p>Set the corefile output destination.</p><p>Specify the output destination of the corefile, which can later be used to collect information for investigation, by setting the core_directory and core_contents parameters of postgresql.conf.</p><div class="ref"><p class="title">See</p><div class="refbody"><p>Refer to "Parameters" in the Operation Guide for information on the settings for these parameters.</p></div></div></li><li><p>Set the backup storage destination.</p><p>Specify the backup data storage destination and other backup settings when backup is to be performed as a provision against database errors.</p><div class="ref"><p class="title">See</p><div class="refbody"><p>Refer to "Backup Methods" in the Operation Guide for information on specifying backup settings.</p></div></div></li><li><p>Start an instance.</p><p>Start with the start mode of the pg_ctl command.</p><p>If either of the following conditions are met, the message "FATAL:the database system is starting up(11189)" may be output.</p><ul><li><p>An application, command, or process connects to the database while the instance is starting</p></li><li><p>An instance was started without the -W option specified</p></li></ul><p>This message is output by the pg_ctl command to check if the instance has started successfully.<br>Therefore, ignore this message if there are no other applications, commands, or processes that connect to the database.</p><dl><dt class="em">Example</dt><dd><pre class="border"> $ pg_ctl start -D /database/inst1</pre></dd></dl><div class="ref"><p class="title">See</p><div class="refbody"><p>Refer to "pg_ctl" in "Reference" in the PostgreSQL Documentation for information on the pg_ctl command.</p></div></div><div class="note"><p class="title">Note</p><div class="notebody"><p>If the -W option is specified, the command will return without waiting for the instance to start. Therefore, it may be unclear as to whether instance startup was successful or failed.</p></div></div></li></ol></div></div><div class="header_footer"><div class="back_next"><a href="j2674-00-04-03-01.html"><img src="image/back2.gif" width="65" height="27" border="0" alt="Previous" title="Previous"></a><a href="j2674-00-04-04-00.html"><img src="image/next2.gif" width="64" height="27" border="0" alt="Next" title="Next"></a></div><div class="copyright">Copyright 2015-2021 FUJITSU LIMITED</div></div></body></html>