<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"><html lang="en"><head><META http-equiv="Content-Type" content="text/html; charset=UTF-8"><META CONTENT="4.3" NAME="GeneratorVersion"><title>6.8 View Audit Logs Using SQL</title><link rel="stylesheet" href="manualmain.css" type="TEXT/CSS"><script language="JavaScript" src="topbutton.js"></script></head><body onload="init()"><div class="topButton" id="topButton0"><a class="topButton" href="#top"><img src="image/top.gif" width="62" height="20" border="0" alt="Top" title="Top"></a></div><div class="top_header"><div class="top_header_title"><a title="Title Page" class="top_link" target="_top" HREF="index.html">Enterprise Postgres 13&nbsp;Security Operation Guide</a></div><div class="top_header_graphic"><span class="top_logo"><img src="image/logo-white-fj.gif" width="148" height="32" alt=""></span><span class="top_keygraphic"><img src="image/cover-header-graphic.gif" width="148" height="32" alt="FUJITSU Software"></span></div></div><div class="header_footer"><div class="breadcrumbslist"><a href="j2680-00-06-00-00.html">Chapter&nbsp;6 Audit Log Feature</a> &gt; 6.8 View Audit Logs Using SQL</div><div class="back_next"><a href="j2680-00-06-09-01.html"><img src="image/back2.gif" width="65" height="27" border="0" alt="Previous" title="Previous"></a><a href="j2680-00-06-11-00.html"><img src="image/next2.gif" width="64" height="27" border="0" alt="Next" title="Next"></a></div></div><h2 id="IDchap06N13">6.8 View Audit Logs Using SQL</h2><div class="body"><div class="textblock"><p>By using file_fdw of an additional module, audit logs can be accessed using SQL. This section describes how to view audit logs, using Session Audit Logging output to a dedicated log file as an example.</p><ol><li><p>Install file_fdw</p><p>Execute CREATE EXTENSION to install file_fdw as an extension.</p><pre class="border">$ psql=# CREATE EXTENSION file_fdw;=# \dx                  List of installed extensionsName     | Version |   Schema   |     Description---------+---------+------------+-------------------------------------------file_fdw | 1.0     | public     | foreign-data wrapper for flat file accesspgaudit  | 1.0     | public     | provides auditing functionalityplpgsql  | 1.0     | pg_catalog | PL/pgSQL procedural language(3 rows)</pre></li><li><p>Create an external server</p><p>Use CREATE SERVER to create an external server managed by file_fdw.</p><pre class="border">$ psql=# CREATE SERVER auditlog FOREIGN DATA WRAPPER file_fdw;</pre></li><li><p>Create an audit log table.</p><p>Use CREATE FOREIGN TABLE to define the table columns of audit logs, CSV file name and format.</p><pre class="border">$ psql=# CREATE FOREIGN TABLE auditlog (header text,class text,sql_start_time timestamp with time zone,remote_host_name text,backend_process_id text,application_name text,session_user_name text,database_name text,virtual_transaction_id text,statement_id text,substatement_id text,command_tag text,sqlstate text,object_type text,object_name text,error_message text,sql text,parameter text) SERVER auditlogOPTIONS ( filename '/database/inst1/pgaudit_log/pgaudit-2020-03-12.log', format 'csv' );</pre><div class="note"><p class="title">Note</p><div class="notebody"><p>If an audit log file is rotated and multiple audit log files exist, it is necessary to create a table for each audit log file.</p></div></div></li><li><p>View audit logs</p><p>Use SELECT and view the audit logs.</p><pre class="border">$ psql=# SELECT * FROM auditlog;     header     |  class  |     sql_start_time     | remote_host_name | backend_process_id ...----------------+---------+------------------------+------------------+------------------- ...AUDIT: SESSION  | WRITE   | 2020-03-12 19:00:49+09 | [local]          | 19944              ...AUDIT: SESSION  | READ    | 2020-03-12 19:00:58+09 | [local]          | 19944              ...</pre></li></ol><p></p></div></div><div class="header_footer"><div class="back_next"><a href="j2680-00-06-09-01.html"><img src="image/back2.gif" width="65" height="27" border="0" alt="Previous" title="Previous"></a><a href="j2680-00-06-11-00.html"><img src="image/next2.gif" width="64" height="27" border="0" alt="Next" title="Next"></a></div><div class="copyright">Copyright 2018-2021 FUJITSU LIMITED </div></div></body></html>