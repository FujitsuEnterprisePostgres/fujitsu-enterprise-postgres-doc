<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"><html lang="en"><head><META http-equiv="Content-Type" content="text/html; charset=UTF-8"><META CONTENT="4.3" NAME="GeneratorVersion"><title>6.5 Object Audit Logging</title><link rel="stylesheet" href="manualmain.css" type="TEXT/CSS"><script language="JavaScript" src="topbutton.js"></script></head><body onload="init()"><div class="topButton" id="topButton0"><a class="topButton" href="#top"><img src="image/top.gif" width="62" height="20" border="0" alt="Top" title="Top"></a></div><div class="top_header"><div class="top_header_title"><a title="Title Page" class="top_link" target="_top" HREF="index.html">Enterprise Postgres 13&nbsp;Security Operation Guide</a></div><div class="top_header_graphic"><span class="top_logo"><img src="image/logo-white-fj.gif" width="148" height="32" alt=""></span><span class="top_keygraphic"><img src="image/cover-header-graphic.gif" width="148" height="32" alt="FUJITSU Software"></span></div></div><div class="header_footer"><div class="breadcrumbslist"><a href="j2680-00-06-00-00.html">Chapter&nbsp;6 Audit Log Feature</a> &gt; 6.5 Object Audit Logging</div><div class="back_next"><a href="j2680-00-06-06-00.html"><img src="image/back2.gif" width="65" height="27" border="0" alt="Previous" title="Previous"></a><a href="j2680-00-06-08-00.html"><img src="image/next2.gif" width="64" height="27" border="0" alt="Next" title="Next"></a></div></div><h2 id="mID_06_object">6.5 Object Audit Logging</h2><div class="body"><div class="textblock"><p>In Object Audit Logging, retrieval of audit logs is achieved by using roles.</p><p>Roles are specified in the role parameter of the option section to retrieve audit logs. If there are privileges for commands executed by a role, or if privileges have been inherited from another role, those command operations are output as audit logs.</p><p>For example, after "auditor" is set for the role parameter of the option section, the SELECT and DELETE privileges for the account table are assigned to "auditor". In this case, when SELECT or DELETE is executed for the account table, audit logs are output.</p><p></p></div><p class="subhead_1" id="mID_06_object_output"><span class="em">Output format</span></p><div class="textblock"><p>In Object Audit Logging, audit logs are output in the format below:</p><pre class="border">AUDIT: OBJECT,1,1,READ,SELECT,TABLE,public.account,SELECT password FROM account;,&lt;not logged&gt;     (1)    (2)(3)(4)  (5)    (6)        (7)               (8)                   (9)</pre><table><col><col><tr><th valign="top"><p><span class="em">No</span></p></th><th valign="top"><p><span class="em">C</span><span class="em">ontent</span></p></th></tr><tr><td align="left" valign="top"><p>(1)</p></td><td align="left" valign="top"><p>Log header</p><p>Fixed as "AUDIT: OBJECT".</p></td></tr><tr><td align="left" valign="top"><p>(2)</p></td><td align="left" valign="top"><p>Statement ID</p></td></tr><tr><td align="left" valign="top"><p>(3)</p></td><td align="left" valign="top"><p>Substatement ID</p></td></tr><tr><td align="left" valign="top"><p>(4)</p></td><td align="left" valign="top"><p>Class name</p></td></tr><tr><td align="left" valign="top"><p>(5)</p></td><td align="left" valign="top"><p>Command tag</p></td></tr><tr><td align="left" valign="top"><p>(6)</p></td><td align="left" valign="top"><p>Object type</p></td></tr><tr><td align="left" valign="top"><p>(7)</p></td><td align="left" valign="top"><p>Object name</p></td></tr><tr><td align="left" valign="top"><p>(8)</p></td><td align="left" valign="top"><p>SQL</p><p>If "on" is specified for the log_statement_once parameter of the option section in the pgaudit configuration file, "&lt;previously logged&gt;" is output for the second and subsequent statements.</p></td></tr><tr><td align="left" valign="top"><p>(9)</p></td><td align="left" valign="top"><p>Depending on the log_parameter parameter value of the option section in the pgaudit configuration file, the output content will be as below.</p><ul><li><p>When log_parameter=on</p><p>If parameters are specified in the SQL, the parameters are concatenated and output, using a comma as the delimiter. <br>If parameters are not specified in the SQL, "&lt;none&gt;" is output.</p></li><li><p>When log_parameter=off (default)</p><p>"&lt;not logged&gt;" is output.</p></li></ul><p>Additionally, if "on" is specified for the log_statement_once parameter of the option section in the pgaudit configuration file, "&lt;previously logged&gt;" is output for the second and subsequent statements.</p></td></tr></table><div class="tips"><p class="title">Information</p><div class="tipsbody"><p>If accessing resources that use the features below, the command tag (5) may be output as "???".</p><ul><li><p>INSTEAD OF trigger</p></li><li><p>RULE</p></li><li><p>VIEW</p></li><li><p>Security policy per row</p></li><li><p>Table inheritance</p></li></ul></div></div></div><p class="subhead_1" id="IDchap06N9"><span class="em">Example</span></p><div class="textblock"><p>Below is an example of retrieving logs in Object Audit Logging.</p><p>By setting the target for assigning privileges to roles in detail, log output can be controlled.</p><p>In the example below, log retrieval of the account table is controlled by the privileges assigned to the columns, however, log retrieval of the account_role_map table is controlled by the privileges assigned to the table.</p><br><dl><dt class="em">1. Settings</dt><dd><p>The role parameter below is specified for the option section in the pgaudit configuration file.</p><pre class="border">[option]role = 'auditor'</pre><br></dd></dl><dl><dt class="em">2. Defining a role</dt><dd><p>A role is defined for Object Audit Logging.</p><pre class="border">CREATE USER auditor NOSUPERUSER LOGIN;</pre><br></dd></dl><dl><dt class="em">3. Retrieving logs</dt><dd><p>Execute the SQL below from the client.</p><pre class="border">CREATE TABLE account(    id int,    name text,    password text,    description text);GRANT SELECT (password) ON public.account TO auditor;SELECT id, name FROM account;SELECT password FROM account;GRANT UPDATE (name, password) ON public.account TO auditor;UPDATE account SET description = 'yada, yada';UPDATE account SET password = 'HASH2';CREATE TABLE account_role_map(    account_id int,    role_id int);GRANT SELECT ON public.account_role_map TO auditor;SELECT account.password, account_role_map.role_id  FROM account  INNER JOIN account_role_map ON account.id = account_role_map.account_id;</pre><br><p>The audit log below can be retrieved.</p><p>In the account table, only the operations for columns that privileges have been assigned to are output as logs.</p><p>In the account_role_map table, privileges are assigned to the table, so operations performed for the table are output as logs.</p><pre class="border">AUDIT: OBJECT,4,1,READ,SELECT,TABLE,public.account,SELECT password FROM account;,&lt;not logged&gt;AUDIT: OBJECT,7,1,WRITE,UPDATE,TABLE,public.account,UPDATE account SET password = 'HASH2';,&lt;not logged&gt;AUDIT: OBJECT,10,1,READ,SELECT,TABLE,public.account,"SELECT account.password, account_role_map.role_id        FROM account        INNER JOIN account_role_map ON account.id = account_role_map.account_id;",&lt;not logged&gt;AUDIT: OBJECT,10,1,READ,SELECT,TABLE,public.account_role_map,"SELECT account.password, account_role_map.role_id        FROM account        INNER JOIN account_role_map ON account.id = account_role_map.account_id;",&lt;not logged&gt;</pre></dd></dl></div></div><div class="header_footer"><div class="back_next"><a href="j2680-00-06-06-00.html"><img src="image/back2.gif" width="65" height="27" border="0" alt="Previous" title="Previous"></a><a href="j2680-00-06-08-00.html"><img src="image/next2.gif" width="64" height="27" border="0" alt="Next" title="Next"></a></div><div class="copyright">Copyright 2018-2021 FUJITSU LIMITED </div></div></body></html>